<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DENDRO: /export/home/ilashuk3/Dendro/src/oda/oda.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_95d5eb57f2839000f42cfeba4072b840.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_b5c6e06b1ba7006988474c52fce3c3f3.html">oda</a></div>
<h1>oda.C</h1><a href="oda_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="oda_8h.html">oda.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="parUtils_8h.html">parUtils.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="colors_8h.html">colors.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="testUtils_8h.html">testUtils.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="dendro_8h.html">dendro.h</a>"</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#ifdef __DEBUG__</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#ifndef __DEBUG_DA__</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#define __DEBUG_DA__</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span>
<a name="l00020"></a>00020 <span class="preprocessor">#ifdef __DEBUG_DA__</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#ifndef __DEBUG_DA_PUBLIC__</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#define __DEBUG_DA_PUBLIC__</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a>00026 <span class="preprocessor">#ifdef __DEBUG_DA_PUBLIC__</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#ifndef __MEASURE_DA__</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#define __MEASURE_DA__</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00032"></a>00032 <span class="keyword">namespace </span>ot {
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="classot_1_1DA.html#70b74dc0983452b8afccd85983593260">00034</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#70b74dc0983452b8afccd85983593260">DA::computeLocalToGlobalElemMappings</a>() {
<a name="l00035"></a>00035     <a class="code" href="dendro_8h.html#490fe0f826970b13c0e443d13f40448d">DendroIntL</a> localElemSize = <a class="code" href="classot_1_1DA.html#596f5db8e49045b6af834ccf9460ca4e">getElementSize</a>();
<a name="l00036"></a>00036     <a class="code" href="dendro_8h.html#490fe0f826970b13c0e443d13f40448d">DendroIntL</a> off1, globalOffset;
<a name="l00037"></a>00037     MPI_Request sendRequest;
<a name="l00038"></a>00038     MPI_Status status;
<a name="l00039"></a>00039     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00040"></a>00040       par::Mpi_Scan&lt;DendroIntL&gt;(&amp;localElemSize, &amp;off1, 1, MPI_SUM, <a class="code" href="classot_1_1DA.html#045d787547f61d31379f4b02a867c89a">m_mpiCommActive</a>); 
<a name="l00041"></a>00041       <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a> &lt; (<a class="code" href="classot_1_1DA.html#155de256c071717644c4ba2f5f643be7">m_iNpesActive</a> - 1)) {
<a name="l00042"></a>00042         par::Mpi_Issend&lt;DendroIntL&gt;(&amp;off1, 1, <a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a>+1, 0, <a class="code" href="classot_1_1DA.html#045d787547f61d31379f4b02a867c89a">m_mpiCommActive</a>, &amp;sendRequest);
<a name="l00043"></a>00043       }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045       <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a>) {
<a name="l00046"></a>00046         par::Mpi_Recv&lt;DendroIntL&gt;(&amp;globalOffset, 1, <a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a>-1, 0, <a class="code" href="classot_1_1DA.html#045d787547f61d31379f4b02a867c89a">m_mpiCommActive</a>, &amp;status );
<a name="l00047"></a>00047       }<span class="keywordflow">else</span> {
<a name="l00048"></a>00048         globalOffset = 0;
<a name="l00049"></a>00049       }
<a name="l00050"></a>00050     }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     <span class="comment">//Equivalent to createVector: elemental, non-ghosted, 1 dof</span>
<a name="l00053"></a>00053     std::vector&lt;DendroIntL&gt; gNumNonGhostElems(localElemSize); 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055     <span class="keywordflow">for</span>(<a class="code" href="dendro_8h.html#490fe0f826970b13c0e443d13f40448d">DendroIntL</a> i = 0; i &lt; localElemSize; i++) {
<a name="l00056"></a>00056       gNumNonGhostElems[i] = (i+globalOffset);   
<a name="l00057"></a>00057     }
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     vecGetBuffer&lt;DendroIntL&gt;(gNumNonGhostElems,
<a name="l00060"></a>00060         <a class="code" href="classot_1_1DA.html#38a96d399eed9910dafd38326107fe81">m_dilpLocalToGlobalElems</a>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, 1);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062     <span class="keywordflow">if</span>( <a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a> &amp;&amp; (<a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a> &lt; (<a class="code" href="classot_1_1DA.html#155de256c071717644c4ba2f5f643be7">m_iNpesActive</a>-1)) ) {
<a name="l00063"></a>00063       MPI_Status statusWait;
<a name="l00064"></a>00064       MPI_Wait(&amp;sendRequest, &amp;statusWait);
<a name="l00065"></a>00065     }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     ReadFromGhostElemsBegin&lt;DendroIntL&gt;(m_dilpLocalToGlobalElems,1);
<a name="l00068"></a>00068     ReadFromGhostElemsEnd&lt;DendroIntL&gt;(m_dilpLocalToGlobalElems);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     gNumNonGhostElems.clear();
<a name="l00071"></a>00071     <a class="code" href="classot_1_1DA.html#64b9a9ea1cfc0a518abc5564c1971f27">m_bComputedLocalToGlobalElems</a> = <span class="keyword">true</span>;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     <span class="keywordflow">return</span> 0;
<a name="l00074"></a>00074   }<span class="comment">//end function</span>
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="classot_1_1DA.html#3846f5527709425e8307d4e99c63ccb6">00076</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#3846f5527709425e8307d4e99c63ccb6">DA::computeLocalToGlobalMappings</a>() {
<a name="l00077"></a>00077     <a class="code" href="dendro_8h.html#490fe0f826970b13c0e443d13f40448d">DendroIntL</a> localNodeSize = <a class="code" href="classot_1_1DA.html#12aa98019d001944ed73b92d0b1081a9">getNodeSize</a>();
<a name="l00078"></a>00078     <a class="code" href="dendro_8h.html#490fe0f826970b13c0e443d13f40448d">DendroIntL</a> off1, globalOffset;
<a name="l00079"></a>00079     MPI_Request sendRequest;
<a name="l00080"></a>00080     MPI_Status status;
<a name="l00081"></a>00081     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00082"></a>00082       par::Mpi_Scan&lt;DendroIntL&gt;(&amp;localNodeSize, &amp;off1, 1, MPI_SUM, <a class="code" href="classot_1_1DA.html#045d787547f61d31379f4b02a867c89a">m_mpiCommActive</a>); 
<a name="l00083"></a>00083       <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a> &lt; (<a class="code" href="classot_1_1DA.html#155de256c071717644c4ba2f5f643be7">m_iNpesActive</a>-1)) {
<a name="l00084"></a>00084         par::Mpi_Issend&lt;DendroIntL&gt;(&amp;off1, 1, <a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a>+1, 0, <a class="code" href="classot_1_1DA.html#045d787547f61d31379f4b02a867c89a">m_mpiCommActive</a>, &amp;sendRequest);
<a name="l00085"></a>00085       }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087       <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a>) {
<a name="l00088"></a>00088         par::Mpi_Recv&lt;DendroIntL&gt;(&amp;globalOffset, 1, <a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a>-1, 0, <a class="code" href="classot_1_1DA.html#045d787547f61d31379f4b02a867c89a">m_mpiCommActive</a>, &amp;status);
<a name="l00089"></a>00089       }<span class="keywordflow">else</span> {
<a name="l00090"></a>00090         globalOffset = 0;
<a name="l00091"></a>00091       }
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     std::vector&lt;DendroIntL&gt; gNumNonGhostNodes(localNodeSize); 
<a name="l00095"></a>00095     <span class="keywordflow">for</span>(<a class="code" href="dendro_8h.html#490fe0f826970b13c0e443d13f40448d">DendroIntL</a> i = 0; i &lt; localNodeSize; i++) {
<a name="l00096"></a>00096       gNumNonGhostNodes[i] = (i+globalOffset);   
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     vecGetBuffer&lt;DendroIntL&gt;(gNumNonGhostNodes, <a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a>,
<a name="l00100"></a>00100         <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, 1);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a> &amp;&amp; (<a class="code" href="classot_1_1DA.html#80f6c375324f6c5a6aaf706721a6e8f7">m_iRankActive</a> &lt; (<a class="code" href="classot_1_1DA.html#155de256c071717644c4ba2f5f643be7">m_iNpesActive</a>-1))) {
<a name="l00103"></a>00103       MPI_Status statusWait;
<a name="l00104"></a>00104       MPI_Wait(&amp;sendRequest, &amp;statusWait);
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     ReadFromGhostsBegin&lt;DendroIntL&gt;(m_dilpLocalToGlobal,1);
<a name="l00108"></a>00108     ReadFromGhostsEnd&lt;DendroIntL&gt;(m_dilpLocalToGlobal);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     gNumNonGhostNodes.clear();
<a name="l00111"></a>00111     <a class="code" href="classot_1_1DA.html#08742b5f61bbcfdca79105026b9a967c">m_bComputedLocalToGlobal</a> = <span class="keyword">true</span>;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="keywordflow">return</span> 0;
<a name="l00114"></a>00114   }<span class="comment">//end function</span>
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="classot_1_1DA.html#47a9670ab9f3efdbb1fa975f8d1b12f2">00116</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#47a9670ab9f3efdbb1fa975f8d1b12f2">DA::setValuesInMatrix</a>(Mat mat, std::vector&lt;ot::MatRecord&gt;&amp; records, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof, InsertMode mode) {
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <a class="code" href="oda_8h.html#a99d1a33e683b2df54a53fccde78fd1b">PROF_SET_MAT_VALUES_BEGIN</a> 
<a name="l00119"></a>00119 
<a name="l00120"></a>00120       assert(<a class="code" href="classot_1_1DA.html#08742b5f61bbcfdca79105026b9a967c">m_bComputedLocalToGlobal</a>);
<a name="l00121"></a>00121     std::vector&lt;PetscScalar&gt; values;
<a name="l00122"></a>00122     std::vector&lt;PetscInt&gt; colIndices;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="comment">//Can make it more efficient later.</span>
<a name="l00125"></a>00125     <span class="keywordflow">if</span>(!records.empty()) {
<a name="l00126"></a>00126       <span class="comment">//Sort Order: row first, col next, val last</span>
<a name="l00127"></a>00127       <a class="code" href="Sort_8h.html#9f400c32a5c1d9494caa0dfd766ec976">std::sort</a>(records.begin(), records.end());
<a name="l00128"></a>00128 
<a name="l00129"></a>00129       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currRecord = 0;
<a name="l00130"></a>00130       <span class="keywordflow">while</span>(currRecord &lt; (records.size()-1)) {
<a name="l00131"></a>00131         values.push_back(records[currRecord].val);
<a name="l00132"></a>00132         colIndices.push_back( static_cast&lt;PetscInt&gt;(
<a name="l00133"></a>00133               (dof*<a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a>[records[currRecord].colIdx]) +
<a name="l00134"></a>00134               records[currRecord].colDim) );
<a name="l00135"></a>00135         <span class="keywordflow">if</span>( (records[currRecord].rowIdx != records[currRecord+1].rowIdx) ||
<a name="l00136"></a>00136             (records[currRecord].rowDim != records[currRecord+1].rowDim) ) {
<a name="l00137"></a>00137           PetscInt rowId = static_cast&lt;PetscInt&gt;(
<a name="l00138"></a>00138               (dof*<a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a>[records[currRecord].rowIdx]) + 
<a name="l00139"></a>00139               records[currRecord].rowDim);
<a name="l00140"></a>00140           MatSetValues(mat,1,&amp;rowId,colIndices.size(),(&amp;(*colIndices.begin())),
<a name="l00141"></a>00141               (&amp;(*values.begin())),mode);
<a name="l00142"></a>00142           colIndices.clear();
<a name="l00143"></a>00143           values.clear();
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145         currRecord++;
<a name="l00146"></a>00146       }<span class="comment">//end while</span>
<a name="l00147"></a>00147       PetscInt rowId = static_cast&lt;PetscInt&gt;(
<a name="l00148"></a>00148           (dof*<a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a>[records[currRecord].rowIdx]) +
<a name="l00149"></a>00149           records[currRecord].rowDim);
<a name="l00150"></a>00150       <span class="keywordflow">if</span>(values.empty()) {
<a name="l00151"></a>00151         <span class="comment">//Last row is different from the previous row</span>
<a name="l00152"></a>00152         PetscInt colId = static_cast&lt;PetscInt&gt;(
<a name="l00153"></a>00153             (dof*<a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a>[records[currRecord].colIdx]) + 
<a name="l00154"></a>00154             records[currRecord].colDim);
<a name="l00155"></a>00155         PetscScalar value = records[currRecord].val;
<a name="l00156"></a>00156         MatSetValues(mat,1,&amp;rowId,1,&amp;colId,&amp;value,mode);
<a name="l00157"></a>00157       }<span class="keywordflow">else</span> {
<a name="l00158"></a>00158         <span class="comment">//Last row is same as the previous row</span>
<a name="l00159"></a>00159         values.push_back(records[currRecord].val);
<a name="l00160"></a>00160         colIndices.push_back( static_cast&lt;PetscInt&gt;(
<a name="l00161"></a>00161               (dof*<a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a>[records[currRecord].colIdx]) + 
<a name="l00162"></a>00162               records[currRecord].colDim) );
<a name="l00163"></a>00163         MatSetValues(mat,1,&amp;rowId,colIndices.size(),(&amp;(*colIndices.begin())),
<a name="l00164"></a>00164             (&amp;(*values.begin())),mode);
<a name="l00165"></a>00165         colIndices.clear();
<a name="l00166"></a>00166         values.clear();
<a name="l00167"></a>00167       }
<a name="l00168"></a>00168       records.clear();
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <a class="code" href="oda_8h.html#e39aa912e86d70d62638939f62c66e2a">PROF_SET_MAT_VALUES_END</a>
<a name="l00172"></a>00172   }<span class="comment">//end function</span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <span class="comment">//***************Constructor*****************//</span>
<a name="l00175"></a><a class="code" href="classot_1_1DA.html#9b2e2e6210c08f29c23f5ec0c3f8f4f2">00175</a>   <a class="code" href="classot_1_1DA.html#9b2e2e6210c08f29c23f5ec0c3f8f4f2">DA::DA</a>(std::vector&lt;ot::TreeNode&gt; &amp;in, MPI_Comm comm, MPI_Comm activeInputComm,
<a name="l00176"></a>00176       <span class="keywordtype">bool</span> compressLut, <span class="keyword">const</span> std::vector&lt;ot::TreeNode&gt;* blocksPtr, <span class="keywordtype">bool</span>* iAmActive ) {
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="preprocessor">#ifdef __PROF_WITH_BARRIER__</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>    MPI_Barrier(comm);
<a name="l00180"></a>00180 <span class="preprocessor">#endif</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span>    <a class="code" href="oda_8h.html#d545c5e78b9a3dd7e9c1328d8976ae04">PROF_BUILD_DA_BEGIN</a> 
<a name="l00182"></a>00182 
<a name="l00183"></a>00183       <a class="code" href="classot_1_1DA.html#501a8b533f23844a8e81a5962b1f7fe3">DA_FactoryPart0</a>(in, comm, activeInputComm, compressLut, iAmActive);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00186"></a>00186       <a class="code" href="classot_1_1DA.html#cd0b80931fc51d2dd95c44d773fa0377">DA_FactoryPart1</a>(in);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188       <a class="code" href="classot_1_1DA.html#32e9130821ed91553b79b3ae4bfae635">DA_FactoryPart2</a>(in);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190       <a class="code" href="classot_1_1DA.html#5d40f7727c1a1a1b3616f7ed5d0d05fa">DA_FactoryPart3</a>(in, comm, compressLut, blocksPtr, iAmActive);
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <a class="code" href="oda_8h.html#c816746ca627d97d7e57475951f45a13">PROF_BUILD_DA_END</a>
<a name="l00194"></a>00194   }<span class="comment">//end constructor</span>
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="classot_1_1DA.html#de531a8bf98315b582c51b6fa1b326aa">00196</a>   <a class="code" href="classot_1_1DA.html#9b2e2e6210c08f29c23f5ec0c3f8f4f2">DA::DA</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dummy, std::vector&lt;ot::TreeNode&gt; &amp;in, MPI_Comm comm,
<a name="l00197"></a>00197       MPI_Comm activeInputComm, <span class="keywordtype">bool</span> compressLut, 
<a name="l00198"></a>00198       <span class="keyword">const</span> std::vector&lt;ot::TreeNode&gt; * blocksPtr, <span class="keywordtype">bool</span>* iAmActive ) {
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="preprocessor">#ifdef __PROF_WITH_BARRIER__</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>    MPI_Barrier(comm);
<a name="l00202"></a>00202 <span class="preprocessor">#endif</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>    <a class="code" href="oda_8h.html#d545c5e78b9a3dd7e9c1328d8976ae04">PROF_BUILD_DA_BEGIN</a> 
<a name="l00204"></a>00204 
<a name="l00205"></a>00205       <a class="code" href="classot_1_1DA.html#501a8b533f23844a8e81a5962b1f7fe3">DA_FactoryPart0</a>(in, comm, activeInputComm, compressLut, iAmActive);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00208"></a>00208       <a class="code" href="classot_1_1DA.html#5d40f7727c1a1a1b3616f7ed5d0d05fa">DA_FactoryPart3</a>(in, comm, compressLut, blocksPtr, iAmActive);
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     <a class="code" href="oda_8h.html#c816746ca627d97d7e57475951f45a13">PROF_BUILD_DA_END</a>
<a name="l00212"></a>00212   }<span class="comment">//end constructor</span>
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="classot_1_1DA.html#9fbde8aba2b7b71714ddc5904ed6c54c">00214</a>   <a class="code" href="classot_1_1DA.html#9fbde8aba2b7b71714ddc5904ed6c54c">DA::~DA</a>() {
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a> != NULL) {
<a name="l00216"></a>00216       <span class="keyword">delete</span> [] <a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>;
<a name="l00217"></a>00217       <a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a> = NULL;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a> != NULL) {
<a name="l00221"></a>00221       <span class="keyword">delete</span> [] <a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a>;
<a name="l00222"></a>00222       <a class="code" href="classot_1_1DA.html#226f89be5c36f0bd0edb789345d6a353">m_dilpLocalToGlobal</a> = NULL;
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#38a96d399eed9910dafd38326107fe81">m_dilpLocalToGlobalElems</a> != NULL) {
<a name="l00226"></a>00226       <span class="keyword">delete</span> [] <a class="code" href="classot_1_1DA.html#38a96d399eed9910dafd38326107fe81">m_dilpLocalToGlobalElems</a>;
<a name="l00227"></a>00227       <a class="code" href="classot_1_1DA.html#38a96d399eed9910dafd38326107fe81">m_dilpLocalToGlobalElems</a> = NULL;
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <a class="code" href="classot_1_1DA.html#67afca98a0862ef09bb4801d846ab935">m_ucpLutRemainders</a>.clear();
<a name="l00231"></a>00231     <a class="code" href="classot_1_1DA.html#8b84170b0e36f02dc85e03219abfdb9c">m_uspLutQuotients</a>.clear();
<a name="l00232"></a>00232     <a class="code" href="classot_1_1DA.html#d4800b646ac8feee9e818a82bca36732">m_ucpLutMasks</a>.clear();
<a name="l00233"></a>00233     <a class="code" href="classot_1_1DA.html#70264ccfce790b1ede010fdbe9cfbf53">m_ucpSortOrders</a>.clear();
<a name="l00234"></a>00234     <a class="code" href="classot_1_1DA.html#277df6fea9f30f6f3834ab229604b782">m_uiNlist</a>.clear();
<a name="l00235"></a>00235   }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <span class="comment">/************** Domain Access ****************/</span>
<a name="l00238"></a><a class="code" href="classot_1_1DA.html#bb36ec771ec30575a57d47f7ae8dd01b">00238</a>   <a class="code" href="classPoint.html">Point</a> <a class="code" href="classot_1_1DA.html#bb36ec771ec30575a57d47f7ae8dd01b">DA::getNextOffset</a>(<a class="code" href="classPoint.html">Point</a> p, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d) {
<a name="l00239"></a>00239 <span class="preprocessor">#ifdef __DEBUG_DA_PUBLIC__</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span>    assert(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>);
<a name="l00241"></a>00241 <span class="preprocessor">#endif</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a>00243     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len = (<span class="keywordtype">unsigned</span> int)(1u&lt;&lt;( <a class="code" href="classot_1_1DA.html#74995e7d8504c75ec557b95588784355">m_uiMaxDepth</a> - d ) );
<a name="l00244"></a>00244     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len_par = (<span class="keywordtype">unsigned</span> int)(1u&lt;&lt;( <a class="code" href="classot_1_1DA.html#74995e7d8504c75ec557b95588784355">m_uiMaxDepth</a> - d +1 ) );
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i,j,k;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     i = p.<a class="code" href="classPoint.html#2038bd17c3cc6fb62cedae6498652720">xint</a>(); i %= len_par;
<a name="l00249"></a>00249     j = p.<a class="code" href="classPoint.html#dba12524735f18d5411660907975f887">yint</a>(); j %= len_par;
<a name="l00250"></a>00250     k = p.<a class="code" href="classPoint.html#c0d13f9086d122f107181d4b69c16427">zint</a>(); k %= len_par;
<a name="l00251"></a>00251     i /= len;
<a name="l00252"></a>00252     j /= len;
<a name="l00253"></a>00253     k /= len;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> childNum = 4*k + 2*j + i;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <a class="code" href="classPoint.html">Point</a> p2;
<a name="l00258"></a>00258     <span class="keywordflow">switch</span> (childNum) {
<a name="l00259"></a>00259       <span class="keywordflow">case</span> 7:
<a name="l00260"></a>00260         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() -len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() - len; p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() -len;
<a name="l00261"></a>00261         <span class="keywordflow">return</span> <a class="code" href="classot_1_1DA.html#bb36ec771ec30575a57d47f7ae8dd01b">getNextOffset</a>(p2, d-1);
<a name="l00262"></a>00262       <span class="keywordflow">case</span> 0:
<a name="l00263"></a>00263         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() +len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>(); p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00264"></a>00264         <span class="keywordflow">break</span>;
<a name="l00265"></a>00265       <span class="keywordflow">case</span> 1:
<a name="l00266"></a>00266         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() -len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() +len; p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00267"></a>00267         <span class="keywordflow">break</span>;
<a name="l00268"></a>00268       <span class="keywordflow">case</span> 2:
<a name="l00269"></a>00269         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() +len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>(); p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00270"></a>00270         <span class="keywordflow">break</span>;
<a name="l00271"></a>00271       <span class="keywordflow">case</span> 3:
<a name="l00272"></a>00272         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() -len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() - len; p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() +len;
<a name="l00273"></a>00273         <span class="keywordflow">break</span>;
<a name="l00274"></a>00274       <span class="keywordflow">case</span> 4:
<a name="l00275"></a>00275         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() +len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>(); p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00276"></a>00276         <span class="keywordflow">break</span>;
<a name="l00277"></a>00277       <span class="keywordflow">case</span> 5:
<a name="l00278"></a>00278         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() -len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>()+len; p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00279"></a>00279         <span class="keywordflow">break</span>;
<a name="l00280"></a>00280       <span class="keywordflow">case</span> 6:
<a name="l00281"></a>00281         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() +len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>(); p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00282"></a>00282         <span class="keywordflow">break</span>;
<a name="l00283"></a>00283       <span class="keywordflow">default</span>:
<a name="l00284"></a>00284         std::cerr &lt;&lt; <span class="stringliteral">"Wrong child number in "</span> &lt;&lt; __func__ &lt;&lt; std::endl;
<a name="l00285"></a>00285         assert(<span class="keyword">false</span>);
<a name="l00286"></a>00286         <span class="keywordflow">break</span>;
<a name="l00287"></a>00287     } <span class="comment">// switch (childNum)</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="keywordflow">return</span> p2;
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291 
<a name="l00292"></a><a class="code" href="classot_1_1DA.html#5241ad83a37a2761a2e5719ea3fed22a">00292</a>   <span class="keywordtype">void</span> <a class="code" href="classot_1_1DA.html#5241ad83a37a2761a2e5719ea3fed22a">DA::incrementCurrentOffset</a>() {
<a name="l00293"></a>00293 <span class="preprocessor">#ifdef __DEBUG_DA_PUBLIC__</span>
<a name="l00294"></a>00294 <span class="preprocessor"></span>    assert(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>);
<a name="l00295"></a>00295 <span class="preprocessor">#endif</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>
<a name="l00297"></a>00297     <span class="comment">// if it is the first element, simply return the stored offset ...</span>
<a name="l00298"></a>00298     <span class="keywordflow">if</span> ( <a class="code" href="classot_1_1DA.html#86b0739533537841acee7a7019dd0828">m_uiCurrent</a> == (<a class="code" href="classot_1_1DA.html#ec575a8d42f1a5de683e2598f2872e52">m_uiElementBegin</a>-1)) {
<a name="l00299"></a>00299       <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a> = <a class="code" href="classot_1_1DA.html#a9bf7721524e94476f2fe03196e79fc9">m_ptOffset</a>;
<a name="l00300"></a>00300       <span class="keywordflow">return</span>; 
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 <span class="preprocessor">#ifdef __DEBUG_DA_PUBLIC__</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[<a class="code" href="classot_1_1DA.html#86b0739533537841acee7a7019dd0828">m_uiCurrent</a>] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf80696c30ddbe9ec3ea80a7e88f5c24e0a">ot::TreeNode::BOUNDARY</a> ) {
<a name="l00305"></a>00305       std::cerr &lt;&lt; <a class="code" href="colors_8h.html#61ef7a1b5082f8dc3761eec9833867c3">RED</a><span class="stringliteral">"ERROR, Boundary eleme in incre Curr offset"</span><a class="code" href="colors_8h.html#a15368f9f838e27e7fab6d2a6379e7a1">NRM</a> &lt;&lt; std::endl;
<a name="l00306"></a>00306       assert(<span class="keyword">false</span>);
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 <span class="preprocessor">#endif</span>
<a name="l00309"></a>00309 <span class="preprocessor"></span>
<a name="l00310"></a>00310     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d = (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[<a class="code" href="classot_1_1DA.html#86b0739533537841acee7a7019dd0828">m_uiCurrent</a>] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf83026e9550ae861ec4ecb6a2649b8ebed">ot::TreeNode::MAX_LEVEL</a> );
<a name="l00311"></a>00311     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len = (<span class="keywordtype">unsigned</span> int)(1u&lt;&lt;( <a class="code" href="classot_1_1DA.html#74995e7d8504c75ec557b95588784355">m_uiMaxDepth</a> - d ) );
<a name="l00312"></a>00312     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len_par = (<span class="keywordtype">unsigned</span> int)(1u&lt;&lt;( <a class="code" href="classot_1_1DA.html#74995e7d8504c75ec557b95588784355">m_uiMaxDepth</a> - d +1 ) );
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i,j,k;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     i = <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a>.<a class="code" href="classPoint.html#2038bd17c3cc6fb62cedae6498652720">xint</a>(); 
<a name="l00317"></a>00317     j = <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a>.<a class="code" href="classPoint.html#dba12524735f18d5411660907975f887">yint</a>(); 
<a name="l00318"></a>00318     k = <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a>.<a class="code" href="classPoint.html#c0d13f9086d122f107181d4b69c16427">zint</a>(); 
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     i %= len_par;
<a name="l00321"></a>00321     j %= len_par;
<a name="l00322"></a>00322     k %= len_par;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     i /= len;
<a name="l00325"></a>00325     j /= len;
<a name="l00326"></a>00326     k /= len;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> childNum = 4*k + 2*j + i;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     <a class="code" href="classPoint.html">Point</a> p = <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a>;
<a name="l00331"></a>00331     <a class="code" href="classPoint.html">Point</a> p2;
<a name="l00332"></a>00332     <span class="keywordflow">switch</span> (childNum) {
<a name="l00333"></a>00333       <span class="keywordflow">case</span> 7:
<a name="l00334"></a>00334         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() -len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() - len; p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() -len;
<a name="l00335"></a>00335         p2 = <a class="code" href="classot_1_1DA.html#bb36ec771ec30575a57d47f7ae8dd01b">getNextOffset</a>(p2, d-1);
<a name="l00336"></a>00336         <span class="keywordflow">break</span>;
<a name="l00337"></a>00337       <span class="keywordflow">case</span> 0:
<a name="l00338"></a>00338         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() +len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>(); p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00339"></a>00339         <span class="keywordflow">break</span>;
<a name="l00340"></a>00340       <span class="keywordflow">case</span> 1:
<a name="l00341"></a>00341         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() -len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() +len; p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00342"></a>00342         <span class="keywordflow">break</span>;
<a name="l00343"></a>00343       <span class="keywordflow">case</span> 2:
<a name="l00344"></a>00344         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() +len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>(); p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00345"></a>00345         <span class="keywordflow">break</span>;
<a name="l00346"></a>00346       <span class="keywordflow">case</span> 3:
<a name="l00347"></a>00347         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() -len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() - len; p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() +len;
<a name="l00348"></a>00348         <span class="keywordflow">break</span>;
<a name="l00349"></a>00349       <span class="keywordflow">case</span> 4:
<a name="l00350"></a>00350         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() +len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>(); p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00351"></a>00351         <span class="keywordflow">break</span>;
<a name="l00352"></a>00352       <span class="keywordflow">case</span> 5:
<a name="l00353"></a>00353         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() -len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>()+len; p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00354"></a>00354         <span class="keywordflow">break</span>;
<a name="l00355"></a>00355       <span class="keywordflow">case</span> 6:
<a name="l00356"></a>00356         p2.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() = p.<a class="code" href="classPoint.html#2a43e0fd54f9c85f89a2be1c1a33ba94">x</a>() +len; p2.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>() = p.<a class="code" href="classPoint.html#5cc2d97205183cc7fdb4c2901963c218">y</a>(); p2.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>() = p.<a class="code" href="classPoint.html#3028d6a9e29fe1f104e6ee2493ae723c">z</a>();
<a name="l00357"></a>00357         <span class="keywordflow">break</span>;
<a name="l00358"></a>00358       <span class="keywordflow">default</span>:
<a name="l00359"></a>00359         std::cerr &lt;&lt; <span class="stringliteral">"Wrong child number in "</span> &lt;&lt; __func__ &lt;&lt; std::endl;
<a name="l00360"></a>00360         assert(<span class="keyword">false</span>);
<a name="l00361"></a>00361         <span class="keywordflow">break</span>;
<a name="l00362"></a>00362     } <span class="comment">// switch (childNum)</span>
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a> = p2;
<a name="l00365"></a>00365   }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   <span class="comment">//This is for real octants only, pseudo-boundary octants can not be tested</span>
<a name="l00368"></a>00368   <span class="comment">//using this. </span>
<a name="l00369"></a><a class="code" href="classot_1_1DA.html#d58df7236ef626ede28d55c882b3ee10">00369</a>   <span class="keywordtype">bool</span> <a class="code" href="classot_1_1DA.html#d58df7236ef626ede28d55c882b3ee10">DA::isBoundaryOctant</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *flags) {
<a name="l00370"></a>00370 <span class="preprocessor">#ifdef __DEBUG_DA_PUBLIC__</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>    assert(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>);
<a name="l00372"></a>00372 <span class="preprocessor">#endif</span>
<a name="l00373"></a>00373 <span class="preprocessor"></span>
<a name="l00374"></a>00374     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> _flags = 0;
<a name="l00375"></a>00375     <a class="code" href="classPoint.html">Point</a> pt = <a class="code" href="classot_1_1DA.html#e3a7098e37e26600235a69ab5d05e226">getCurrentOffset</a>();
<a name="l00376"></a>00376     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = pt.<a class="code" href="classPoint.html#2038bd17c3cc6fb62cedae6498652720">xint</a>();
<a name="l00377"></a>00377     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = pt.<a class="code" href="classPoint.html#dba12524735f18d5411660907975f887">yint</a>();
<a name="l00378"></a>00378     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z = pt.<a class="code" href="classPoint.html#c0d13f9086d122f107181d4b69c16427">zint</a>();
<a name="l00379"></a>00379     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = <a class="code" href="classot_1_1DA.html#f4bee91c22427cf82991a9e19b2089bd">getLevel</a>(<a class="code" href="classot_1_1DA.html#91a567428851441c716250e60c93d065">curr</a>())-1;
<a name="l00380"></a>00380     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxD = <a class="code" href="classot_1_1DA.html#f82f97af59d18d222fadc2d1fe4e8357">getMaxDepth</a>()-1;
<a name="l00381"></a>00381     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len  = (<span class="keywordtype">unsigned</span> int)(1u&lt;&lt;(maxD - d) );
<a name="l00382"></a>00382     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> blen = (<span class="keywordtype">unsigned</span> int)(1u &lt;&lt; maxD);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <span class="keywordflow">if</span> (!x) _flags |= <a class="code" href="classot_1_1TreeNode.html#b18332d25d9c114d6b9a1df61b8f1f6e11be5313a5dbf01dd90c01e883ece0b3">ot::TreeNode::X_NEG_BDY</a>;  
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (!y) _flags |=  <a class="code" href="classot_1_1TreeNode.html#b18332d25d9c114d6b9a1df61b8f1f6ef2f28472ee1808d062cb927eb87771f7">ot::TreeNode::Y_NEG_BDY</a>; 
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (!z) _flags |=   <a class="code" href="classot_1_1TreeNode.html#b18332d25d9c114d6b9a1df61b8f1f6e23c8d0b18ff958b51639cd5e9be67557">ot::TreeNode::Z_NEG_BDY</a>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">if</span> ( (x+len) == blen )  _flags |= <a class="code" href="classot_1_1TreeNode.html#b18332d25d9c114d6b9a1df61b8f1f6e9f64a02e2b247a59544ee302f0895b86">ot::TreeNode::X_POS_BDY</a>;
<a name="l00389"></a>00389     <span class="keywordflow">if</span> ( (y+len) == blen )  _flags |= <a class="code" href="classot_1_1TreeNode.html#b18332d25d9c114d6b9a1df61b8f1f6e20d1430fe5ac3173b35844dcf5011e7c">ot::TreeNode::Y_POS_BDY</a>;
<a name="l00390"></a>00390     <span class="keywordflow">if</span> ( (z+len) == blen )  _flags |= <a class="code" href="classot_1_1TreeNode.html#b18332d25d9c114d6b9a1df61b8f1f6ea96ac7e399ba035435d177fd8f08b088">ot::TreeNode::Z_POS_BDY</a>;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     <span class="keywordflow">if</span>(flags) {
<a name="l00393"></a>00393       *flags = _flags;
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395     <span class="keywordflow">return</span> _flags;
<a name="l00396"></a>00396   }<span class="comment">//end function</span>
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   <span class="comment">/***************** Array Access ********************/</span>
<a name="l00399"></a><a class="code" href="classot_1_1DA.html#2db4f2bd56cfb37627b8204502754fd1">00399</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#2db4f2bd56cfb37627b8204502754fd1">DA::createMatrix</a>(Mat &amp;M, MatType mtype, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof) {
<a name="l00400"></a>00400     <span class="comment">// first determine the size ...</span>
<a name="l00401"></a>00401     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sz = 0;
<a name="l00402"></a>00402     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00403"></a>00403       sz = dof*(<a class="code" href="classot_1_1DA.html#ffd578ece2a48620101fc61974b6e594">m_uiNodeSize</a> + <a class="code" href="classot_1_1DA.html#178745a9bfdd853a4a258628c48d884d">m_uiBoundaryNodeSize</a>);
<a name="l00404"></a>00404     }<span class="comment">//end if active</span>
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="comment">// now create the PETSc Mat</span>
<a name="l00407"></a>00407     <span class="comment">// The "parallel direct solver" matrix types like MATAIJSPOOLES are ALL gone in petsc-3.0.0</span>
<a name="l00408"></a>00408     <span class="comment">// Thus, I (Ilya Lashuk) "delete" all such checks for matrix type.  Hope it is reasonable thing to do.</span>
<a name="l00409"></a>00409     PetscTruth isAij, isAijSeq, isAijPrl, isSuperLU, isSuperLU_Dist;
<a name="l00410"></a>00410     PetscStrcmp(mtype,MATAIJ,&amp;isAij);
<a name="l00411"></a>00411     PetscStrcmp(mtype,MATSEQAIJ,&amp;isAijSeq);
<a name="l00412"></a>00412     PetscStrcmp(mtype,MATMPIAIJ,&amp;isAijPrl);
<a name="l00413"></a>00413     isSuperLU = PETSC_FALSE; <span class="comment">// PetscStrcmp(mtype,MATSUPERLU,&amp;isSuperLU);</span>
<a name="l00414"></a>00414     isSuperLU_Dist = PETSC_FALSE; <span class="comment">// PetscStrcmp(mtype,MATSUPERLU_DIST,&amp;isSuperLU_Dist);</span>
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     MatCreate(<a class="code" href="classot_1_1DA.html#9f1f9c40b64a254ac11ca705b88d8387">m_mpiCommAll</a>, &amp;M);
<a name="l00417"></a>00417     MatSetSizes(M, sz,sz, PETSC_DECIDE, PETSC_DECIDE);
<a name="l00418"></a>00418     MatSetType(M,mtype);
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keywordflow">if</span>(isAij || isAijSeq || isAijPrl || isSuperLU || isSuperLU_Dist) {
<a name="l00421"></a>00421       <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#132d457a077d68605a5a980a3f3e1822">m_iNpesAll</a> &gt; 1) {
<a name="l00422"></a>00422         MatMPIAIJSetPreallocation(M, 53*dof , PETSC_NULL, 53*dof , PETSC_NULL);
<a name="l00423"></a>00423       }<span class="keywordflow">else</span> {
<a name="l00424"></a>00424         MatSeqAIJSetPreallocation(M, 53*dof , PETSC_NULL);
<a name="l00425"></a>00425       }
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <span class="keywordflow">return</span> 0;
<a name="l00429"></a>00429   }<span class="comment">//end function</span>
<a name="l00430"></a>00430 
<a name="l00431"></a><a class="code" href="classot_1_1DA.html#8fc9a5364073be62ce8f6154e09d6d56">00431</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#8fc9a5364073be62ce8f6154e09d6d56">DA::createActiveMatrix</a>(Mat &amp;M, MatType mtype, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof) {
<a name="l00432"></a>00432     <span class="comment">// first determine the size ...</span>
<a name="l00433"></a>00433     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sz = 0;
<a name="l00434"></a>00434     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00435"></a>00435       sz = dof*(<a class="code" href="classot_1_1DA.html#ffd578ece2a48620101fc61974b6e594">m_uiNodeSize</a> + <a class="code" href="classot_1_1DA.html#178745a9bfdd853a4a258628c48d884d">m_uiBoundaryNodeSize</a>);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437       <span class="comment">// now create the PETSc Mat</span>
<a name="l00438"></a>00438       PetscTruth isAij, isAijSeq, isAijPrl, isSuperLU, isSuperLU_Dist;
<a name="l00439"></a>00439       PetscStrcmp(mtype,MATAIJ,&amp;isAij);
<a name="l00440"></a>00440       PetscStrcmp(mtype,MATSEQAIJ,&amp;isAijSeq);
<a name="l00441"></a>00441       PetscStrcmp(mtype,MATMPIAIJ,&amp;isAijPrl);
<a name="l00442"></a>00442       isSuperLU = PETSC_FALSE; <span class="comment">//PetscStrcmp(mtype,MATSUPERLU,&amp;isSuperLU);</span>
<a name="l00443"></a>00443       isSuperLU_Dist = PETSC_FALSE; <span class="comment">//PetscStrcmp(mtype,MATSUPERLU_DIST,&amp;isSuperLU_Dist);</span>
<a name="l00444"></a>00444 
<a name="l00445"></a>00445       MatCreate(<a class="code" href="classot_1_1DA.html#045d787547f61d31379f4b02a867c89a">m_mpiCommActive</a>, &amp;M);
<a name="l00446"></a>00446       MatSetSizes(M, sz,sz, PETSC_DECIDE, PETSC_DECIDE);
<a name="l00447"></a>00447       MatSetType(M,mtype);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449       <span class="keywordflow">if</span>(isAij || isAijSeq || isAijPrl || isSuperLU || isSuperLU_Dist) {
<a name="l00450"></a>00450         <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#155de256c071717644c4ba2f5f643be7">m_iNpesActive</a> &gt; 1) {
<a name="l00451"></a>00451           MatMPIAIJSetPreallocation(M, 53*dof , PETSC_NULL, 53*dof , PETSC_NULL);
<a name="l00452"></a>00452         }<span class="keywordflow">else</span> {
<a name="l00453"></a>00453           MatSeqAIJSetPreallocation(M, 53*dof , PETSC_NULL);
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455       }
<a name="l00456"></a>00456     }<span class="comment">//end if active</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="keywordflow">return</span> 0;
<a name="l00459"></a>00459   }<span class="comment">//end function</span>
<a name="l00460"></a>00460 
<a name="l00461"></a><a class="code" href="classot_1_1DA.html#073a0d74985c85a188f59de582006a01">00461</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#073a0d74985c85a188f59de582006a01">DA::createVector</a>(Vec &amp;arr, <span class="keywordtype">bool</span> isElemental, <span class="keywordtype">bool</span> isGhosted, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof) {
<a name="l00462"></a>00462     <span class="comment">// first determine the length of the vector ...</span>
<a name="l00463"></a>00463     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sz = 0;
<a name="l00464"></a>00464     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00465"></a>00465       <span class="keywordflow">if</span> (isElemental) {
<a name="l00466"></a>00466         sz = <a class="code" href="classot_1_1DA.html#316fa899531a2eaf1ed039583580d431">m_uiElementSize</a>;
<a name="l00467"></a>00467         <span class="keywordflow">if</span> (isGhosted) {
<a name="l00468"></a>00468           sz += (<a class="code" href="classot_1_1DA.html#7cdd60ba0d53e89894b4f4a28cfa1403">m_uiPreGhostElementSize</a>);
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470       } <span class="keywordflow">else</span> {
<a name="l00471"></a>00471         sz = <a class="code" href="classot_1_1DA.html#ffd578ece2a48620101fc61974b6e594">m_uiNodeSize</a> + <a class="code" href="classot_1_1DA.html#178745a9bfdd853a4a258628c48d884d">m_uiBoundaryNodeSize</a>;
<a name="l00472"></a>00472         <span class="keywordflow">if</span> (isGhosted) {
<a name="l00473"></a>00473           sz += (<a class="code" href="classot_1_1DA.html#4acaa17153e51832bbad68de95c0f661">m_uiPreGhostNodeSize</a> + <a class="code" href="classot_1_1DA.html#4f42e5f1333ff8b4e9fa2f4177deaf42">m_uiPreGhostBoundaryNodeSize</a> + <a class="code" href="classot_1_1DA.html#2fdec1f3f79683ea29581c718b8b9248">m_uiPostGhostNodeSize</a>);
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476       <span class="comment">// now for dof ...</span>
<a name="l00477"></a>00477       sz *= dof;
<a name="l00478"></a>00478     }<span class="comment">//end if active</span>
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="comment">// now create the PETSc Vector</span>
<a name="l00481"></a>00481     VecCreate(<a class="code" href="classot_1_1DA.html#9f1f9c40b64a254ac11ca705b88d8387">m_mpiCommAll</a>, &amp;arr);
<a name="l00482"></a>00482     VecSetSizes(arr, sz, PETSC_DECIDE);
<a name="l00483"></a>00483     <span class="keywordflow">if</span> (<a class="code" href="classot_1_1DA.html#132d457a077d68605a5a980a3f3e1822">m_iNpesAll</a> &gt; 1) {
<a name="l00484"></a>00484       VecSetType(arr,VECMPI);
<a name="l00485"></a>00485     } <span class="keywordflow">else</span> {
<a name="l00486"></a>00486       VecSetType(arr,VECSEQ);
<a name="l00487"></a>00487     }    
<a name="l00488"></a>00488     <span class="keywordflow">return</span> 0;
<a name="l00489"></a>00489   }
<a name="l00490"></a>00490 
<a name="l00491"></a><a class="code" href="classot_1_1DA.html#a53482772b07aebda43739e15fb596fa">00491</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#a53482772b07aebda43739e15fb596fa">DA::createActiveVector</a>(Vec &amp;arr, <span class="keywordtype">bool</span> isElemental, <span class="keywordtype">bool</span> isGhosted, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof) {
<a name="l00492"></a>00492     <span class="comment">// first determine the length of the vector ...</span>
<a name="l00493"></a>00493     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sz = 0;
<a name="l00494"></a>00494     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00495"></a>00495       <span class="keywordflow">if</span> (isElemental) {
<a name="l00496"></a>00496         sz = <a class="code" href="classot_1_1DA.html#316fa899531a2eaf1ed039583580d431">m_uiElementSize</a>;
<a name="l00497"></a>00497         <span class="keywordflow">if</span> (isGhosted) {
<a name="l00498"></a>00498           sz += (<a class="code" href="classot_1_1DA.html#7cdd60ba0d53e89894b4f4a28cfa1403">m_uiPreGhostElementSize</a>);
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500       } <span class="keywordflow">else</span> {
<a name="l00501"></a>00501         sz = <a class="code" href="classot_1_1DA.html#ffd578ece2a48620101fc61974b6e594">m_uiNodeSize</a> + <a class="code" href="classot_1_1DA.html#178745a9bfdd853a4a258628c48d884d">m_uiBoundaryNodeSize</a>;
<a name="l00502"></a>00502         <span class="keywordflow">if</span> (isGhosted) {
<a name="l00503"></a>00503           sz += (<a class="code" href="classot_1_1DA.html#4acaa17153e51832bbad68de95c0f661">m_uiPreGhostNodeSize</a> + <a class="code" href="classot_1_1DA.html#4f42e5f1333ff8b4e9fa2f4177deaf42">m_uiPreGhostBoundaryNodeSize</a> + <a class="code" href="classot_1_1DA.html#2fdec1f3f79683ea29581c718b8b9248">m_uiPostGhostNodeSize</a>);
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505       }
<a name="l00506"></a>00506       <span class="comment">// now for dof ...</span>
<a name="l00507"></a>00507       sz *= dof;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509       <span class="comment">// now create the PETSc Vector</span>
<a name="l00510"></a>00510       VecCreate(<a class="code" href="classot_1_1DA.html#045d787547f61d31379f4b02a867c89a">m_mpiCommActive</a>, &amp;arr);
<a name="l00511"></a>00511       VecSetSizes(arr, sz, PETSC_DECIDE);
<a name="l00512"></a>00512       <span class="keywordflow">if</span> (<a class="code" href="classot_1_1DA.html#155de256c071717644c4ba2f5f643be7">m_iNpesActive</a> &gt; 1) {
<a name="l00513"></a>00513         VecSetType(arr, VECMPI);
<a name="l00514"></a>00514       } <span class="keywordflow">else</span> {
<a name="l00515"></a>00515         VecSetType(arr, VECSEQ);
<a name="l00516"></a>00516       }    
<a name="l00517"></a>00517     }<span class="comment">//end if active</span>
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordflow">return</span> 0;
<a name="l00520"></a>00520   }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522   <span class="comment">// Obtains a ot::index aligned buffer of the Vector</span>
<a name="l00523"></a><a class="code" href="classot_1_1DA.html#b3795ed86c2a14e75790d626426637cf">00523</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#b3795ed86c2a14e75790d626426637cf">DA::vecGetBuffer</a>(Vec in, PetscScalar* &amp;out, <span class="keywordtype">bool</span> isElemental, <span class="keywordtype">bool</span> isGhosted,
<a name="l00524"></a>00524       <span class="keywordtype">bool</span> isReadOnly, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof) {
<a name="l00525"></a>00525     <span class="comment">// Some error checks ... make sure the size of Vec in matches those implied</span>
<a name="l00526"></a>00526     <span class="comment">// by the other params ...</span>
<a name="l00527"></a>00527     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sz = 0;
<a name="l00528"></a>00528     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00529"></a>00529       <span class="keywordflow">if</span> (isElemental) {
<a name="l00530"></a>00530         sz = <a class="code" href="classot_1_1DA.html#316fa899531a2eaf1ed039583580d431">m_uiElementSize</a>;
<a name="l00531"></a>00531         <span class="keywordflow">if</span> (isGhosted) {
<a name="l00532"></a>00532           sz += <a class="code" href="classot_1_1DA.html#7cdd60ba0d53e89894b4f4a28cfa1403">m_uiPreGhostElementSize</a>;
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534       } <span class="keywordflow">else</span> {
<a name="l00535"></a>00535         sz = <a class="code" href="classot_1_1DA.html#ffd578ece2a48620101fc61974b6e594">m_uiNodeSize</a> + <a class="code" href="classot_1_1DA.html#178745a9bfdd853a4a258628c48d884d">m_uiBoundaryNodeSize</a>;
<a name="l00536"></a>00536         <span class="keywordflow">if</span> (isGhosted) {
<a name="l00537"></a>00537           sz += (<a class="code" href="classot_1_1DA.html#4acaa17153e51832bbad68de95c0f661">m_uiPreGhostNodeSize</a> + <a class="code" href="classot_1_1DA.html#4f42e5f1333ff8b4e9fa2f4177deaf42">m_uiPreGhostBoundaryNodeSize</a> + <a class="code" href="classot_1_1DA.html#2fdec1f3f79683ea29581c718b8b9248">m_uiPostGhostNodeSize</a>);
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539       }
<a name="l00540"></a>00540       <span class="comment">// now for dof ...</span>
<a name="l00541"></a>00541       sz *= dof;
<a name="l00542"></a>00542     }<span class="comment">//end if active</span>
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     PetscInt vecSz=0;
<a name="l00545"></a>00545     VecGetLocalSize(in, &amp;vecSz);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <span class="keywordflow">if</span> ( sz != vecSz) {
<a name="l00548"></a>00548       std::cerr  &lt;&lt; <a class="code" href="classot_1_1DA.html#e34a09c8e0884eccaa493c8d72f8b364">m_iRankAll</a> &lt;&lt; <span class="stringliteral">": In function "</span> &lt;&lt; __func__ &lt;&lt; <span class="stringliteral">" sizes are unequal, sz is  "</span> 
<a name="l00549"></a>00549         &lt;&lt; sz &lt;&lt; <span class="stringliteral">" and vecSz is "</span> &lt;&lt; vecSz &lt;&lt; std::endl;
<a name="l00550"></a>00550       std::cerr &lt;&lt; <span class="stringliteral">"Params are: isElem "</span> &lt;&lt; isElemental &lt;&lt; <span class="stringliteral">" isGhosted "</span> &lt;&lt; isGhosted &lt;&lt; std::endl;
<a name="l00551"></a>00551       assert(<span class="keyword">false</span>);
<a name="l00552"></a>00552       <span class="keywordflow">return</span> -1;; 
<a name="l00553"></a>00553     };
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     <span class="keywordflow">if</span>(!<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00556"></a>00556       assert(<a class="code" href="classot_1_1DA.html#ee267aceeaeac5b4fd2ac15f8d3d3ee1">m_uiLocalBufferSize</a> == 0);
<a name="l00557"></a>00557       assert(<a class="code" href="classot_1_1DA.html#ec575a8d42f1a5de683e2598f2872e52">m_uiElementBegin</a> == 0);
<a name="l00558"></a>00558       assert(<a class="code" href="classot_1_1DA.html#7663ba260ee97dcc80c083c9ab841f49">m_uiElementEnd</a> == 0);
<a name="l00559"></a>00559       assert(<a class="code" href="classot_1_1DA.html#c725550f5361a5fb7664c89b685f0b36">m_uiPostGhostBegin</a> == 0);
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     <span class="comment">// get the local Petsc Arrray,</span>
<a name="l00563"></a>00563     PetscScalar *array = NULL;
<a name="l00564"></a>00564     VecGetArray(in, &amp;array);
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="comment">// allocate except for the case of ghosted-elemental vectors...</span>
<a name="l00567"></a>00567     <span class="keywordflow">if</span>(isGhosted &amp;&amp; isElemental) {
<a name="l00568"></a>00568       <span class="comment">//simply copy the pointer</span>
<a name="l00569"></a>00569       <span class="comment">//This is the only case where the buffer will not be the size of the</span>
<a name="l00570"></a>00570       <span class="comment">//fullLocalBufferSize. </span>
<a name="l00571"></a>00571       out = array;
<a name="l00572"></a>00572     }<span class="keywordflow">else</span> {
<a name="l00573"></a>00573       <span class="comment">// First let us allocate for the buffer ... the local buffer will be of full</span>
<a name="l00574"></a>00574       <span class="comment">// length.</span>
<a name="l00575"></a>00575       sz = dof*<a class="code" href="classot_1_1DA.html#ee267aceeaeac5b4fd2ac15f8d3d3ee1">m_uiLocalBufferSize</a>;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577       <span class="keywordflow">if</span>(sz) {
<a name="l00578"></a>00578         out = <span class="keyword">new</span> PetscScalar[sz];
<a name="l00579"></a>00579         assert(out);
<a name="l00580"></a>00580       }<span class="keywordflow">else</span> {
<a name="l00581"></a>00581         out = NULL;
<a name="l00582"></a>00582       }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584       <span class="comment">//Zero Entries first if you plan to modify the buffer </span>
<a name="l00585"></a>00585       <span class="keywordflow">if</span>(!isReadOnly) {
<a name="l00586"></a>00586         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sz; i++) {
<a name="l00587"></a>00587           out[i] = 0.0;
<a name="l00588"></a>00588         }
<a name="l00589"></a>00589       }
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vecCnt=0;
<a name="l00593"></a>00593     <span class="comment">// Now we can populate the out buffer ... and that needs a loop through the</span>
<a name="l00594"></a>00594     <span class="comment">// elements ...</span>
<a name="l00595"></a>00595     <span class="keywordflow">if</span> (isGhosted) {
<a name="l00596"></a>00596       <span class="keywordflow">if</span> (isElemental) {
<a name="l00597"></a>00597         <span class="comment">//Nothing to be done here.</span>
<a name="l00598"></a>00598       } <span class="keywordflow">else</span> {
<a name="l00599"></a>00599         <span class="comment">// now copy ...</span>
<a name="l00600"></a>00600         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classot_1_1DA.html#ee267aceeaeac5b4fd2ac15f8d3d3ee1">m_uiLocalBufferSize</a>; i++) {
<a name="l00601"></a>00601           <span class="comment">// skip the ones that are not nodes ...</span>
<a name="l00602"></a>00602           <span class="keywordflow">if</span> ( ! (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[i] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf8f70c442b84b886210653a9d4663e3184">ot::TreeNode::NODE</a> ) ) {
<a name="l00603"></a>00603             <span class="keywordflow">continue</span>;
<a name="l00604"></a>00604           }
<a name="l00605"></a>00605           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;dof; j++) {
<a name="l00606"></a>00606             out[dof*i+j] = array[dof*vecCnt + j];
<a name="l00607"></a>00607           }
<a name="l00608"></a>00608           vecCnt++;
<a name="l00609"></a>00609         }<span class="comment">//end for i</span>
<a name="l00610"></a>00610       }<span class="comment">//end if elemental</span>
<a name="l00611"></a>00611     } <span class="keywordflow">else</span> {
<a name="l00612"></a>00612       <span class="keywordflow">if</span> (isElemental) {
<a name="l00613"></a>00613         <span class="comment">// is a simple copy ...</span>
<a name="l00614"></a>00614         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = <a class="code" href="classot_1_1DA.html#ec575a8d42f1a5de683e2598f2872e52">m_uiElementBegin</a>; i &lt; <a class="code" href="classot_1_1DA.html#7663ba260ee97dcc80c083c9ab841f49">m_uiElementEnd</a>; i++) {
<a name="l00615"></a>00615           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; dof; j++) {
<a name="l00616"></a>00616             out[dof*i+j] = array[dof*vecCnt + j];
<a name="l00617"></a>00617           }
<a name="l00618"></a>00618           vecCnt++;
<a name="l00619"></a>00619         }<span class="comment">//end for i</span>
<a name="l00620"></a>00620       } <span class="keywordflow">else</span> {
<a name="l00621"></a>00621         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = <a class="code" href="classot_1_1DA.html#ec575a8d42f1a5de683e2598f2872e52">m_uiElementBegin</a>; i &lt; <a class="code" href="classot_1_1DA.html#7663ba260ee97dcc80c083c9ab841f49">m_uiElementEnd</a>; i++) {
<a name="l00622"></a>00622           <span class="keywordflow">if</span> ( ! (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[i] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf8f70c442b84b886210653a9d4663e3184">ot::TreeNode::NODE</a> ) ) {
<a name="l00623"></a>00623             <span class="keywordflow">continue</span>;
<a name="l00624"></a>00624           }
<a name="l00625"></a>00625           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;dof; j++) {
<a name="l00626"></a>00626             out[dof*i+j] = array[dof*vecCnt + j];
<a name="l00627"></a>00627           }
<a name="l00628"></a>00628           vecCnt++;
<a name="l00629"></a>00629         }<span class="comment">//end for i</span>
<a name="l00630"></a>00630         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = m_uiElementEnd; i &lt; <a class="code" href="classot_1_1DA.html#c725550f5361a5fb7664c89b685f0b36">m_uiPostGhostBegin</a>; i++) {
<a name="l00631"></a>00631           <span class="comment">// add the remaining boundary nodes ...</span>
<a name="l00632"></a>00632           <span class="keywordflow">if</span> ( ! ( (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[i] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf8f70c442b84b886210653a9d4663e3184">ot::TreeNode::NODE</a> ) &amp;&amp;
<a name="l00633"></a>00633                 (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[i] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf80696c30ddbe9ec3ea80a7e88f5c24e0a">ot::TreeNode::BOUNDARY</a> ) ) ) {
<a name="l00634"></a>00634             <span class="keywordflow">continue</span>;
<a name="l00635"></a>00635           }
<a name="l00636"></a>00636           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;dof; j++) {
<a name="l00637"></a>00637             out[dof*i+j] = array[dof*vecCnt + j];
<a name="l00638"></a>00638           }
<a name="l00639"></a>00639           vecCnt++;
<a name="l00640"></a>00640         }<span class="comment">//end for i</span>
<a name="l00641"></a>00641       }
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="keywordflow">if</span>(!(isGhosted &amp;&amp; isElemental)) {
<a name="l00645"></a>00645       VecRestoreArray(in, &amp;array);
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     <span class="keywordflow">return</span> 0;
<a name="l00649"></a>00649   }
<a name="l00650"></a>00650 
<a name="l00651"></a><a class="code" href="classot_1_1DA.html#27cec1eec5bec26ae265fd10e40692c1">00651</a>   <span class="keywordtype">int</span> <a class="code" href="classot_1_1DA.html#27cec1eec5bec26ae265fd10e40692c1">DA::vecRestoreBuffer</a>(Vec in, PetscScalar* out, <span class="keywordtype">bool</span> isElemental, <span class="keywordtype">bool</span> isGhosted, <span class="keywordtype">bool</span> isReadOnly, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof) {
<a name="l00652"></a>00652     <span class="comment">// Some error checks ... make sure the size of Vec in matches those implied</span>
<a name="l00653"></a>00653     <span class="comment">// by the other params ...</span>
<a name="l00654"></a>00654     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sz = 0;
<a name="l00655"></a>00655     <span class="keywordflow">if</span>(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00656"></a>00656       <span class="keywordflow">if</span> (isElemental) {
<a name="l00657"></a>00657         sz = <a class="code" href="classot_1_1DA.html#316fa899531a2eaf1ed039583580d431">m_uiElementSize</a>;
<a name="l00658"></a>00658         <span class="keywordflow">if</span> (isGhosted) {
<a name="l00659"></a>00659           sz += <a class="code" href="classot_1_1DA.html#7cdd60ba0d53e89894b4f4a28cfa1403">m_uiPreGhostElementSize</a>;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661       } <span class="keywordflow">else</span> {
<a name="l00662"></a>00662         sz = <a class="code" href="classot_1_1DA.html#ffd578ece2a48620101fc61974b6e594">m_uiNodeSize</a> + <a class="code" href="classot_1_1DA.html#178745a9bfdd853a4a258628c48d884d">m_uiBoundaryNodeSize</a>;
<a name="l00663"></a>00663         <span class="keywordflow">if</span> (isGhosted) {
<a name="l00664"></a>00664           sz += (<a class="code" href="classot_1_1DA.html#4acaa17153e51832bbad68de95c0f661">m_uiPreGhostNodeSize</a> + <a class="code" href="classot_1_1DA.html#4f42e5f1333ff8b4e9fa2f4177deaf42">m_uiPreGhostBoundaryNodeSize</a> + <a class="code" href="classot_1_1DA.html#2fdec1f3f79683ea29581c718b8b9248">m_uiPostGhostNodeSize</a>);
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666       }
<a name="l00667"></a>00667       <span class="comment">// now for dof ...</span>
<a name="l00668"></a>00668       sz *= dof;
<a name="l00669"></a>00669     }<span class="comment">//end if active</span>
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     PetscInt vecSz=0;
<a name="l00672"></a>00672     VecGetLocalSize(in, &amp;vecSz);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674     <span class="keywordflow">if</span> ( sz != vecSz) {
<a name="l00675"></a>00675       std::cerr  &lt;&lt; <a class="code" href="colors_8h.html#61ef7a1b5082f8dc3761eec9833867c3">RED</a>&lt;&lt;<span class="stringliteral">"In function PETSc::"</span> &lt;&lt; __func__ &lt;&lt;
<a name="l00676"></a>00676         <a class="code" href="colors_8h.html#a15368f9f838e27e7fab6d2a6379e7a1">NRM</a>&lt;&lt;<span class="stringliteral">" sizes are unequal, sz is  "</span> &lt;&lt; sz &lt;&lt; <span class="stringliteral">" and vecSz is "</span> &lt;&lt; vecSz &lt;&lt; std::endl;
<a name="l00677"></a>00677       std::cerr &lt;&lt; <span class="stringliteral">"Params are: isElem "</span> &lt;&lt; isElemental &lt;&lt; <span class="stringliteral">" isGhosted "</span> &lt;&lt; isGhosted &lt;&lt; std::endl;
<a name="l00678"></a>00678       assert(<span class="keyword">false</span>);
<a name="l00679"></a>00679       <span class="keywordflow">return</span> -1;;
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682     <span class="keywordflow">if</span>(!<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>) {
<a name="l00683"></a>00683       assert(<a class="code" href="classot_1_1DA.html#ee267aceeaeac5b4fd2ac15f8d3d3ee1">m_uiLocalBufferSize</a> == 0);
<a name="l00684"></a>00684       assert(<a class="code" href="classot_1_1DA.html#ec575a8d42f1a5de683e2598f2872e52">m_uiElementBegin</a> == 0);
<a name="l00685"></a>00685       assert(<a class="code" href="classot_1_1DA.html#7663ba260ee97dcc80c083c9ab841f49">m_uiElementEnd</a> == 0);
<a name="l00686"></a>00686       assert(<a class="code" href="classot_1_1DA.html#c725550f5361a5fb7664c89b685f0b36">m_uiPostGhostBegin</a> == 0);
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vecCnt=0;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     <span class="keywordflow">if</span>(isGhosted &amp;&amp; isElemental) {
<a name="l00692"></a>00692       <span class="comment">//If it is ghosted and elemental, simply restore the array.</span>
<a name="l00693"></a>00693       <span class="comment">//out was not allocated expicitly in this case. It was just a copy of the</span>
<a name="l00694"></a>00694       <span class="comment">//array's pointer. The readOnly flag is immaterial for this case.</span>
<a name="l00695"></a>00695       VecRestoreArray(in, &amp;out);
<a name="l00696"></a>00696       out = NULL;
<a name="l00697"></a>00697     }  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isReadOnly ) {
<a name="l00698"></a>00698       <span class="comment">// no need to write back ... simply clean up and return</span>
<a name="l00699"></a>00699       <span class="comment">//Since this is not an elemental and ghosted vector, out was allocated</span>
<a name="l00700"></a>00700       <span class="comment">//explicitly </span>
<a name="l00701"></a>00701       <span class="keywordflow">if</span>(out) {
<a name="l00702"></a>00702         <span class="keyword">delete</span> [] out;
<a name="l00703"></a>00703         out = NULL;
<a name="l00704"></a>00704       }
<a name="l00705"></a>00705     } <span class="keywordflow">else</span> {
<a name="l00706"></a>00706       <span class="comment">//ghosted and elemental is already taken care of. So only need to tackle</span>
<a name="l00707"></a>00707       <span class="comment">//the other 3 cases.</span>
<a name="l00708"></a>00708       <span class="comment">// need to write back ...</span>
<a name="l00709"></a>00709       <span class="comment">// get the local Petsc Arrray,</span>
<a name="l00710"></a>00710       PetscScalar *array;
<a name="l00711"></a>00711       VecGetArray(in, &amp;array);
<a name="l00712"></a>00712 
<a name="l00713"></a>00713       <span class="keywordflow">if</span> ( isElemental ) {
<a name="l00714"></a>00714         <span class="comment">//non-ghosted, elemental</span>
<a name="l00715"></a>00715         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = <a class="code" href="classot_1_1DA.html#ec575a8d42f1a5de683e2598f2872e52">m_uiElementBegin</a>; i &lt; <a class="code" href="classot_1_1DA.html#7663ba260ee97dcc80c083c9ab841f49">m_uiElementEnd</a>; i++) {
<a name="l00716"></a>00716           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;dof; j++) {
<a name="l00717"></a>00717             array[dof*vecCnt + j] = out[dof*i+j];
<a name="l00718"></a>00718           }
<a name="l00719"></a>00719           vecCnt++;
<a name="l00720"></a>00720         }
<a name="l00721"></a>00721       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isGhosted ) {
<a name="l00722"></a>00722         <span class="comment">// nodal and ghosted ...</span>
<a name="l00723"></a>00723         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;sz; i++) {
<a name="l00724"></a>00724           <span class="comment">// skip the ones that are not nodes ...</span>
<a name="l00725"></a>00725           <span class="keywordflow">if</span> ( ! (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[i] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf8f70c442b84b886210653a9d4663e3184">ot::TreeNode::NODE</a> ) ) {
<a name="l00726"></a>00726             <span class="keywordflow">continue</span>;
<a name="l00727"></a>00727           }
<a name="l00728"></a>00728           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;dof; j++) {
<a name="l00729"></a>00729             array[dof*vecCnt + j] = out[dof*i+j];
<a name="l00730"></a>00730           }
<a name="l00731"></a>00731           vecCnt++;
<a name="l00732"></a>00732         }
<a name="l00733"></a>00733       } <span class="keywordflow">else</span> {
<a name="l00734"></a>00734         <span class="comment">// nodal non ghosted ...</span>
<a name="l00735"></a>00735         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = <a class="code" href="classot_1_1DA.html#ec575a8d42f1a5de683e2598f2872e52">m_uiElementBegin</a>; i &lt; <a class="code" href="classot_1_1DA.html#7663ba260ee97dcc80c083c9ab841f49">m_uiElementEnd</a>; i++) {
<a name="l00736"></a>00736           <span class="keywordflow">if</span> ( ! (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[i] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf8f70c442b84b886210653a9d4663e3184">ot::TreeNode::NODE</a> ) ) {
<a name="l00737"></a>00737             <span class="keywordflow">continue</span>;
<a name="l00738"></a>00738           }
<a name="l00739"></a>00739           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;dof; j++) {
<a name="l00740"></a>00740             array[dof*vecCnt + j] = out[dof*i+j];
<a name="l00741"></a>00741           }
<a name="l00742"></a>00742           vecCnt++;
<a name="l00743"></a>00743         }
<a name="l00744"></a>00744         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = m_uiElementEnd; i &lt; <a class="code" href="classot_1_1DA.html#c725550f5361a5fb7664c89b685f0b36">m_uiPostGhostBegin</a>; i++) {
<a name="l00745"></a>00745           <span class="comment">// add the remaining boundary nodes ...</span>
<a name="l00746"></a>00746           <span class="keywordflow">if</span> ( ! ( (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[i] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf8f70c442b84b886210653a9d4663e3184">ot::TreeNode::NODE</a> ) &amp;&amp;
<a name="l00747"></a>00747                 (<a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[i] &amp; <a class="code" href="classot_1_1TreeNode.html#eb7e20b10a13a07386f6a940ae7aecf80696c30ddbe9ec3ea80a7e88f5c24e0a">ot::TreeNode::BOUNDARY</a> ) ) ) {
<a name="l00748"></a>00748             <span class="keywordflow">continue</span>;
<a name="l00749"></a>00749           }
<a name="l00750"></a>00750           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;dof; j++) {
<a name="l00751"></a>00751             array[dof*vecCnt + j] = out[dof*i+j];
<a name="l00752"></a>00752           }
<a name="l00753"></a>00753           vecCnt++;
<a name="l00754"></a>00754         }
<a name="l00755"></a>00755       }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757       VecRestoreArray(in, &amp;array);
<a name="l00758"></a>00758       <span class="comment">//Since this is not an elemental and ghosted vector, out was allocated</span>
<a name="l00759"></a>00759       <span class="comment">//explicitly </span>
<a name="l00760"></a>00760       <span class="keywordflow">if</span>(out) {
<a name="l00761"></a>00761         <span class="keyword">delete</span> [] out;
<a name="l00762"></a>00762         out = NULL;
<a name="l00763"></a>00763       }
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765     <span class="keywordflow">return</span> 0;
<a name="l00766"></a>00766   }
<a name="l00767"></a>00767 
<a name="l00768"></a><a class="code" href="classot_1_1DA.html#dabf8205e3e4742011df1708f2f25b06">00768</a>   <span class="keywordtype">void</span> <a class="code" href="classot_1_1DA.html#dabf8205e3e4742011df1708f2f25b06">DA::updateQuotientCounter</a>() {
<a name="l00769"></a>00769 <span class="preprocessor">#ifdef __DEBUG_DA_PUBLIC__</span>
<a name="l00770"></a>00770 <span class="preprocessor"></span>    assert(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>);
<a name="l00771"></a>00771 <span class="preprocessor">#endif</span>
<a name="l00772"></a>00772 <span class="preprocessor"></span>
<a name="l00773"></a>00773     <span class="comment">// m_ucpLutRemainders, m_uspLutQuotients.</span>
<a name="l00774"></a>00774     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> _mask = <a class="code" href="classot_1_1DA.html#38043349905c962a5712c899f0939f51">m_ucpLutMasksPtr</a>[2*<a class="code" href="classot_1_1DA.html#86b0739533537841acee7a7019dd0828">m_uiCurrent</a>];
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">// first let us get the offsets ..</span>
<a name="l00777"></a>00777     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; 8; j++) {
<a name="l00778"></a>00778       <span class="keywordflow">if</span> ( _mask &amp; (1 &lt;&lt; j ) ) {
<a name="l00779"></a>00779         <a class="code" href="classot_1_1DA.html#b237c370072e2803c0c632f76bb12f90">m_uiQuotientCounter</a>++;
<a name="l00780"></a>00780       }
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782   }
<a name="l00783"></a>00783 
<a name="l00784"></a><a class="code" href="classot_1_1DA.html#d8f0a54f94e0f0d46baf2f2399e78ce4">00784</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="classot_1_1DA.html#d8f0a54f94e0f0d46baf2f2399e78ce4">DA::getHangingNodeIndex</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i) {
<a name="l00785"></a>00785 <span class="preprocessor">#ifdef __DEBUG_DA_PUBLIC__</span>
<a name="l00786"></a>00786 <span class="preprocessor"></span>    assert(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>);
<a name="l00787"></a>00787 <span class="preprocessor">#endif</span>
<a name="l00788"></a>00788 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="classot_1_1DA.html#d4800b646ac8feee9e818a82bca36732">m_ucpLutMasks</a>[2*i + 1];
<a name="l00789"></a>00789   }
<a name="l00790"></a>00790 
<a name="l00791"></a><a class="code" href="classot_1_1DA.html#4e36781656573c11a96fbf6bc43849ad">00791</a>   <span class="keywordtype">void</span> <a class="code" href="classot_1_1DA.html#4e36781656573c11a96fbf6bc43849ad">DA::incrementPreGhostOffset</a>() {
<a name="l00792"></a>00792 <span class="preprocessor">#ifdef __DEBUG_DA_PUBLIC__</span>
<a name="l00793"></a>00793 <span class="preprocessor"></span>    assert(<a class="code" href="classot_1_1DA.html#8a28ff6ae91e463f9a3553688b11dc0f">m_bIamActive</a>);
<a name="l00794"></a>00794 <span class="preprocessor">#endif</span>
<a name="l00795"></a>00795 <span class="preprocessor"></span>
<a name="l00796"></a>00796     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = <a class="code" href="classot_1_1DA.html#89a36dd0d38c774b313933cb5900b866">m_ucpPreGhostConnectivity</a>[<a class="code" href="classot_1_1DA.html#86b0739533537841acee7a7019dd0828">m_uiCurrent</a>];
<a name="l00797"></a>00797     <span class="keywordflow">if</span> ( c ) {
<a name="l00798"></a>00798       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> nd = <a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[<a class="code" href="classot_1_1DA.html#86b0739533537841acee7a7019dd0828">m_uiCurrent</a>+1];
<a name="l00799"></a>00799       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cd = <a class="code" href="classot_1_1DA.html#d745e0a82b479322f687816c99354de8">m_ucpOctLevels</a>[<a class="code" href="classot_1_1DA.html#86b0739533537841acee7a7019dd0828">m_uiCurrent</a>];
<a name="l00800"></a>00800       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ns = (<span class="keywordtype">unsigned</span> int)(1u &lt;&lt; ( <a class="code" href="classot_1_1DA.html#74995e7d8504c75ec557b95588784355">m_uiMaxDepth</a> - nd ) );
<a name="l00801"></a>00801       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cs = (<span class="keywordtype">unsigned</span> int)(1u &lt;&lt; ( <a class="code" href="classot_1_1DA.html#74995e7d8504c75ec557b95588784355">m_uiMaxDepth</a> - cd ) );
<a name="l00802"></a>00802 
<a name="l00803"></a>00803       <a class="code" href="classPoint.html">Point</a> <a class="code" href="classot_1_1DA.html#91a567428851441c716250e60c93d065">curr</a> = <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a>;
<a name="l00804"></a>00804 
<a name="l00805"></a>00805       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cx = <a class="code" href="classot_1_1DA.html#91a567428851441c716250e60c93d065">curr</a>.xint();
<a name="l00806"></a>00806       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cy = <a class="code" href="classot_1_1DA.html#91a567428851441c716250e60c93d065">curr</a>.yint();
<a name="l00807"></a>00807       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cz = <a class="code" href="classot_1_1DA.html#91a567428851441c716250e60c93d065">curr</a>.zint();
<a name="l00808"></a>00808       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nx = cx;
<a name="l00809"></a>00809       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ny = cy;
<a name="l00810"></a>00810       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nz = cz;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812       <span class="comment">//_zzyyxxT</span>
<a name="l00813"></a>00813       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> xFlag = ((c &amp; (3&lt;&lt;1) ) &gt;&gt; 1);
<a name="l00814"></a>00814       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> yFlag = ((c &amp; (3&lt;&lt;3) ) &gt;&gt; 3);
<a name="l00815"></a>00815       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> zFlag = ((c &amp; (3&lt;&lt;5) ) &gt;&gt; 5);
<a name="l00816"></a>00816 
<a name="l00817"></a>00817       <span class="keywordflow">switch</span> (xFlag) {
<a name="l00818"></a>00818         <span class="keywordflow">case</span> 0: nx = cx;
<a name="l00819"></a>00819                 <span class="keywordflow">break</span>;
<a name="l00820"></a>00820         <span class="keywordflow">case</span> 1: nx = (cx - ns);
<a name="l00821"></a>00821                 <span class="keywordflow">break</span>;
<a name="l00822"></a>00822         <span class="keywordflow">case</span> 2: nx = (cx + cs); 
<a name="l00823"></a>00823                 <span class="keywordflow">break</span>;
<a name="l00824"></a>00824         <span class="keywordflow">case</span> 3: nx = (cx + cs - ns);
<a name="l00825"></a>00825                 <span class="keywordflow">break</span>;
<a name="l00826"></a>00826         <span class="keywordflow">default</span>: assert(<span class="keyword">false</span>);
<a name="l00827"></a>00827       }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829       <span class="keywordflow">switch</span> (yFlag) {
<a name="l00830"></a>00830         <span class="keywordflow">case</span> 0: ny = cy;
<a name="l00831"></a>00831                 <span class="keywordflow">break</span>;
<a name="l00832"></a>00832         <span class="keywordflow">case</span> 1: ny = (cy - ns);
<a name="l00833"></a>00833                 <span class="keywordflow">break</span>;
<a name="l00834"></a>00834         <span class="keywordflow">case</span> 2: ny = (cy + cs); 
<a name="l00835"></a>00835                 <span class="keywordflow">break</span>;
<a name="l00836"></a>00836         <span class="keywordflow">case</span> 3: ny = (cy + cs - ns); 
<a name="l00837"></a>00837                 <span class="keywordflow">break</span>;
<a name="l00838"></a>00838         <span class="keywordflow">default</span>: assert(<span class="keyword">false</span>);
<a name="l00839"></a>00839       }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841       <span class="keywordflow">switch</span> (zFlag) {
<a name="l00842"></a>00842         <span class="keywordflow">case</span> 0: nz = cz;
<a name="l00843"></a>00843                 <span class="keywordflow">break</span>;
<a name="l00844"></a>00844         <span class="keywordflow">case</span> 1: nz = (cz - ns); 
<a name="l00845"></a>00845                 <span class="keywordflow">break</span>;
<a name="l00846"></a>00846         <span class="keywordflow">case</span> 2: nz = (cz + cs); 
<a name="l00847"></a>00847                 <span class="keywordflow">break</span>;
<a name="l00848"></a>00848         <span class="keywordflow">case</span> 3: nz = (cz + cs - ns); 
<a name="l00849"></a>00849                 <span class="keywordflow">break</span>;
<a name="l00850"></a>00850         <span class="keywordflow">default</span>: assert(<span class="keyword">false</span>);
<a name="l00851"></a>00851       }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853       <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a> = <a class="code" href="classPoint.html">Point</a>(nx,ny,nz);    
<a name="l00854"></a>00854 
<a name="l00855"></a>00855     } <span class="keywordflow">else</span> {
<a name="l00856"></a>00856       <a class="code" href="classot_1_1DA.html#139610fdb424e691368c714376c5e9dd">m_ptCurrentOffset</a> = <a class="code" href="classot_1_1DA.html#51f31d5e07759bb653a9ccaca3f89752">m_ptsPreGhostOffsets</a>[<a class="code" href="classot_1_1DA.html#e176dac71679fcbc9e5d28366098e517">m_uiPreGhostQuotientCnt</a>++];     
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   }<span class="comment">//end function</span>
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 } <span class="comment">// end namespace ot</span>
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Mar 19 16:26:45 2010 for DENDRO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
