<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DENDRO: /net/ac190/www-db1/grads/r/rahulss/Dendro/examples/testElasMatVec.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a></div>
<h1>testElasMatVec.C</h1><a href="testElasMatVec_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="preprocessor">#include "mpi.h"</span>
00003 <span class="preprocessor">#include "petsc.h"</span>
00004 <span class="preprocessor">#include "<a class="code" href="sys_8h.html">sys.h</a>"</span>
00005 <span class="preprocessor">#include "<a class="code" href="parUtils_8h.html">parUtils.h</a>"</span>
00006 <span class="preprocessor">#include "<a class="code" href="octUtils_8h.html">octUtils.h</a>"</span>
00007 <span class="preprocessor">#include "<a class="code" href="TreeNode_8h.html">TreeNode.h</a>"</span>
00008 <span class="preprocessor">#include "<a class="code" href="omg_8h.html">omg.h</a>"</span>
00009 <span class="preprocessor">#include "<a class="code" href="handleStencils_8h.html">handleStencils.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="elasticityJac_8h.html">elasticityJac.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="omgJac_8h.html">omgJac.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="externVars_8h.html">externVars.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="dendro_8h.html">dendro.h</a>"</span>
00014 
00015 <span class="preprocessor">#ifdef MPI_WTIME_IS_GLOBAL</span>
00016 <span class="preprocessor"></span><span class="preprocessor">#undef MPI_WTIME_IS_GLOBAL</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00018 <span class="preprocessor"></span>
00019 <span class="preprocessor">#ifndef iC</span>
<a name="l00020"></a><a class="code" href="testElasMatVec_8C.html#a0">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define iC(fun) {CHKERRQ(fun);}</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00022 <span class="preprocessor"></span>
00023 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00024 <span class="preprocessor"></span><span class="keywordtype">int</span> elasticityDiagEvent;
00025 <span class="keywordtype">int</span> elasticityMultEvent;
00026 <span class="keywordtype">int</span> elasticityFinestDiagEvent;
00027 <span class="keywordtype">int</span> elasticityFinestMultEvent;
00028 
00029 <span class="keywordtype">int</span> vecMassDiagEvent;
00030 <span class="keywordtype">int</span> vecMassMultEvent;
00031 <span class="keywordtype">int</span> vecMassFinestDiagEvent;
00032 <span class="keywordtype">int</span> vecMassFinestMultEvent;
00033 <span class="preprocessor">#endif</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00036 <span class="preprocessor"></span><span class="comment">//user-defined variables</span>
00037 <span class="keywordtype">int</span> Jac1DiagEvent;
00038 <span class="keywordtype">int</span> Jac1MultEvent;
00039 <span class="keywordtype">int</span> Jac1FinestDiagEvent;
00040 <span class="keywordtype">int</span> Jac1FinestMultEvent;
00041 
00042 <span class="keywordtype">int</span> Jac2DiagEvent;
00043 <span class="keywordtype">int</span> Jac2MultEvent;
00044 <span class="keywordtype">int</span> Jac2FinestDiagEvent;
00045 <span class="keywordtype">int</span> Jac2FinestMultEvent;
00046 
00047 <span class="keywordtype">int</span> Jac3DiagEvent;
00048 <span class="keywordtype">int</span> Jac3MultEvent;
00049 <span class="keywordtype">int</span> Jac3FinestDiagEvent;
00050 <span class="keywordtype">int</span> Jac3FinestMultEvent;
00051 <span class="preprocessor">#endif</span>
00052 <span class="preprocessor"></span>
<a name="l00053"></a><a class="code" href="testElasMatVec_8C.html#a1">00053</a> <span class="keywordtype">double</span>***** LaplacianType1Stencil; 
<a name="l00054"></a><a class="code" href="testElasMatVec_8C.html#a2">00054</a> <span class="keywordtype">double</span>**** LaplacianType2Stencil; 
<a name="l00055"></a><a class="code" href="testElasMatVec_8C.html#a3">00055</a> <span class="keywordtype">double</span>***** MassType1Stencil; 
<a name="l00056"></a><a class="code" href="testElasMatVec_8C.html#a4">00056</a> <span class="keywordtype">double</span>**** MassType2Stencil; 
<a name="l00057"></a><a class="code" href="testElasMatVec_8C.html#a5">00057</a> <span class="keywordtype">double</span>****** ShapeFnStencil;
<a name="l00058"></a><a class="code" href="testElasMatVec_8C.html#a6">00058</a> <span class="keywordtype">double</span>**** ShapeFnCoeffs;
00059 
<a name="l00060"></a><a class="code" href="testElasMatVec_8C.html#a7">00060</a> <span class="keywordtype">double</span>**** GradDivType2Stencil; 
00061 
00062 <span class="keywordtype">double</span> <a class="code" href="testElasMatVec_8C.html#a8">gaussian</a>(<span class="keywordtype">double</span> mean, <span class="keywordtype">double</span> std_deviation);
00063 
<a name="l00064"></a><a class="code" href="testElasMatVec_8C.html#a9">00064</a> <span class="keywordtype">int</span> <a class="code" href="testShFn_8C.html#a8">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv ) {     
00065   <span class="keywordtype">int</span> size, rank;
00066   <span class="keywordtype">double</span> startTime, endTime;
00067   <span class="keywordtype">double</span> localTime, globalTime;
00068   <span class="keywordtype">double</span> gSize[3];
00069   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> local_num_pts = 5000;
00070   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 3;
00071   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxDepth = 30;
00072   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxNumPts = 1;
00073   <span class="keywordtype">bool</span> writePts = <span class="keyword">false</span>;
00074   <span class="keywordtype">bool</span> incCorner = 1;  
00075   <span class="keywordtype">bool</span> compressLut = <span class="keyword">false</span>;
00076   <span class="keywordtype">double</span> mgLoadFac = 2.0;
00077   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numLoops = 100;
00078   std::vector&lt;ot::TreeNode&gt; linOct;
00079   std::vector&lt;ot::TreeNode&gt; balOct;
00080   std::vector&lt;ot::TreeNode&gt; tmpNodes;
00081   std::vector&lt;double&gt; pts;
00082   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ptsLen;
00083   <a class="code" href="dendro_8h.html#a0">DendroIntL</a> localSz, totalSz;
00084 
00085   PetscInitialize(&amp;argc, &amp;argv, <span class="stringliteral">"options"</span>, NULL);
00086   <a class="code" href="namespaceot.html#a134">ot::RegisterEvents</a>();
00087 
00088 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00089 <span class="preprocessor"></span>  PetscLogEventRegister(&amp;Jac1DiagEvent,<span class="stringliteral">"ODAmatDiag"</span>,PETSC_VIEWER_COOKIE);
00090   PetscLogEventRegister(&amp;Jac1MultEvent,<span class="stringliteral">"ODAmatMult"</span>,PETSC_VIEWER_COOKIE);
00091   PetscLogEventRegister(&amp;Jac1FinestDiagEvent,<span class="stringliteral">"ODAmatDiagFinest"</span>,PETSC_VIEWER_COOKIE);
00092   PetscLogEventRegister(&amp;Jac1FinestMultEvent,<span class="stringliteral">"ODAmatMultFinest"</span>,PETSC_VIEWER_COOKIE);
00093 
00094   PetscLogEventRegister(&amp;Jac2DiagEvent,<span class="stringliteral">"OMGmatDiag-2"</span>,PETSC_VIEWER_COOKIE);
00095   PetscLogEventRegister(&amp;Jac2MultEvent,<span class="stringliteral">"OMGmatMult-2"</span>,PETSC_VIEWER_COOKIE);
00096   PetscLogEventRegister(&amp;Jac2FinestDiagEvent,<span class="stringliteral">"OMGmatDiagFinest-2"</span>,PETSC_VIEWER_COOKIE);
00097   PetscLogEventRegister(&amp;Jac2FinestMultEvent,<span class="stringliteral">"OMGmatMultFinest-2"</span>,PETSC_VIEWER_COOKIE);
00098 
00099   PetscLogEventRegister(&amp;Jac3DiagEvent,<span class="stringliteral">"OMGmatDiag-3"</span>,PETSC_VIEWER_COOKIE);
00100   PetscLogEventRegister(&amp;Jac3MultEvent,<span class="stringliteral">"OMGmatMult-3"</span>,PETSC_VIEWER_COOKIE);
00101   PetscLogEventRegister(&amp;Jac3FinestDiagEvent,<span class="stringliteral">"OMGmatDiagFinest-3"</span>,PETSC_VIEWER_COOKIE);
00102   PetscLogEventRegister(&amp;Jac3FinestMultEvent,<span class="stringliteral">"OMGmatMultFinest-3"</span>,PETSC_VIEWER_COOKIE);
00103   PetscLogEventRegister(&amp;vecMassDiagEvent,<span class="stringliteral">"vMassDiag"</span>,PETSC_VIEWER_COOKIE);
00104   PetscLogEventRegister(&amp;vecMassMultEvent,<span class="stringliteral">"vMassMult"</span>,PETSC_VIEWER_COOKIE);
00105   PetscLogEventRegister(&amp;vecMassFinestDiagEvent,<span class="stringliteral">"vMassDiagFinest"</span>,PETSC_VIEWER_COOKIE);
00106   PetscLogEventRegister(&amp;vecMassFinestMultEvent,<span class="stringliteral">"vMassMultFinest"</span>,PETSC_VIEWER_COOKIE);
00107 
00108   PetscLogEventRegister(&amp;elasticityDiagEvent,<span class="stringliteral">"elDiag"</span>,PETSC_VIEWER_COOKIE);
00109   PetscLogEventRegister(&amp;elasticityMultEvent,<span class="stringliteral">"elMult"</span>,PETSC_VIEWER_COOKIE);
00110   PetscLogEventRegister(&amp;elasticityFinestDiagEvent,<span class="stringliteral">"elDiagFinest"</span>,PETSC_VIEWER_COOKIE);
00111   PetscLogEventRegister(&amp;elasticityFinestMultEvent,<span class="stringliteral">"elMultFinest"</span>,PETSC_VIEWER_COOKIE);
00112 
00113   <span class="keywordtype">int</span> stages[3];
00114   PetscLogStageRegister(&amp;stages[0],<span class="stringliteral">"P2O."</span>);
00115   PetscLogStageRegister(&amp;stages[1],<span class="stringliteral">"Bal"</span>);  
00116   PetscLogStageRegister(&amp;stages[2],<span class="stringliteral">"Solve"</span>);  
00117 <span class="preprocessor">#endif</span>
00118 <span class="preprocessor"></span>
00119   MPI_Comm_size(MPI_COMM_WORLD, &amp;size);
00120   MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
00121 
00122   <span class="comment">//  Usage: &lt;exe&gt; local_num_pts[5000] dim[3] maxDepth[30] maxNumPtsPerOctant[1] </span>
00123   <span class="comment">//  incCorner[1] compressLut[0] mgLoadFac[2.0] numLoops[100] </span>
00124 
00125   <span class="keywordflow">if</span>(argc &gt; 1) {
00126     local_num_pts = atoi(argv[1]);
00127   }  
00128   <span class="keywordflow">if</span>(argc &gt; 2) {
00129     dim = atoi(argv[2]);
00130   }
00131   <span class="keywordflow">if</span>(argc &gt; 3) {
00132     maxDepth = atoi(argv[3]);
00133   }
00134   <span class="keywordflow">if</span>(argc &gt; 4) {
00135     maxNumPts = atoi(argv[4]);
00136   }
00137   <span class="keywordflow">if</span>(argc &gt; 5) {
00138     incCorner = (bool)(atoi(argv[5]));
00139   }  
00140   <span class="keywordflow">if</span>(argc &gt; 6) { 
00141     compressLut = (bool)(atoi(argv[6]));
00142   }
00143   <span class="keywordflow">if</span>(argc &gt; 7) { 
00144     mgLoadFac = atof(argv[7]);
00145   }
00146   <span class="keywordflow">if</span>(argc &gt; 8) {
00147     numLoops = atoi(argv[8]);
00148   }
00149 
00150   MPI_Barrier(MPI_COMM_WORLD);
00151   <span class="keywordflow">if</span>(!rank){
00152     std::cout &lt;&lt; <span class="stringliteral">"Creating points on the fly... "</span>&lt;&lt;std::endl;
00153   }
00154 
00155   startTime = MPI_Wtime();
00156 
00157   srand48(0x12345678 + 76543*rank);
00158 
00159   pts.resize(3*local_num_pts);
00160   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; (3*local_num_pts); i++) {
00161     pts[i]= <a class="code" href="testElasMatVec_8C.html#a8">gaussian</a>(0.5, 0.16);
00162   }
00163 
00164   MPI_Barrier(MPI_COMM_WORLD);
00165   <span class="keywordflow">if</span>(!rank){
00166     std::cout &lt;&lt; <span class="stringliteral">" finished creating points  "</span>&lt;&lt;std::endl; <span class="comment">// Point size</span>
00167   }
00168   endTime = MPI_Wtime();
00169   localTime = endTime - startTime;
00170   <span class="keywordflow">if</span>(!rank){
00171     std::cout &lt;&lt;<span class="stringliteral">"point generation time: "</span>&lt;&lt;localTime &lt;&lt; std::endl;
00172   }
00173 
00174   ptsLen = pts.size();
00175 
00176   <span class="keywordflow">if</span>(writePts) {
00177     <span class="keywordtype">char</span> ptsFileName[100];
00178     sprintf(ptsFileName, <span class="stringliteral">"tempPts%d_%d.pts"</span>, rank, size);
00179     <a class="code" href="namespaceot.html#a50">ot::writePtsToFile</a>(ptsFileName, pts);
00180   }
00181 
00182   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; ptsLen; i+=3) {
00183     <span class="keywordflow">if</span>( (pts[i] &gt; 0.0) &amp;&amp;
00184         (pts[i+1] &gt; 0.0)
00185         &amp;&amp; (pts[i+2] &gt; 0.0) &amp;&amp;
00186         ( ((<span class="keywordtype">unsigned</span> int)(pts[i]*((double)(1u &lt;&lt; maxDepth)))) &lt; (1u &lt;&lt; maxDepth))  &amp;&amp;
00187         ( ((<span class="keywordtype">unsigned</span> int)(pts[i+1]*((double)(1u &lt;&lt; maxDepth)))) &lt; (1u &lt;&lt; maxDepth))  &amp;&amp;
00188         ( ((<span class="keywordtype">unsigned</span> int)(pts[i+2]*((double)(1u &lt;&lt; maxDepth)))) &lt; (1u &lt;&lt; maxDepth)) ) {
00189       tmpNodes.push_back( <a class="code" href="classot_1_1TreeNode.html">ot::TreeNode</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(pts[i]*(<span class="keywordtype">double</span>)(1u &lt;&lt; maxDepth)),
00190             (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(pts[i+1]*(<span class="keywordtype">double</span>)(1u &lt;&lt; maxDepth)),
00191             (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(pts[i+2]*(<span class="keywordtype">double</span>)(1u &lt;&lt; maxDepth)),
00192             maxDepth,dim,maxDepth) );
00193     }
00194   }
00195   pts.clear();
00196 
00197   MPI_Barrier(MPI_COMM_WORLD);
00198 
00199   <span class="keywordflow">if</span>(!rank){
00200     std::cout &lt;&lt;<span class="stringliteral">"Removing bad points... "</span>&lt;&lt;localTime &lt;&lt; std::endl;
00201   }
00202 
00203   par::removeDuplicates&lt;ot::TreeNode&gt;(tmpNodes, <span class="keyword">false</span>, MPI_COMM_WORLD);
00204   linOct = tmpNodes;
00205   tmpNodes.clear();
00206 
00207   MPI_Barrier(MPI_COMM_WORLD);
00208 
00209   <span class="keywordflow">if</span>(!rank){
00210     std::cout &lt;&lt;<span class="stringliteral">"Partitioning Input... "</span>&lt;&lt;localTime &lt;&lt; std::endl;
00211   }
00212 
00213   par::partitionW&lt;ot::TreeNode&gt;(linOct, NULL, MPI_COMM_WORLD);
00214 
00215   <span class="comment">// reduce and only print the total ...</span>
00216   localSz = linOct.size();
00217   par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;localSz, &amp;totalSz, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00218 
00219   MPI_Barrier(MPI_COMM_WORLD);
00220 
00221   <span class="keywordflow">if</span>(!rank) {
00222     std::cout&lt;&lt;<span class="stringliteral">"# pts= "</span> &lt;&lt; totalSz&lt;&lt;std::endl;
00223   }
00224 
00225   MPI_Barrier(MPI_COMM_WORLD);
00226 
00227   pts.resize(3*(linOct.size()));
00228   ptsLen = (3*(linOct.size()));
00229   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; linOct.size(); i++) {
00230     pts[3*i] = (((double)(linOct[i].getX())) + 0.5)/((double)(1u &lt;&lt; maxDepth));
00231     pts[(3*i)+1] = (((double)(linOct[i].getY())) +0.5)/((double)(1u &lt;&lt; maxDepth));
00232     pts[(3*i)+2] = (((double)(linOct[i].getZ())) +0.5)/((double)(1u &lt;&lt; maxDepth));
00233   }<span class="comment">//end for i</span>
00234   linOct.clear();
00235 
00236   gSize[0] = 1.0;
00237   gSize[1] = 1.0;
00238   gSize[2] = 1.0;
00239 
00240   MPI_Barrier(MPI_COMM_WORLD);  
00241 
00242 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00243 <span class="preprocessor"></span>  PetscLogStagePush(stages[0]);
00244 <span class="preprocessor">#endif</span>
00245 <span class="preprocessor"></span>  startTime = MPI_Wtime();
00246   <a class="code" href="namespaceot.html#a35">ot::points2Octree</a>(pts, gSize, linOct, dim, maxDepth, maxNumPts, MPI_COMM_WORLD);
00247   endTime = MPI_Wtime();
00248   localTime = endTime - startTime;
00249 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00250 <span class="preprocessor"></span>  PetscLogStagePop();
00251 <span class="preprocessor">#endif</span>
00252 <span class="preprocessor"></span>  par::Mpi_Reduce&lt;double&gt;(&amp;localTime, &amp;globalTime, 1, MPI_MAX, 0, MPI_COMM_WORLD);
00253   <span class="keywordflow">if</span>(!rank){
00254     std::cout &lt;&lt;<span class="stringliteral">"P2n Time: "</span>&lt;&lt;globalTime &lt;&lt; <span class="stringliteral">"secs "</span> &lt;&lt; std::endl;
00255   }
00256   pts.clear();
00257 
00258   localSz = linOct.size();
00259   par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;localSz, &amp;totalSz, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00260   <span class="keywordflow">if</span>(rank==0) {
00261     std::cout&lt;&lt;<span class="stringliteral">"linOct.size = "</span> &lt;&lt; totalSz&lt;&lt;std::endl;
00262   }
00263 
00264   MPI_Barrier(MPI_COMM_WORLD);  
00265 
00266 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00267 <span class="preprocessor"></span>  PetscLogStagePush(stages[1]);
00268 <span class="preprocessor">#endif</span>
00269 <span class="preprocessor"></span>  startTime = MPI_Wtime();
00270   <a class="code" href="namespaceot.html#a10">ot::balanceOctree</a> (linOct, balOct, dim, maxDepth, incCorner, MPI_COMM_WORLD, NULL, NULL);
00271   endTime = MPI_Wtime();
00272   localTime = endTime - startTime;
00273 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00274 <span class="preprocessor"></span>  PetscLogStagePop();
00275 <span class="preprocessor">#endif</span>
00276 <span class="preprocessor"></span>  par::Mpi_Reduce&lt;double&gt;(&amp;localTime, &amp;globalTime, 1, MPI_MAX, 0, MPI_COMM_WORLD);
00277   <span class="keywordflow">if</span>(!rank){
00278     std::cout &lt;&lt;<span class="stringliteral">"Bal Time: "</span>&lt;&lt;globalTime &lt;&lt; <span class="stringliteral">"secs "</span> &lt;&lt; std::endl;
00279   }
00280   linOct.clear();
00281 
00282   localSz = balOct.size();
00283   par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;localSz, &amp;totalSz, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00284   <span class="keywordflow">if</span>(rank==0) {
00285     std::cout&lt;&lt;<span class="stringliteral">"balOct.size = "</span> &lt;&lt; totalSz&lt;&lt;std::endl;
00286   }
00287 
00288 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00289 <span class="preprocessor"></span>  PetscLogStagePush(stages[2]);
00290 <span class="preprocessor">#endif</span>
00291 <span class="preprocessor"></span>  <a class="code" href="namespaceot.html#a89">ot::DAMG_Initialize</a>(MPI_COMM_WORLD);
00292 
00293   <a class="code" href="structot_1_1__p__DAMG.html">ot::DAMG</a>       *damg;    
00294   <span class="keywordtype">int</span>       nlevels = 1; <span class="comment">//number of multigrid levels</span>
00295   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   dof = 3; <span class="comment">// degrees of freedom per node  </span>
00296 
00297   <a class="code" href="namespaceot.html#a103">ot::DAMGCreateAndSetDA</a>(PETSC_COMM_WORLD, nlevels, NULL, &amp;damg, 
00298       balOct, dof, mgLoadFac, compressLut, incCorner);
00299 
00300   balOct.clear();
00301 
00302   MPI_Barrier(MPI_COMM_WORLD);
00303   <a class="code" href="namespaceot.html#a108">ot::PrintDAMG</a>(damg);
00304   MPI_Barrier(MPI_COMM_WORLD);
00305 
00306   <a class="code" href="handleType2Stencils_8C.html#a16">createLmatType2</a>(<a class="code" href="checkError_8C.html#a2">LaplacianType2Stencil</a>);
00307   <a class="code" href="handleType2Stencils_8C.html#a12">createMmatType2</a>(<a class="code" href="checkError_8C.html#a4">MassType2Stencil</a>);
00308   <a class="code" href="handleType2Stencils_8C.html#a8">createGDmatType2</a>(<a class="code" href="elasticityJac_8C.html#a8">GradDivType2Stencil</a>);
00309 
00310   <a class="code" href="namespaceot.html#a88">ot::DAMGCreateSuppressedDOFs</a>(damg);
00311 
00312   <a class="code" href="elasticityJac_8h.html#a0">SetElasticityContexts</a>(damg);
00313 
00314   ot::getPrivateMatricesForKSP_Shell = getPrivateMatricesForKSP_Shell_Elas;
00315 
00316   VecZeroEntries(<a class="code" href="omg_8h.html#a36">DAMGGetx</a>(damg));
00317 
00318   <a class="code" href="namespaceot.html#a137">DAMGSetKSP</a>(damg, <a class="code" href="elasticityJac_8C.html#a17">CreateElasticityMat</a>, <a class="code" href="elasticityJac_8C.html#a13">ComputeElasticityMat</a>, <a class="code" href="omgJac_8h.html#a23">ComputeRHS4</a>);
00319 
00320   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numLoops; i++) {
00321     MatMult(<a class="code" href="omg_8h.html#a38">DAMGGetJ</a>(damg), <a class="code" href="omg_8h.html#a36">DAMGGetx</a>(damg), <a class="code" href="omg_8h.html#a34">DAMGGetRHS</a>(damg));
00322   }
00323 
00324   <a class="code" href="handleType2Stencils_8C.html#a26">destroyLmatType2</a>(<a class="code" href="checkError_8C.html#a2">LaplacianType2Stencil</a>);
00325   <a class="code" href="handleType2Stencils_8C.html#a27">destroyMmatType2</a>(<a class="code" href="checkError_8C.html#a4">MassType2Stencil</a>);
00326   <a class="code" href="handleType2Stencils_8C.html#a28">destroyGDmatType2</a>(<a class="code" href="elasticityJac_8C.html#a8">GradDivType2Stencil</a>);
00327 
00328   <a class="code" href="elasticityJac_8h.html#a1">DestroyElasticityContexts</a>(damg);
00329 
00330   <a class="code" href="namespaceot.html#a94">DAMGDestroy</a>(damg);
00331 
00332   <a class="code" href="namespaceot.html#a93">ot::DAMG_Finalize</a>();
00333 
00334 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00335 <span class="preprocessor"></span>  PetscLogStagePop();
00336 <span class="preprocessor">#endif</span>
00337 <span class="preprocessor"></span>
00338   PetscFinalize();
00339 }<span class="comment">//end main</span>
00340 
00341 <span class="keywordtype">double</span> <a class="code" href="testElasMatVec_8C.html#a8">gaussian</a>(<span class="keywordtype">double</span> mean, <span class="keywordtype">double</span> std_deviation) {
00342   <span class="keyword">static</span> <span class="keywordtype">double</span> t1 = 0, t2=0;
00343   <span class="keywordtype">double</span> x1, x2, x3, r;
00344 
00345   <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00346 
00347   <span class="comment">// reuse previous calculations</span>
00348   <span class="keywordflow">if</span>(t1) {
00349     <span class="keyword">const</span> <span class="keywordtype">double</span> tmp = t1;
00350     t1 = 0;
00351     <span class="keywordflow">return</span> mean + std_deviation * tmp;
00352   }
00353   <span class="keywordflow">if</span>(t2) {
00354     <span class="keyword">const</span> <span class="keywordtype">double</span> tmp = t2;
00355     t2 = 0;
00356     <span class="keywordflow">return</span> mean + std_deviation * tmp;
00357   }
00358 
00359   <span class="comment">// pick randomly a point inside the unit disk</span>
00360   <span class="keywordflow">do</span> {
00361     x1 = 2 * drand48() - 1;
00362     x2 = 2 * drand48() - 1;
00363     x3 = 2 * drand48() - 1;
00364     r = x1 * x1 + x2 * x2 + x3*x3;
00365   } <span class="keywordflow">while</span>(r &gt;= 1);
00366 
00367   <span class="comment">// Box-Muller transform</span>
00368   r = sqrt(-2.0 * log(r) / r);
00369 
00370   <span class="comment">// save for next call</span>
00371   t1 = (r * x2);
00372   t2 = (r * x3);
00373 
00374   <span class="keywordflow">return</span> mean + (std_deviation * r * x1);
00375 }<span class="comment">//end gaussian</span>
00376 
00377 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 10 11:31:26 2008 for DENDRO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
