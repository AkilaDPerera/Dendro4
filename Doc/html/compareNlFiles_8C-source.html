<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DENDRO: /net/ac190/www-db1/grads/r/rahulss/Dendro/src/test/compareNlFiles.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000013.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000023.html">test</a></div>
<h1>compareNlFiles.C</h1><a href="compareNlFiles_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="preprocessor">#include "mpi.h"</span>
00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
00004 <span class="preprocessor">#include "petsc.h"</span>
00005 <span class="preprocessor">#include "<a class="code" href="sys_8h.html">sys.h</a>"</span>
00006 <span class="preprocessor">#include &lt;vector&gt;</span>
00007 <span class="preprocessor">#include "<a class="code" href="parUtils_8h.html">parUtils.h</a>"</span>
00008 <span class="preprocessor">#include "<a class="code" href="externVars_8h.html">externVars.h</a>"</span>
00009 <span class="preprocessor">#include "<a class="code" href="dendro_8h.html">dendro.h</a>"</span>
00010 
<a name="l00011"></a><a class="code" href="classVertex.html">00011</a> <span class="keyword">class </span><a class="code" href="classVertex.html">Vertex</a> {
00012         <span class="keyword">private</span>:
00013                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, y, z, id;
00014         <span class="keyword">public</span>:
<a name="l00015"></a><a class="code" href="classVertex.html#a1">00015</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> getX()<span class="keyword"> const </span>{
00016                         <span class="keywordflow">return</span> x;
00017                 }
00018 
<a name="l00019"></a><a class="code" href="classVertex.html#a2">00019</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> getY()<span class="keyword"> const </span>{
00020                         <span class="keywordflow">return</span> y;
00021                 }
00022 
<a name="l00023"></a><a class="code" href="classVertex.html#a3">00023</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> getZ()<span class="keyword"> const </span>{
00024                         <span class="keywordflow">return</span> z;
00025                 }
00026 
<a name="l00027"></a><a class="code" href="classVertex.html#a0">00027</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> getId()<span class="keyword"> const </span>{
00028                         <span class="keywordflow">return</span> id;
00029                 }
00030 
<a name="l00031"></a><a class="code" href="classVertex.html#a13">00031</a>                 <a class="code" href="classVertex.html">Vertex</a>() {
00032                         this-&gt;x = static_cast&lt;unsigned int&gt;(-1);
00033                         this-&gt;y = static_cast&lt;unsigned int&gt;(-1);
00034                         this-&gt;z = static_cast&lt;unsigned int&gt;(-1);
00035                         this-&gt;<span class="keywordtype">id</span> = static_cast&lt;unsigned int&gt;(-1);
00036                 }
00037 
<a name="l00038"></a><a class="code" href="classVertex.html#a12">00038</a>                 <a class="code" href="classVertex.html">Vertex</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xVal, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yVal, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> zVal, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idVal) {
00039                         this-&gt;x = xVal;
00040                         this-&gt;y = yVal;
00041                         this-&gt;z = zVal;
00042                         this-&gt;<span class="keywordtype">id</span> = idVal;
00043                 }
00044 
<a name="l00045"></a><a class="code" href="classVertex.html#a11">00045</a>                 <a class="code" href="classVertex.html">Vertex</a>(<a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span> &amp; other) {
00046                         this-&gt;x = other.<a class="code" href="classVertex.html#r1">x</a>;
00047                         this-&gt;y = other.<a class="code" href="classVertex.html#r2">y</a>;
00048                         this-&gt;z = other.<a class="code" href="classVertex.html#r3">z</a>;
00049                         this-&gt;<span class="keywordtype">id</span> = other.<a class="code" href="classVertex.html#r0">id</a>;
00050                 }
00051 
<a name="l00052"></a><a class="code" href="classVertex.html#a7">00052</a>                 <a class="code" href="classVertex.html">Vertex</a> &amp; operator = (<a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span>  &amp; other) {
00053                         <span class="keywordflow">if</span>( <span class="keyword">this</span> == (&amp;other) ) {
00054                                 <span class="keywordflow">return</span> (*this); 
00055                         }
00056                         this-&gt;x = other.<a class="code" href="classVertex.html#r1">x</a>;
00057                         this-&gt;y = other.<a class="code" href="classVertex.html#r2">y</a>;
00058                         this-&gt;z = other.<a class="code" href="classVertex.html#r3">z</a>;
00059                         this-&gt;<span class="keywordtype">id</span> = other.<a class="code" href="classVertex.html#r0">id</a>;
00060                         <span class="keywordflow">return</span> (*this);
00061                 }
00062 
<a name="l00063"></a><a class="code" href="classVertex.html#a8">00063</a>                 <span class="keywordtype">bool</span>  operator == ( <a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00064                         <span class="keywordflow">return</span>( (this-&gt;x == other.<a class="code" href="classVertex.html#r1">x</a>) &amp;&amp; (this-&gt;y == other.<a class="code" href="classVertex.html#r2">y</a>) &amp;&amp; 
00065                                         (this-&gt;z == other.<a class="code" href="classVertex.html#r3">z</a>) &amp;&amp; (this-&gt;<span class="keywordtype">id</span> == other.<a class="code" href="classVertex.html#r0">id</a>) );
00066                 }
00067 
<a name="l00068"></a><a class="code" href="classVertex.html#a4">00068</a>                 <span class="keywordtype">bool</span>  operator != (<a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00069                         <span class="keywordflow">return</span> (!((*this) == other));
00070                 }
00071 
<a name="l00072"></a><a class="code" href="classVertex.html#a5">00072</a>                 <span class="keywordtype">bool</span>  operator &lt; ( <a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00073                         <span class="comment">//Sort using x first and then  y and then z and then id</span>
00074                         <span class="keywordflow">if</span>(this-&gt;x == other.<a class="code" href="classVertex.html#r1">x</a>) {
00075                                 <span class="keywordflow">if</span>( this-&gt;y == other.<a class="code" href="classVertex.html#r2">y</a>) {
00076                                         <span class="keywordflow">if</span>( this-&gt;z == other.<a class="code" href="classVertex.html#r3">z</a>) {
00077                                                 <span class="keywordflow">return</span> (this-&gt;<span class="keywordtype">id</span> &lt; other.<a class="code" href="classVertex.html#r0">id</a>);
00078                                         }<span class="keywordflow">else</span> {
00079                                                 <span class="keywordflow">return</span> (this-&gt;z &lt; other.<a class="code" href="classVertex.html#r3">z</a>);
00080                                         }
00081                                 }<span class="keywordflow">else</span> {
00082                                         <span class="keywordflow">return</span>(this-&gt;y &lt; other.<a class="code" href="classVertex.html#r2">y</a>);
00083                                 }
00084                         } <span class="keywordflow">else</span> {
00085                                 <span class="keywordflow">return</span> (this-&gt;x &lt; other.<a class="code" href="classVertex.html#r1">x</a>);
00086                         }
00087                 }
00088 
<a name="l00089"></a><a class="code" href="classVertex.html#a9">00089</a>                 <span class="keywordtype">bool</span>  operator &gt; ( <a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00090                         <span class="keywordflow">return</span> ( ((*this) != other) &amp;&amp; ((*this) &gt;= other) );
00091                 }
00092 
<a name="l00093"></a><a class="code" href="classVertex.html#a6">00093</a>                 <span class="keywordtype">bool</span>  operator &lt;= ( <a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00094                         <span class="keywordflow">return</span> ( ((*this) &lt; other) || ((*this) == other) );
00095                 }
00096 
<a name="l00097"></a><a class="code" href="classVertex.html#a10">00097</a>                 <span class="keywordtype">bool</span>  operator &gt;= ( <a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00098                         <span class="keywordflow">return</span> (!((*this) &lt; other));
00099                 }
00100 
00101                 <span class="keyword">friend</span> std::ostream &amp; <a class="code" href="compareNlFiles_8C.html#a0">operator &lt;&lt; </a>(std::ostream &amp; os, <a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span> &amp; v) ;
00102 }; <span class="comment">//end class Vertex</span>
00103 
<a name="l00104"></a><a class="code" href="compareNlFiles_8C.html#a0">00104</a> std::ostream &amp; <a class="code" href="compareNlFiles_8C.html#a0">operator &lt;&lt;</a>(std::ostream &amp; os, <a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span> &amp; v) {
00105         <span class="keywordflow">return</span> (os &lt;&lt; v.<a class="code" href="classVertex.html#r1">x</a> &lt;&lt;<span class="stringliteral">" "</span>&lt;&lt; v.<a class="code" href="classVertex.html#r2">y</a> &lt;&lt;<span class="stringliteral">" "</span>&lt;&lt;v.<a class="code" href="classVertex.html#r3">z</a>&lt;&lt;<span class="stringliteral">" "</span>&lt;&lt;v.<a class="code" href="classVertex.html#r0">id</a>);
00106 }<span class="comment">//end fn.</span>
00107 
00108 <span class="keyword">namespace </span>par {
00109 
00110   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
00111     <span class="keyword">class </span>Mpi_datatype;
00112   
00113         <span class="keyword">template</span> &lt;&gt;
<a name="l00114"></a><a class="code" href="classpar_1_1Mpi__datatype_3_01Vertex_01_4.html">00114</a>                 <span class="keyword">class </span><a class="code" href="classpar_1_1Mpi__datatype.html">Mpi_datatype</a>&lt;Vertex&gt; {
00115                         <span class="keyword">public</span>: 
<a name="l00116"></a><a class="code" href="classpar_1_1Mpi__datatype_3_01Vertex_01_4.html#e0">00116</a>                                 <span class="keyword">static</span> MPI_Datatype value() {
00117                                         <span class="keyword">static</span> <span class="keywordtype">bool</span>         first = <span class="keyword">true</span>;
00118                                         <span class="keyword">static</span> MPI_Datatype datatype;
00119                                         <span class="keywordflow">if</span> (first) {
00120                                                 first = <span class="keyword">false</span>;
00121                                                 MPI_Type_contiguous(<span class="keyword">sizeof</span>(Vertex), MPI_BYTE, &amp;datatype);
00122                                                 MPI_Type_commit(&amp;datatype);
00123                                         }
00124                                         <span class="keywordflow">return</span> datatype;
00125                                 }
00126                 };
00127 }<span class="comment">//end namespace</span>
00128 
<a name="l00129"></a><a class="code" href="compareNlFiles_8C.html#a1">00129</a> <span class="keywordtype">int</span> <a class="code" href="testShFn_8C.html#a8">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>**argv) {
00130 
00131         PetscInitialize(&amp;argc,&amp;argv,0,0);
00132         <a class="code" href="namespaceot.html#a134">ot::RegisterEvents</a>();<span class="comment">//Register OTK Functions</span>
00133 
00134         <span class="keywordflow">if</span>(argc &lt; 4) {
00135                 std::cout&lt;&lt;<span class="stringliteral">"exe fileBase file1Procs file2Procs "</span>&lt;&lt;std::endl;
00136                 assert(<span class="keyword">false</span>);
00137         }
00138 
00139         <span class="keywordtype">int</span> rank, npes;
00140         MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
00141         MPI_Comm_size(MPI_COMM_WORLD, &amp;npes);
00142 
00143         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> file1Procs = atoi(argv[2]);
00144         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> file2Procs = atoi(argv[3]);
00145 
00146         assert(file1Procs &lt;= file2Procs);
00147         assert(file2Procs &lt;= npes);
00148 
00149         std::vector&lt;Vertex&gt; vals1;
00150         std::vector&lt;Vertex&gt; vals2;
00151 
00152         <span class="keywordflow">if</span>(rank &lt; file1Procs) {
00153                 <span class="keywordtype">char</span> fileName[100];
00154                 sprintf(fileName,<span class="stringliteral">"%s_%d_%d.out"</span>,argv[1],rank,file1Procs);
00155                 FILE * fptr = fopen(fileName,<span class="stringliteral">"rb"</span>);
00156                 assert(fptr != NULL);
00157                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElems = 0;
00158                 fread(&amp;numElems, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 1, fptr);
00159                 vals1.resize(numElems);
00160                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numElems; i++ ) {   
00161                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xyzi[4];
00162                         fread(xyzi, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 4, fptr);
00163                         vals1[i] = <a class="code" href="classVertex.html">Vertex</a>(xyzi[0], xyzi[1], xyzi[2], xyzi[3]);
00164                 }
00165                 fclose(fptr);
00166         }
00167 
00168         MPI_Barrier(MPI_COMM_WORLD);
00169 
00170         <span class="keywordflow">if</span>(!rank) {
00171                 std::cout&lt;&lt;<span class="stringliteral">"Read File1 Successfully."</span>&lt;&lt;std::endl;
00172         }
00173 
00174         MPI_Barrier(MPI_COMM_WORLD);
00175 
00176         <span class="keywordflow">if</span>(rank &lt; file2Procs) {
00177                 <span class="keywordtype">char</span> fileName[100];
00178                 sprintf(fileName,<span class="stringliteral">"%s_%d_%d.out"</span>,argv[1],rank,file2Procs);
00179                 FILE * fptr = fopen(fileName,<span class="stringliteral">"rb"</span>);
00180                 assert(fptr != NULL);
00181                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElems = 0;
00182                 fread(&amp;numElems, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 1, fptr);
00183                 vals2.resize(numElems);
00184                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numElems; i++ ) {   
00185                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xyzi[4];
00186                         fread(xyzi, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 4, fptr);
00187                         vals2[i] = <a class="code" href="classVertex.html">Vertex</a>(xyzi[0], xyzi[1], xyzi[2], xyzi[3]);
00188                 }
00189                 fclose(fptr);
00190         }
00191 
00192         MPI_Barrier(MPI_COMM_WORLD);
00193 
00194         <span class="keywordflow">if</span>(!rank) {
00195                 std::cout&lt;&lt;<span class="stringliteral">"Read File2 Successfully."</span>&lt;&lt;std::endl;
00196         }
00197 
00198         MPI_Barrier(MPI_COMM_WORLD);
00199 
00200         <a class="code" href="dendro_8h.html#a0">DendroIntL</a> locSz1 = vals1.size();
00201         <a class="code" href="dendro_8h.html#a0">DendroIntL</a> globSz1 = 0;
00202         par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;locSz1, &amp;globSz1, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00203 
00204         <a class="code" href="dendro_8h.html#a0">DendroIntL</a> locSz2 = vals2.size();
00205         <a class="code" href="dendro_8h.html#a0">DendroIntL</a> globSz2 = 0;
00206         par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;locSz2, &amp;globSz2, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00207 
00208         MPI_Barrier(MPI_COMM_WORLD);
00209 
00210         <span class="keywordflow">if</span>(!rank) {
00211                 assert(globSz1 == globSz2);
00212                 std::cout &lt;&lt; <span class="stringliteral">"Global Size: "</span> &lt;&lt; globSz1 &lt;&lt; std::endl;
00213         }
00214 
00215         MPI_Barrier(MPI_COMM_WORLD);
00216 
00217         std::vector&lt;Vertex&gt; vals1Tmp;
00218         std::vector&lt;Vertex&gt; vals2Tmp;
00219 
00220         par::sampleSort&lt;Vertex&gt;(vals1, vals1Tmp, MPI_COMM_WORLD); 
00221         par::sampleSort&lt;Vertex&gt;(vals2, vals2Tmp, MPI_COMM_WORLD); 
00222 
00223         vals1 = vals1Tmp;
00224         vals2 = vals2Tmp;
00225         vals1Tmp.clear();
00226         vals2Tmp.clear();
00227 
00228         MPI_Barrier(MPI_COMM_WORLD);
00229 
00230         <span class="keywordflow">if</span>(!rank) {
00231                 std::cout&lt;&lt;<span class="stringliteral">"Finished Sorting Vertices "</span>&lt;&lt;std::endl;
00232         }
00233 
00234         MPI_Barrier(MPI_COMM_WORLD);
00235 
00236         par::partitionW&lt;Vertex&gt;(vals1, NULL, MPI_COMM_WORLD);
00237         
00238         MPI_Barrier(MPI_COMM_WORLD);
00239 
00240         <span class="keywordflow">if</span>(!rank) {
00241                 std::cout&lt;&lt;<span class="stringliteral">"Finished Partitioning List 1 "</span>&lt;&lt;std::endl;
00242         }
00243 
00244         MPI_Barrier(MPI_COMM_WORLD);
00245 
00246         par::partitionW&lt;Vertex&gt;(vals2, NULL, MPI_COMM_WORLD);
00247 
00248         MPI_Barrier(MPI_COMM_WORLD);
00249 
00250         <span class="keywordflow">if</span>(!rank) {
00251                 std::cout&lt;&lt;<span class="stringliteral">"Finished Partitioning List 2 "</span>&lt;&lt;std::endl;
00252         }
00253 
00254         MPI_Barrier(MPI_COMM_WORLD);
00255 
00256         {
00257                 <span class="keywordtype">char</span> outFile1[100];
00258                 sprintf(outFile1,<span class="stringliteral">"VtxList1_%d_%d.out"</span>,rank,npes);
00259                 FILE * fptr1 = fopen(outFile1,<span class="stringliteral">"wb"</span>);
00260                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElems = (vals1.size());
00261                 fwrite(&amp;numElems, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 1, fptr1);
00262                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numElems; i++ ) {   
00263                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record[4];
00264                         record[0] = vals1[i].getX();
00265                         record[1] = vals1[i].getY();
00266                         record[2] = vals1[i].getZ();
00267                         record[3] = vals1[i].getId();
00268                         fwrite(record, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 4, fptr1);
00269                 }
00270                 fclose(fptr1);
00271         }
00272 
00273         {
00274                 <span class="keywordtype">char</span> outFile2[100];
00275                 sprintf(outFile2,<span class="stringliteral">"VtxList2_%d_%d.out"</span>,rank,npes);
00276                 FILE * fptr2 = fopen(outFile2,<span class="stringliteral">"wb"</span>);
00277                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElems = (vals2.size());
00278                 fwrite(&amp;numElems, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 1, fptr2);
00279                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numElems; i++ ) {   
00280                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record[4];
00281                         record[0] = vals2[i].getX();
00282                         record[1] = vals2[i].getY();
00283                         record[2] = vals2[i].getZ();
00284                         record[3] = vals2[i].getId();
00285                         fwrite(record, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 4, fptr2);
00286                 }
00287                 fclose(fptr2);
00288         }
00289 
00290         MPI_Barrier(MPI_COMM_WORLD);
00291 
00292         <span class="keywordflow">if</span>(!rank) {
00293                 std::cout&lt;&lt;<span class="stringliteral">"Finished writing out the sorted vertices "</span>&lt;&lt;std::endl;
00294         }
00295 
00296         MPI_Barrier(MPI_COMM_WORLD);
00297 
00298         assert(vals1.size() == vals2.size());
00299 
00300         MPI_Barrier(MPI_COMM_WORLD);
00301 
00302         <span class="keywordtype">bool</span> Ipassed = <span class="keyword">false</span>;
00303         <span class="keywordflow">if</span>(vals1 == vals2) {
00304                 Ipassed = <span class="keyword">true</span>;
00305         }
00306 
00307         <span class="keywordtype">bool</span> *IpassedList = <span class="keyword">new</span> <span class="keywordtype">bool</span>[npes];
00308         par::Mpi_Allgather&lt;bool&gt;(&amp;Ipassed, IpassedList, 1, MPI_COMM_WORLD);
00309 
00310         <span class="keywordtype">bool</span> allPassed = <span class="keyword">true</span>;
00311         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastP = 0;
00312         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; ((i &lt; npes) &amp;&amp; allPassed); i++) {
00313                 allPassed = (allPassed &amp;&amp; IpassedList[i]);
00314                 lastP = i;
00315         }
00316         <span class="keyword">delete</span> [] IpassedList;
00317 
00318         <span class="keywordflow">if</span>(!allPassed) {
00319                 <span class="keywordflow">if</span>(rank == lastP) {
00320                         std::cout&lt;&lt;<span class="stringliteral">"First Failing on Proc: "</span>&lt;&lt; lastP &lt;&lt;std::endl;
00321                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vals1.size(); i++) {
00322                                 <span class="keywordflow">if</span>(vals1[i] != vals2[i]) {
00323                                         std::cout&lt;&lt;<span class="stringliteral">"i = "</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">" val1 = "</span>&lt;&lt;vals1[i]&lt;&lt;<span class="stringliteral">" val2 = "</span>&lt;&lt;vals2[i]&lt;&lt;std::endl;
00324                                         <span class="keywordflow">break</span>;  
00325                                 }
00326                         }
00327                 }
00328         }
00329 
00330         vals1.clear();
00331         vals2.clear();
00332 
00333         MPI_Barrier(MPI_COMM_WORLD);
00334 
00335         <span class="keywordflow">if</span>(!rank) {
00336                 <span class="keywordflow">if</span>(allPassed) {
00337                         std::cout&lt;&lt;<span class="stringliteral">"The files match."</span>&lt;&lt;std::endl;
00338                 }<span class="keywordflow">else</span> {
00339                         std::cout&lt;&lt;<span class="stringliteral">"The files do not match."</span>&lt;&lt;std::endl;
00340                 }
00341         }
00342 
00343         MPI_Barrier(MPI_COMM_WORLD);
00344 
00345         PetscFinalize();
00346 
00347 }
00348 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 10 11:31:34 2008 for DENDRO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
