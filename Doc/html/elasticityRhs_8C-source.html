<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DENDRO: /net/ac190/www-db1/grads/r/rahulss/Dendro/examples/elasticityRhs.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a></div>
<h1>elasticityRhs.C</h1><a href="elasticityRhs_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00007 <span class="preprocessor">#include "petsc.h"</span>
00008 <span class="preprocessor">#include "petscvec.h"</span>
00009 <span class="preprocessor">#include "<a class="code" href="omg_8h.html">omg.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="oda_8h.html">oda.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="elasticityJac_8h.html">elasticityJac.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="vecMass_8h.html">vecMass.h</a>"</span>
00013 
<a name="l00014"></a><a class="code" href="elasticityRhs_8C.html#a0">00014</a> PetscErrorCode <a class="code" href="elasticityRhs_8C.html#a0">ComputeElasticityRHS</a>(<a class="code" href="structot_1_1__p__DAMG.html">ot::DAMG</a> damg, Vec rhs) {
00015   PetscFunctionBegin;            
00016   <a class="code" href="classot_1_1DA.html">ot::DA</a>* da = damg-&gt;<a class="code" href="structot_1_1__p__DAMG.html#o3">da</a>;
00017   Vec tmp;
00018   VecDuplicate(rhs, &amp;tmp);
00019   PetscScalar *inarray;
00020   VecZeroEntries(tmp);
00021   da-&gt;<a class="code" href="classot_1_1DA.html#z35_11">vecGetBuffer</a>(tmp, inarray, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, 3);
00022 
00023   <a class="code" href="structElasticityData.html">ElasticityData</a>* data = (static_cast&lt;ElasticityData*&gt;(damg-&gt;<a class="code" href="structot_1_1__p__DAMG.html#o18">user</a>));
00024   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* bdyArr = data-&gt;<a class="code" href="structElasticityData.html#o0">bdyArr</a>;
00025   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxD;
00026   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> balOctmaxD;
00027   <span class="keywordflow">if</span>(da-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00028     maxD = da-&gt;<a class="code" href="classot_1_1DA.html#z31_16">getMaxDepth</a>();
00029     balOctmaxD = maxD - 1;
00030     <span class="keywordflow">for</span>(da-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::ALL&gt;(); da-&gt;<a class="code" href="classot_1_1DA.html#z36_0">curr</a>() &lt; da-&gt;<a class="code" href="classot_1_1DA.html#z36_2">end</a>&lt;ot::DA_FLAGS::ALL&gt;(); da-&gt;<a class="code" href="classot_1_1DA.html#z36_13">next</a>&lt;ot::DA_FLAGS::ALL&gt;())  
00031     {
00032       <a class="code" href="classPoint.html">Point</a> pt;
00033       pt = da-&gt;<a class="code" href="classot_1_1DA.html#z31_3">getCurrentOffset</a>();
00034       <span class="keywordtype">unsigned</span> levelhere = da-&gt;<a class="code" href="classot_1_1DA.html#z36_6">getLevel</a>(da-&gt;<a class="code" href="classot_1_1DA.html#z36_0">curr</a>()) - 1;
00035       <span class="keywordtype">double</span> hxOct = (double)((double)(1u &lt;&lt; (balOctmaxD - levelhere))/(double)(1u &lt;&lt; balOctmaxD));
00036       <span class="keywordtype">double</span> x = (double)(pt.<a class="code" href="classPoint.html#z52_1">xint</a>())/((double)(1u &lt;&lt; (maxD-1)));
00037       <span class="keywordtype">double</span> y = (double)(pt.<a class="code" href="classPoint.html#z52_3">yint</a>())/((double)(1u &lt;&lt; (maxD-1)));
00038       <span class="keywordtype">double</span> z = (double)(pt.<a class="code" href="classPoint.html#z52_5">zint</a>())/((double)(1u &lt;&lt; (maxD-1)));
00039 
00040       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indices[8];
00041       da-&gt;<a class="code" href="classot_1_1DA.html#z36_7">getNodeIndices</a>(indices); 
00042       <span class="keywordtype">double</span> coord[8][3] = {
00043         {0.0,0.0,0.0},
00044         {1.0,0.0,0.0},
00045         {0.0,1.0,0.0},
00046         {1.0,1.0,0.0},
00047         {0.0,0.0,1.0},
00048         {1.0,0.0,1.0},
00049         {0.0,1.0,1.0},
00050         {1.0,1.0,1.0}
00051       };
00052       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hn = da-&gt;<a class="code" href="classot_1_1DA.html#z36_5">getHangingNodeIndex</a>(da-&gt;<a class="code" href="classot_1_1DA.html#z36_0">curr</a>());
00053 
00054       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 8; i++)
00055       {
00056         <span class="keywordflow">if</span> (!(hn &amp; (1 &lt;&lt; i))){
00057           <span class="comment">//Dirichlet nodes will be set to 0</span>
00058           <span class="keywordflow">if</span>(!(bdyArr[indices[i]])) {
00059             <span class="comment">//Some dummy loading with Fx = Fy = Fz at all pts.</span>
00060             <span class="keywordtype">double</span> xhere, yhere, zhere;
00061             xhere = x + coord[i][0]*hxOct ;
00062             yhere = y + coord[i][1]*hxOct;
00063             zhere = z + coord[i][2]*hxOct; 
00064             <span class="keywordtype">double</span> rhsSum = 0.0;
00065             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> freqCnt = 1; freqCnt &lt; 10; freqCnt++) {
00066               <span class="keywordtype">double</span> facsol = freqCnt;
00067               rhsSum  += (1.0 + 3*facsol*facsol*M_PI*M_PI)*cos(facsol*M_PI*xhere)*
00068                 cos(facsol*M_PI*yhere)*cos(facsol*M_PI*zhere);                                         
00069             }
00070             inarray[3*indices[i]] = rhsSum;
00071             inarray[(3*indices[i])+1] = rhsSum;
00072             inarray[(3*indices[i])+2] = rhsSum;
00073           }
00074         }
00075       }
00076     }
00077   }
00078 
00079   da-&gt;<a class="code" href="classot_1_1DA.html#z35_13">vecRestoreBuffer</a>(tmp,inarray,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,3); 
00080 
00081   Mat vecMassMat;
00082   <a class="code" href="vecMass_8h.html#a0">CreateConstVecMass</a>(damg, &amp;vecMassMat);
00083   <a class="code" href="vecMass_8h.html#a1">ComputeConstVecMass</a>(damg, vecMassMat, vecMassMat);
00084 
00085   MatMult(vecMassMat,tmp,rhs);
00086   MatDestroy(vecMassMat);
00087   VecDestroy(tmp);
00088 
00089   VecScale(rhs,-1.0);
00090 
00091   PetscFunctionReturn(0);
00092 }
00093 
00094 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 10 11:31:23 2008 for DENDRO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
