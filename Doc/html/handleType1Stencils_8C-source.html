<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DENDRO: /net/ac190/www-db1/grads/r/rahulss/Dendro/examples/handleType1Stencils.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a></div>
<h1>handleType1Stencils.C</h1><a href="handleType1Stencils_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00007 <span class="preprocessor">#include "mpi.h"</span>
00008 <span class="preprocessor">#include &lt;cstdio&gt;</span>
00009 <span class="preprocessor">#include &lt;cassert&gt;</span>
00010 <span class="preprocessor">#include &lt;iostream&gt;</span>
00011 <span class="preprocessor">#include "<a class="code" href="parUtils_8h.html">parUtils.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="handleStencils_8h.html">handleStencils.h</a>"</span>
00013 
00014 <span class="comment">/*Type 1 Matrices: Coarse is the parent of the Fine elements.*/</span>
00015 
<a name="l00016"></a><a class="code" href="handleType1Stencils_8C.html#a0">00016</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a0">createMmatType1</a>(<span class="keywordtype">double</span> *****&amp; Mmat) {
00017 
00018 <span class="preprocessor">#ifdef __USE_MG_INIT_TYPE3__</span>
00019 <span class="preprocessor"></span>  <a class="code" href="handleType1Stencils_8C.html#a1">createMmatType1_Type3</a>(Mmat);
00020 <span class="preprocessor">#else</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#ifdef __USE_MG_INIT_TYPE2__</span>
00022 <span class="preprocessor"></span>  <a class="code" href="handleType1Stencils_8C.html#a2">createMmatType1_Type2</a>(Mmat);
00023 <span class="preprocessor">#else</span>
00024 <span class="preprocessor"></span>  <a class="code" href="handleType1Stencils_8C.html#a3">createMmatType1_Type1</a>(Mmat);
00025 <span class="preprocessor">#endif</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028   <span class="keywordflow">return</span> 1;
00029 }
00030 
<a name="l00031"></a><a class="code" href="handleType1Stencils_8C.html#a1">00031</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a1">createMmatType1_Type3</a>(<span class="keywordtype">double</span> *****&amp; Mmat) {
00032   FILE* infile;
00033   <span class="keywordtype">int</span> rank;
00034   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00035 
00036   <span class="keywordtype">char</span> fname[100];
00037   sprintf(fname,<span class="stringliteral">"MassType1Stencils_%d.inp"</span>, rank);
00038   infile = fopen(fname,<span class="stringliteral">"r"</span>);
00039   <span class="keywordflow">if</span>(!infile) {
00040     std::cout&lt;&lt;<span class="stringliteral">"The file "</span>&lt;&lt;fname&lt;&lt;<span class="stringliteral">" is not good for reading."</span>&lt;&lt;std::endl;
00041     assert(<span class="keyword">false</span>);
00042   }
00043 
00044   <span class="keyword">typedef</span> <span class="keywordtype">double</span>* doublePtr;
00045   <span class="keyword">typedef</span> doublePtr* double2Ptr;
00046   <span class="keyword">typedef</span> double2Ptr* double3Ptr;
00047   <span class="keyword">typedef</span> double3Ptr* double4Ptr;
00048 
00049   Mmat = <span class="keyword">new</span> double4Ptr[8];
00050   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00051     Mmat[cNumCoarse] = <span class="keyword">new</span> double3Ptr[18];
00052     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00053       Mmat[cNumCoarse][eType] = <span class="keyword">new</span> double2Ptr[8];
00054       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00055         Mmat[cNumCoarse][eType][cNumFine] = <span class="keyword">new</span> doublePtr[8];
00056         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00057           Mmat[cNumCoarse][eType][cNumFine][i] = <span class="keyword">new</span> <span class="keywordtype">double</span>[8];
00058           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00059             fscanf(infile,<span class="stringliteral">"%lf"</span>,&amp;(Mmat[cNumCoarse][eType][cNumFine][i][j]));
00060           }
00061         }
00062       }
00063     }
00064   }
00065 
00066   fclose(infile);
00067 
00068   <span class="keywordflow">return</span> 1;
00069 }
00070 
<a name="l00071"></a><a class="code" href="handleType1Stencils_8C.html#a2">00071</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a2">createMmatType1_Type2</a>(<span class="keywordtype">double</span> *****&amp; Mmat) {
00072   FILE* infile;
00073   MPI_Comm comm = MPI_COMM_WORLD;
00074 
00075   <span class="keywordtype">int</span> rank, npes;
00076   MPI_Comm_rank(comm, &amp;rank);
00077   MPI_Comm_size(comm, &amp;npes);
00078 
00079   <span class="keyword">const</span> <span class="keywordtype">int</span> THOUSAND = 1000;
00080   <span class="keywordtype">int</span> numGroups = (npes/THOUSAND);
00081   <span class="keywordflow">if</span>( (numGroups*THOUSAND) &lt; npes) {
00082     numGroups++;
00083   }
00084 
00085   MPI_Comm newComm;
00086 
00087   <span class="keywordtype">bool</span>* isEmptyList = <span class="keyword">new</span> <span class="keywordtype">bool</span>[npes];
00088   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; numGroups; i++) {
00089     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; (j &lt; (i*THOUSAND)) &amp;&amp; (j &lt; npes); j++) {
00090       isEmptyList[j] = <span class="keyword">true</span>;
00091     }
00092     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = (i*THOUSAND); (j &lt; ((i+1)*THOUSAND)) &amp;&amp; (j &lt; npes); j++) {
00093       isEmptyList[j] = <span class="keyword">false</span>;
00094     }
00095     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = ((i + 1)*THOUSAND); j &lt; npes; j++) {
00096       isEmptyList[j] = <span class="keyword">true</span>;
00097     }
00098     MPI_Comm tmpComm;
00099     <a class="code" href="namespacepar.html#a2">par::splitComm2way</a>(isEmptyList, &amp;tmpComm, comm);
00100     <span class="keywordflow">if</span>(!(isEmptyList[rank])) {
00101       newComm = tmpComm;
00102     }
00103   }<span class="comment">//end for i</span>
00104   <span class="keyword">delete</span> [] isEmptyList;
00105 
00106   <span class="keywordflow">if</span>((rank % THOUSAND) == 0) {
00107     <span class="keywordtype">char</span> fname[100];
00108     sprintf(fname,<span class="stringliteral">"MassType1Stencils_%d.inp"</span>,(rank/THOUSAND));
00109     infile = fopen(fname,<span class="stringliteral">"r"</span>);
00110     <span class="keywordflow">if</span>(!infile) {
00111       std::cout&lt;&lt;<span class="stringliteral">"The file "</span>&lt;&lt;fname&lt;&lt;<span class="stringliteral">" is not good for reading."</span>&lt;&lt;std::endl;
00112       assert(<span class="keyword">false</span>);
00113     }
00114   }
00115 
00116   <span class="keyword">typedef</span> <span class="keywordtype">double</span>* doublePtr;
00117   <span class="keyword">typedef</span> doublePtr* double2Ptr;
00118   <span class="keyword">typedef</span> double2Ptr* double3Ptr;
00119   <span class="keyword">typedef</span> double3Ptr* double4Ptr;
00120 
00121   Mmat = <span class="keyword">new</span> double4Ptr[8];
00122   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00123     Mmat[cNumCoarse] = <span class="keyword">new</span> double3Ptr[18];
00124     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00125       Mmat[cNumCoarse][eType] = <span class="keyword">new</span> double2Ptr[8];
00126       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00127         Mmat[cNumCoarse][eType][cNumFine] = <span class="keyword">new</span> doublePtr[8];
00128         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00129           Mmat[cNumCoarse][eType][cNumFine][i] = <span class="keyword">new</span> <span class="keywordtype">double</span>[8];
00130           <span class="keywordflow">if</span>((rank % THOUSAND) == 0) {
00131             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00132               fscanf(infile,<span class="stringliteral">"%lf"</span>,&amp;(Mmat[cNumCoarse][eType][cNumFine][i][j]));
00133             }
00134           }
00135         }
00136       }
00137     }
00138   }
00139 
00140   <span class="keywordflow">if</span>((rank % THOUSAND) == 0) {
00141     fclose(infile);
00142   }
00143 
00144   <span class="keywordtype">double</span> * tmpMat = <span class="keyword">new</span> <span class="keywordtype">double</span>[73728];
00145 
00146   <span class="keywordflow">if</span>((rank % THOUSAND) == 0) {
00147     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctr = 0;
00148     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00149       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00150         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00151           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00152             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00153               tmpMat[ctr] = Mmat[cNumCoarse][eType][cNumFine][i][j];
00154               ctr++;
00155             }
00156           }
00157         }
00158       }
00159     }
00160   }
00161 
00162   par::Mpi_Bcast&lt;double&gt;(tmpMat,73728, 0, newComm);
00163 
00164   <span class="keywordflow">if</span>((rank % THOUSAND) != 0) {
00165     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctr = 0;
00166     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00167       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00168         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00169           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00170             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00171               Mmat[cNumCoarse][eType][cNumFine][i][j] = tmpMat[ctr];
00172               ctr++;
00173             }
00174           }
00175         }
00176       }
00177     }
00178   }
00179 
00180   <span class="keyword">delete</span> [] tmpMat;
00181 
00182   <span class="keywordflow">return</span> 1;
00183 }<span class="comment">//end of function</span>
00184 
<a name="l00185"></a><a class="code" href="handleType1Stencils_8C.html#a3">00185</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a3">createMmatType1_Type1</a>(<span class="keywordtype">double</span> *****&amp; Mmat) {
00186   FILE* infile;
00187   <span class="keywordtype">int</span> rank;
00188   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00189 
00190   <span class="keywordflow">if</span>(!rank) {
00191     <span class="keywordtype">char</span> fname[100];
00192     sprintf(fname,<span class="stringliteral">"MassType1Stencils.inp"</span>);
00193     infile = fopen(fname,<span class="stringliteral">"r"</span>);
00194     <span class="keywordflow">if</span>(!infile) {
00195       std::cout&lt;&lt;<span class="stringliteral">"The file "</span>&lt;&lt;fname&lt;&lt;<span class="stringliteral">" is not good for reading."</span>&lt;&lt;std::endl;
00196       assert(<span class="keyword">false</span>);
00197     }
00198   }
00199 
00200   <span class="keyword">typedef</span> <span class="keywordtype">double</span>* doublePtr;
00201   <span class="keyword">typedef</span> doublePtr* double2Ptr;
00202   <span class="keyword">typedef</span> double2Ptr* double3Ptr;
00203   <span class="keyword">typedef</span> double3Ptr* double4Ptr;
00204 
00205   Mmat = <span class="keyword">new</span> double4Ptr[8];
00206   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00207     Mmat[cNumCoarse] = <span class="keyword">new</span> double3Ptr[18];
00208     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00209       Mmat[cNumCoarse][eType] = <span class="keyword">new</span> double2Ptr[8];
00210       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00211         Mmat[cNumCoarse][eType][cNumFine] = <span class="keyword">new</span> doublePtr[8];
00212         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00213           Mmat[cNumCoarse][eType][cNumFine][i] = <span class="keyword">new</span> <span class="keywordtype">double</span>[8];
00214           <span class="keywordflow">if</span>(!rank) {
00215             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00216               fscanf(infile,<span class="stringliteral">"%lf"</span>,&amp;(Mmat[cNumCoarse][eType][cNumFine][i][j]));
00217             }
00218           }
00219         }
00220       }
00221     }
00222   }
00223 
00224   <span class="keywordflow">if</span>(!rank) {
00225     fclose(infile);
00226   }
00227 
00228   <span class="keywordtype">double</span> * tmpMat = <span class="keyword">new</span> <span class="keywordtype">double</span>[73728];
00229 
00230   <span class="keywordflow">if</span>(!rank) {
00231     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctr = 0;
00232     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00233       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00234         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00235           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00236             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00237               tmpMat[ctr] = Mmat[cNumCoarse][eType][cNumFine][i][j];
00238               ctr++;
00239             }
00240           }
00241         }
00242       }
00243     }
00244   }
00245 
00246   par::Mpi_Bcast&lt;double&gt;(tmpMat,73728, 0, MPI_COMM_WORLD);
00247 
00248   <span class="keywordflow">if</span>(rank) {
00249     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctr = 0;
00250     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00251       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00252         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00253           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00254             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00255               Mmat[cNumCoarse][eType][cNumFine][i][j] = tmpMat[ctr];
00256               ctr++;
00257             }
00258           }
00259         }
00260       }
00261     }
00262   }
00263 
00264   <span class="keyword">delete</span> [] tmpMat;
00265 
00266   <span class="keywordflow">return</span> 1;
00267 }<span class="comment">//end of function</span>
00268 
<a name="l00269"></a><a class="code" href="handleType1Stencils_8C.html#a4">00269</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a4">createLmatType1</a>(<span class="keywordtype">double</span> *****&amp; Lmat) {
00270 
00271 <span class="preprocessor">#ifdef __USE_MG_INIT_TYPE3__</span>
00272 <span class="preprocessor"></span>  <a class="code" href="handleType1Stencils_8C.html#a5">createLmatType1_Type3</a>(Lmat);
00273 <span class="preprocessor">#else</span>
00274 <span class="preprocessor"></span><span class="preprocessor">#ifdef __USE_MG_INIT_TYPE2__</span>
00275 <span class="preprocessor"></span>  <a class="code" href="handleType1Stencils_8C.html#a6">createLmatType1_Type2</a>(Lmat);
00276 <span class="preprocessor">#else</span>
00277 <span class="preprocessor"></span>  <a class="code" href="handleType1Stencils_8C.html#a7">createLmatType1_Type1</a>(Lmat);
00278 <span class="preprocessor">#endif</span>
00279 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00280 <span class="preprocessor"></span>
00281   <span class="keywordflow">return</span> 1;
00282 }
00283 
<a name="l00284"></a><a class="code" href="handleType1Stencils_8C.html#a5">00284</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a5">createLmatType1_Type3</a>(<span class="keywordtype">double</span> *****&amp; Lmat) {
00285   FILE* infile;
00286   <span class="keywordtype">int</span> rank;
00287   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00288 
00289   <span class="keywordtype">char</span> fname[100];
00290   sprintf(fname,<span class="stringliteral">"LapType1Stencils_%d.inp"</span>, rank);       
00291   infile = fopen(fname,<span class="stringliteral">"r"</span>);
00292   <span class="keywordflow">if</span>(!infile) {
00293     std::cout&lt;&lt;<span class="stringliteral">"The file "</span>&lt;&lt;fname&lt;&lt;<span class="stringliteral">" is not good for reading."</span>&lt;&lt;std::endl;
00294     assert(<span class="keyword">false</span>);
00295   }
00296 
00297   <span class="keyword">typedef</span> <span class="keywordtype">double</span>* doublePtr;
00298   <span class="keyword">typedef</span> doublePtr* double2Ptr;
00299   <span class="keyword">typedef</span> double2Ptr* double3Ptr;
00300   <span class="keyword">typedef</span> double3Ptr* double4Ptr;
00301 
00302   Lmat = <span class="keyword">new</span> double4Ptr[8];
00303   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00304     Lmat[cNumCoarse] = <span class="keyword">new</span> double3Ptr[18];
00305     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00306       Lmat[cNumCoarse][eType] = <span class="keyword">new</span> double2Ptr[8];
00307       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00308         Lmat[cNumCoarse][eType][cNumFine] = <span class="keyword">new</span> doublePtr[8];
00309         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00310           Lmat[cNumCoarse][eType][cNumFine][i] = <span class="keyword">new</span> <span class="keywordtype">double</span>[8];
00311           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00312             fscanf(infile,<span class="stringliteral">"%lf"</span>,&amp;(Lmat[cNumCoarse][eType][cNumFine][i][j]));
00313           }
00314         }
00315       }
00316     }
00317   }
00318 
00319   fclose(infile);
00320 
00321   <span class="keywordflow">return</span> 1;
00322 }
00323 
<a name="l00324"></a><a class="code" href="handleType1Stencils_8C.html#a6">00324</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a6">createLmatType1_Type2</a>(<span class="keywordtype">double</span> *****&amp; Lmat) {
00325   FILE* infile;
00326   MPI_Comm comm = MPI_COMM_WORLD;
00327 
00328   <span class="keywordtype">int</span> rank, npes;
00329   MPI_Comm_rank(comm, &amp;rank);
00330   MPI_Comm_size(comm, &amp;npes);
00331 
00332   <span class="keyword">const</span> <span class="keywordtype">int</span> THOUSAND = 1000;
00333   <span class="keywordtype">int</span> numGroups = (npes/THOUSAND);
00334   <span class="keywordflow">if</span>( (numGroups*THOUSAND) &lt; npes) {
00335     numGroups++;
00336   }
00337 
00338   MPI_Comm newComm;
00339 
00340   <span class="keywordtype">bool</span>* isEmptyList = <span class="keyword">new</span> <span class="keywordtype">bool</span>[npes];
00341   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; numGroups; i++) {
00342     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; (j &lt; (i*THOUSAND)) &amp;&amp; (j &lt; npes); j++) {
00343       isEmptyList[j] = <span class="keyword">true</span>;
00344     }
00345     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = (i*THOUSAND); (j &lt; ((i+1)*THOUSAND)) &amp;&amp; (j &lt; npes); j++) {
00346       isEmptyList[j] = <span class="keyword">false</span>;
00347     }
00348     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = ((i + 1)*THOUSAND); j &lt; npes; j++) {
00349       isEmptyList[j] = <span class="keyword">true</span>;
00350     }
00351     MPI_Comm tmpComm;
00352     <a class="code" href="namespacepar.html#a2">par::splitComm2way</a>(isEmptyList, &amp;tmpComm, comm);
00353     <span class="keywordflow">if</span>(!(isEmptyList[rank])) {
00354       newComm = tmpComm;
00355     }
00356   }<span class="comment">//end for i</span>
00357   <span class="keyword">delete</span> [] isEmptyList;
00358 
00359   <span class="keywordflow">if</span>((rank % THOUSAND) == 0) {
00360     <span class="keywordtype">char</span> fname[100];
00361     sprintf(fname,<span class="stringliteral">"LapType1Stencils_%d.inp"</span>,(rank/THOUSAND));   
00362     infile = fopen(fname,<span class="stringliteral">"r"</span>);
00363     <span class="keywordflow">if</span>(!infile) {
00364       std::cout&lt;&lt;<span class="stringliteral">"The file "</span>&lt;&lt;fname&lt;&lt;<span class="stringliteral">" is not good for reading."</span>&lt;&lt;std::endl;
00365       assert(<span class="keyword">false</span>);
00366     }
00367   }
00368 
00369   <span class="keyword">typedef</span> <span class="keywordtype">double</span>* doublePtr;
00370   <span class="keyword">typedef</span> doublePtr* double2Ptr;
00371   <span class="keyword">typedef</span> double2Ptr* double3Ptr;
00372   <span class="keyword">typedef</span> double3Ptr* double4Ptr;
00373 
00374   Lmat = <span class="keyword">new</span> double4Ptr[8];
00375   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00376     Lmat[cNumCoarse] = <span class="keyword">new</span> double3Ptr[18];
00377     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00378       Lmat[cNumCoarse][eType] = <span class="keyword">new</span> double2Ptr[8];
00379       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00380         Lmat[cNumCoarse][eType][cNumFine] = <span class="keyword">new</span> doublePtr[8];
00381         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00382           Lmat[cNumCoarse][eType][cNumFine][i] = <span class="keyword">new</span> <span class="keywordtype">double</span>[8];
00383           <span class="keywordflow">if</span>((rank % THOUSAND) == 0) {
00384             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00385               fscanf(infile,<span class="stringliteral">"%lf"</span>,&amp;(Lmat[cNumCoarse][eType][cNumFine][i][j]));
00386             }
00387           }
00388         }
00389       }
00390     }
00391   }
00392 
00393   <span class="keywordflow">if</span>((rank % THOUSAND) == 0) {
00394     fclose(infile);
00395   }
00396 
00397   <span class="keywordtype">double</span> * tmpMat = <span class="keyword">new</span> <span class="keywordtype">double</span>[73728];
00398 
00399   <span class="keywordflow">if</span>((rank % THOUSAND) == 0) {
00400     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctr = 0;
00401     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00402       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00403         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00404           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00405             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00406               tmpMat[ctr] = Lmat[cNumCoarse][eType][cNumFine][i][j];
00407               ctr++;
00408             }
00409           }
00410         }
00411       }
00412     }
00413   }
00414 
00415   par::Mpi_Bcast&lt;double&gt;(tmpMat,73728, 0, newComm);
00416 
00417   <span class="keywordflow">if</span>((rank % THOUSAND) != 0) {
00418     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctr = 0;
00419     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00420       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00421         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00422           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00423             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00424               Lmat[cNumCoarse][eType][cNumFine][i][j] = tmpMat[ctr];
00425               ctr++;
00426             }
00427           }
00428         }
00429       }
00430     }
00431   }
00432 
00433   <span class="keyword">delete</span> [] tmpMat;
00434 
00435   <span class="keywordflow">return</span> 1;
00436 }<span class="comment">//end of function</span>
00437 
00438 
<a name="l00439"></a><a class="code" href="handleType1Stencils_8C.html#a7">00439</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a7">createLmatType1_Type1</a>(<span class="keywordtype">double</span> *****&amp; Lmat) {
00440   FILE* infile;
00441   <span class="keywordtype">int</span> rank;
00442   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00443 
00444   <span class="keywordflow">if</span>(!rank) {
00445     <span class="keywordtype">char</span> fname[100];
00446     sprintf(fname,<span class="stringliteral">"LapType1Stencils.inp"</span>);      
00447     infile = fopen(fname,<span class="stringliteral">"r"</span>);
00448     <span class="keywordflow">if</span>(!infile) {
00449       std::cout&lt;&lt;<span class="stringliteral">"The file "</span>&lt;&lt;fname&lt;&lt;<span class="stringliteral">" is not good for reading."</span>&lt;&lt;std::endl;
00450       assert(<span class="keyword">false</span>);
00451     }
00452   }
00453 
00454   <span class="keyword">typedef</span> <span class="keywordtype">double</span>* doublePtr;
00455   <span class="keyword">typedef</span> doublePtr* double2Ptr;
00456   <span class="keyword">typedef</span> double2Ptr* double3Ptr;
00457   <span class="keyword">typedef</span> double3Ptr* double4Ptr;
00458 
00459   Lmat = <span class="keyword">new</span> double4Ptr[8];
00460   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00461     Lmat[cNumCoarse] = <span class="keyword">new</span> double3Ptr[18];
00462     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00463       Lmat[cNumCoarse][eType] = <span class="keyword">new</span> double2Ptr[8];
00464       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00465         Lmat[cNumCoarse][eType][cNumFine] = <span class="keyword">new</span> doublePtr[8];
00466         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00467           Lmat[cNumCoarse][eType][cNumFine][i] = <span class="keyword">new</span> <span class="keywordtype">double</span>[8];
00468           <span class="keywordflow">if</span>(!rank) {
00469             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00470               fscanf(infile,<span class="stringliteral">"%lf"</span>,&amp;(Lmat[cNumCoarse][eType][cNumFine][i][j]));
00471             }
00472           }
00473         }
00474       }
00475     }
00476   }
00477 
00478   <span class="keywordflow">if</span>(!rank) {
00479     fclose(infile);
00480   }
00481 
00482   <span class="keywordtype">double</span> * tmpMat = <span class="keyword">new</span> <span class="keywordtype">double</span>[73728];
00483 
00484   <span class="keywordflow">if</span>(!rank) {
00485     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctr = 0;
00486     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00487       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00488         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00489           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00490             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00491               tmpMat[ctr] = Lmat[cNumCoarse][eType][cNumFine][i][j];
00492               ctr++;
00493             }
00494           }
00495         }
00496       }
00497     }
00498   }
00499 
00500   par::Mpi_Bcast&lt;double&gt;(tmpMat,73728, 0, MPI_COMM_WORLD);
00501 
00502   <span class="keywordflow">if</span>(rank) {
00503     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctr = 0;
00504     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00505       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00506         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00507           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00508             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00509               Lmat[cNumCoarse][eType][cNumFine][i][j] = tmpMat[ctr];
00510               ctr++;
00511             }
00512           }
00513         }
00514       }
00515     }
00516   }
00517 
00518   <span class="keyword">delete</span> [] tmpMat;
00519 
00520   <span class="keywordflow">return</span> 1;
00521 }<span class="comment">//end of function</span>
00522 
<a name="l00523"></a><a class="code" href="handleType1Stencils_8C.html#a8">00523</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a8">destroyLmatType1</a>(<span class="keywordtype">double</span> *****&amp; Lmat ) {
00524   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00525     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00526       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00527         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00528           <span class="keyword">delete</span> [] (Lmat[cNumCoarse][eType][cNumFine][i]);
00529           Lmat[cNumCoarse][eType][cNumFine][i] = NULL;
00530         }
00531         <span class="keyword">delete</span> [] (Lmat[cNumCoarse][eType][cNumFine]);
00532         Lmat[cNumCoarse][eType][cNumFine] = NULL;
00533       }
00534       <span class="keyword">delete</span> [] (Lmat[cNumCoarse][eType]);
00535       Lmat[cNumCoarse][eType] = NULL;
00536     }
00537     <span class="keyword">delete</span> [] (Lmat[cNumCoarse]);
00538     Lmat[cNumCoarse] = NULL;
00539   }
00540 
00541   <span class="keyword">delete</span> [] Lmat;
00542   Lmat = NULL;
00543 
00544   <span class="keywordflow">return</span> 1;
00545 }<span class="comment">//end of function</span>
00546 
<a name="l00547"></a><a class="code" href="handleType1Stencils_8C.html#a9">00547</a> <span class="keywordtype">int</span> <a class="code" href="handleType1Stencils_8C.html#a9">destroyMmatType1</a>(<span class="keywordtype">double</span> *****&amp; Mmat ) {
00548   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumCoarse = 0; cNumCoarse &lt; 8; cNumCoarse++) {
00549     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eType = 0; eType &lt; 18; eType++) {
00550       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cNumFine = 0; cNumFine &lt; 8; cNumFine++) {
00551         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00552           <span class="keyword">delete</span> [] (Mmat[cNumCoarse][eType][cNumFine][i]);
00553           Mmat[cNumCoarse][eType][cNumFine][i] = NULL;
00554         }
00555         <span class="keyword">delete</span> [] (Mmat[cNumCoarse][eType][cNumFine]);
00556         Mmat[cNumCoarse][eType][cNumFine] = NULL;
00557       }
00558       <span class="keyword">delete</span> [] (Mmat[cNumCoarse][eType]);
00559       Mmat[cNumCoarse][eType] = NULL;
00560     }
00561     <span class="keyword">delete</span> [] (Mmat[cNumCoarse]);
00562     Mmat[cNumCoarse] = NULL;
00563   }
00564 
00565   <span class="keyword">delete</span> [] Mmat;
00566   Mmat = NULL;
00567 
00568   <span class="keywordflow">return</span> 1;
00569 }<span class="comment">//end of function</span>
00570 
00571 
00572 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 10 11:31:23 2008 for DENDRO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
