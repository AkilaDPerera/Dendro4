<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DENDRO: /net/ac190/www-db1/grads/r/rahulss/Dendro/src/omg/ProlongMatVec.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000013.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000018.html">omg</a></div>
<h1>ProlongMatVec.C</h1><a href="ProlongMatVec_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00008 <span class="preprocessor">#include "petsc.h"</span>
00009 <span class="preprocessor">#include "petscmat.h"</span>
00010 <span class="preprocessor">#include "<a class="code" href="omg_8h.html">omg.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="oda_8h.html">oda.h</a>"</span>
00012 
00013 <span class="preprocessor">#ifndef iC</span>
<a name="l00014"></a><a class="code" href="ProlongMatVec_8C.html#a0">00014</a> <span class="preprocessor"></span><span class="preprocessor">#define iC(fun) {CHKERRQ(fun);}</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#ifdef __DEBUG__</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#ifndef __DEBUG_MG__</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#define __DEBUG_MG__</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00022 <span class="preprocessor"></span>
00023 <span class="keyword">namespace </span>ot {
00024 
00025   <span class="keyword">extern</span> <span class="keywordtype">double</span> **** RmatType2Stencil;
00026   <span class="keyword">extern</span> <span class="keywordtype">double</span> ***** RmatType1Stencil;
00027   <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>**** VtxMap1; 
00028   <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>***** VtxMap2; 
00029   <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>***** VtxMap3; 
00030   <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>****** VtxMap4; 
00031 
<a name="l00032"></a><a class="code" href="namespaceot.html#a113">00032</a>   PetscErrorCode <a class="code" href="namespaceot.html#a113">addProlongMatVec</a>(Mat R, Vec v1, Vec v2, Vec v3)
00033   {
00034     PetscScalar one = 1.0;
00035     PetscFunctionBegin;
00036     <span class="keywordflow">if</span>((v2!=v3) &amp;&amp; (v1!=v3)) {
00037       <span class="comment">//Note This will fail only if v2==v3 or v1 ==v3!</span>
00038       <span class="comment">//(i.e they are identical copies pointing to the same memory location)</span>
00039       <a class="code" href="omg_8C.html#a0">iC</a>(MatMultTranspose(R, v1, v3));<span class="comment">//v3 = R*v1</span>
00040       <a class="code" href="omg_8C.html#a0">iC</a>(VecAXPY(v3,one,v2));<span class="comment">//v3 = v3+ v2=v2 + R*v1</span>
00041     }<span class="keywordflow">else</span> {
00042       <span class="comment">//This is less efficient but failproof.</span>
00043       <a class="code" href="structot_1_1TransferOpData.html">TransferOpData</a> *data;                     
00044       MatShellGetContext( R, (<span class="keywordtype">void</span> **)&amp;data);
00045       Vec tmp = data-&gt;addPtmp;
00046       <span class="keywordflow">if</span>(tmp == NULL) {
00047         VecDuplicate(v3,&amp;tmp);
00048         data-&gt;addPtmp = tmp;
00049       }
00050       <a class="code" href="omg_8C.html#a0">iC</a>(MatMultTranspose(R, v1, tmp));<span class="comment">//tmp=R'*v1;</span>
00051       <a class="code" href="omg_8C.html#a0">iC</a>(VecWAXPY(v3,one,v2,tmp));<span class="comment">//v3 = (1*v2)+tmp=v2 + R'*v1</span>
00052     }
00053     PetscFunctionReturn(0);
00054   }
00055 
<a name="l00056"></a><a class="code" href="namespaceot.html#a114">00056</a>   PetscErrorCode <a class="code" href="namespaceot.html#a114">prolongMatVecType2</a>(Mat R, Vec c, Vec f) {              
00057     <a class="code" href="structot_1_1TransferOpData.html">TransferOpData</a> *data;                       
00058     PetscFunctionBegin;
00059     <a class="code" href="omg_8C.html#a0">iC</a>(MatShellGetContext( R, (<span class="keywordtype">void</span> **)&amp;data));
00060     MPI_Comm comm = data-&gt;comm;
00061     Vec tmp = data-&gt;tmp;                                
00062     PetscInt tmpSz;
00063     PetscInt fSz;
00064     <a class="code" href="omg_8C.html#a0">iC</a>(VecGetLocalSize(tmp,&amp;tmpSz));
00065     <a class="code" href="omg_8C.html#a0">iC</a>(VecGetLocalSize(f,&amp;fSz));
00066     <a class="code" href="namespaceot.html#a115">prolongMatVecType1</a>(R,c,tmp);                
00067     <a class="code" href="namespacepar.html#a19">scatterValues</a>(tmp, f, tmpSz, fSz, data-&gt;sendSzP, data-&gt;sendOffP, 
00068         data-&gt;recvSzP, data-&gt;recvOffP, comm);
00069     PetscFunctionReturn(0);
00070   }
00071 
<a name="l00072"></a><a class="code" href="ProlongMatVec_8C.html#a1">00072</a> <span class="preprocessor">#define ITLB_SET_VALUE_NO_SUPPRESSED_DOFS {\</span>
00073 <span class="preprocessor">  farr[fidx+l] += (Rval*carr[cidx+l]);\</span>
00074 <span class="preprocessor">}</span>
00075 <span class="preprocessor"></span>
<a name="l00076"></a><a class="code" href="ProlongMatVec_8C.html#a2">00076</a> <span class="preprocessor">#define ITLB_SET_VALUE_SUPPRESSED_DOFS {\</span>
00077 <span class="preprocessor">  if(!( (suppressedDOFc &amp;&amp; suppressedDOFc[cidx+l]) ||\</span>
00078 <span class="preprocessor">        (suppressedDOFf &amp;&amp; suppressedDOFf[fidx+l]) )) {\</span>
00079 <span class="preprocessor">    farr[fidx+l] += (Rval*carr[cidx+l]);\</span>
00080 <span class="preprocessor">  }\</span>
00081 <span class="preprocessor">}</span>
00082 <span class="preprocessor"></span>
<a name="l00083"></a><a class="code" href="ProlongMatVec_8C.html#a3">00083</a> <span class="preprocessor">#define INTERGRID_TRANSFER_LOOP_BLOCK(ITLB_SET_VALUE) {\</span>
00084 <span class="preprocessor">  </span><span class="comment">/*The fine loop is always Writable, but the coarse loop*/</span>\
00085   <span class="comment">/*could be Independent or W_Dependent. Hence the fine counter must*/</span>\
00086   <span class="comment">/*be incremented properly to align with the coarse.*/</span>\
00087   Point Cpt = dac-&gt;getCurrentOffset();\
00088   while(daf-&gt;getCurrentOffset() != Cpt) {\
00089     if(daf-&gt;isLUTcompressed()) {\
00090       daf-&gt;updateQuotientCounter();\
00091     }\
00092     daf-&gt;next&lt;ot::DA_FLAGS::WRITABLE&gt;();\
00093   } \
00094   unsigned char chnMask = dac-&gt;getHangingNodeIndex(dac-&gt;curr());\
00095   unsigned char cNumCoarse = dac-&gt;getChildNumber();\
00096   unsigned int cIndices[8];\
00097   dac-&gt;getNodeIndices(cIndices);\
00098   unsigned char ctype = 0;\
00099   GET_ETYPE_BLOCK(ctype,chnMask,cNumCoarse)\
00100   if(daf-&gt;getLevel(daf-&gt;curr()) == dac-&gt;getLevel(dac-&gt;curr())) {\
00101     <span class="comment">/*The coarse and fine elements are the same,*/</span>\
00102     <span class="comment">/*so cNumCoarse = cNumFine. This is type-2*/</span>\
00103     double** type2RmatPtr =  RmatType2Stencil[cNumCoarse][ctype];\
00104     unsigned char fhnMask = daf-&gt;getHangingNodeIndex(daf-&gt;curr());\
00105     unsigned int fIndices[8];\
00106     daf-&gt;getNodeIndices(fIndices);\
00107     for(unsigned int fCtr = 0; fCtr &lt; 8; fCtr++) {\
00108       if(!(fhnMask &amp; (1 &lt;&lt; fCtr))) {\
00109         ot::FineTouchedStatus* fineTouchedStatusPtr = (&amp;(fineTouchedFlagsArr[fIndices[fCtr]]));\
00110         unsigned int fidx = fIndices[fCtr]*dof;\
00111         for(unsigned int cCtr = 0; cCtr &lt; 8; cCtr++) {\
00112           <span class="comment">/*Read fineTouchedFlagsArr Directly*/</span>\
00113           if( (fineTouchedStatusPtr-&gt;flags[fCtr]) &amp; (1 &lt;&lt; cCtr) ) {\
00114             unsigned int cidx = cIndices[cCtr]*dof;\
00115             double Rval = type2RmatPtr[cCtr][fCtr];\
00116             for(unsigned int l = 0; l &lt; dof; l++) {\
00117               ITLB_SET_VALUE\
00118             }\
00119           }\
00120         }\
00121       }\
00122     }\
00123     daf-&gt;next&lt;ot::DA_FLAGS::WRITABLE&gt;();\
00124   }else {\
00125     for(unsigned char cNumFine = 0; cNumFine &lt; 8; cNumFine++) {\
00126       <span class="comment">/*The coarse and fine elements are NOT the same. This is type-1.*/</span>\
00127       <span class="comment">/*Loop over each of the 8 children of the coarse element.*/</span>\
00128       <span class="comment">/*These are the underlying fine elements.*/</span>\
00129       double** type1RmatPtr =  RmatType1Stencil[cNumCoarse][cNumFine][ctype];\
00130       unsigned char fhnMask = daf-&gt;getHangingNodeIndex(daf-&gt;curr());\
00131       unsigned int fIndices[8];\
00132       daf-&gt;getNodeIndices(fIndices);\
00133       for(unsigned int fCtr = 0; fCtr &lt; 8; fCtr++) {\
00134         if(!(fhnMask &amp; (1 &lt;&lt; fCtr))) {\
00135           ot::FineTouchedStatus* fineTouchedStatusPtr = (&amp;(fineTouchedFlagsArr[fIndices[fCtr]]));\
00136           unsigned int fidx = fIndices[fCtr]*dof;\
00137           for(unsigned int cCtr = 0; cCtr &lt; 8; cCtr++) {\
00138             <span class="comment">/*Read fineTouchedFlagsArr Directly*/</span>\
00139             if( (fineTouchedStatusPtr-&gt;flags[fCtr]) &amp; (1 &lt;&lt; cCtr) ) {\
00140               unsigned int cidx = cIndices[cCtr]*dof;\
00141               double Rval = type1RmatPtr[cCtr][fCtr];\
00142               for(unsigned int l = 0; l &lt; dof; l++) {\
00143                 ITLB_SET_VALUE\
00144               }\
00145             }\
00146           }\
00147         }\
00148       }\
00149       daf-&gt;next&lt;ot::DA_FLAGS::WRITABLE&gt;();\
00150     }\
00151   }\
00152 }
00153 
<a name="l00154"></a><a class="code" href="namespaceot.html#a115">00154</a> PetscErrorCode <a class="code" href="namespaceot.html#a115">prolongMatVecType1</a>(Mat R, Vec c, Vec f) {
00155 
00156   <a class="code" href="omg_8h.html#a32">PROF_MG_PROLONG_BEGIN</a> 
00157 
00158     <a class="code" href="structot_1_1TransferOpData.html">TransferOpData</a> *data;
00159   <a class="code" href="omg_8C.html#a0">iC</a>(MatShellGetContext(R, (<span class="keywordtype">void</span> **)&amp;data));
00160 
00161   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dof = data-&gt;dof;
00162 
00163   <span class="comment">//Overlap 60% of independent computation with the first communication and</span>
00164   <span class="comment">//40% with the second communication. Since the message size for the fist </span>
00165   <span class="comment">//communication will roughly be 1.25 times that for the second communication</span>
00166   <span class="comment">//This is because in the first communication, we exchange both coarse and</span>
00167   <span class="comment">//fine grid ghosts. In the second, we only exchange fine grid ghosts.</span>
00168   <span class="comment">//I estimate the number of fine grid ghosts to be 4 times that of the coarse</span>
00169   <span class="comment">//grid ghosts (1 surface, uniform refinement)</span>
00170   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fop = 60;
00171 
00172   <a class="code" href="classot_1_1DA.html">ot::DA</a> * dac = data-&gt;dac;
00173   <a class="code" href="classot_1_1DA.html">ot::DA</a> * daf = data-&gt;daf;     
00174 
00175   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* suppressedDOFc = data-&gt;suppressedDOFc;
00176   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* suppressedDOFf = data-&gt;suppressedDOFf;
00177 
00178   PetscInt cSz;
00179   <a class="code" href="omg_8C.html#a0">iC</a>(VecGetLocalSize(c,&amp;cSz));
00180 
00181   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fopCnt = (fop*cSz)/(100*dof);
00182 
00183   <span class="comment">//unsigned int fopCnt = data-&gt;minIndependentSize;</span>
00184 
00185   PetscScalar *farr = NULL;
00186   PetscScalar *carr = NULL;
00187 
00188   std::vector&lt;ot::FineTouchedStatus &gt;* fineTouchedFlags = data-&gt;fineTouchedFlags;
00189   <a class="code" href="classot_1_1FineTouchedStatus.html">ot::FineTouchedStatus</a>* fineTouchedFlagsArr;
00190 
00191   dac-&gt;<a class="code" href="classot_1_1DA.html#z35_11">vecGetBuffer</a>(c,carr,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">true</span>,dof);<span class="comment">//Read-only</span>
00192   daf-&gt;<a class="code" href="classot_1_1DA.html#z35_11">vecGetBuffer</a>&lt;<a class="code" href="classot_1_1FineTouchedStatus.html">ot::FineTouchedStatus</a> &gt;(*fineTouchedFlags,
00193       fineTouchedFlagsArr, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, 1);<span class="comment">//read-only </span>
00194 
00195   <span class="keywordflow">if</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00196     dac-&gt;<a class="code" href="classot_1_1DA.html#z33_2">ReadFromGhostsBegin</a>&lt;PetscScalar&gt;(carr, dof);           
00197   }
00198 
00199   <span class="keywordflow">if</span>(daf-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00200     daf-&gt;<a class="code" href="classot_1_1DA.html#z33_2">ReadFromGhostsBegin</a>&lt;<a class="code" href="classot_1_1FineTouchedStatus.html">ot::FineTouchedStatus</a>&gt;(fineTouchedFlagsArr, 1);
00201   }
00202 
00203   VecZeroEntries(f);
00204   daf-&gt;<a class="code" href="classot_1_1DA.html#z35_11">vecGetBuffer</a>(f,farr,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,dof);<span class="comment">//Writable</span>
00205 
00206   <span class="comment">//Note: If Coarse is Independent, then the corresponding Fine is also independent.</span>
00207   <span class="comment">//Hence, overlapping comm with comp is possible.              </span>
00208   <span class="comment">//Order of the test condition is important. We want to store</span>
00209   <span class="comment">//the info before checking loopCtr.   </span>
00210 
00211   <span class="keywordflow">if</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00212     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loopCtr = 0;
00213     <span class="keywordflow">if</span>(suppressedDOFc || suppressedDOFf) {
00214       <span class="keywordflow">for</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;(), daf-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::WRITABLE&gt;();
00215           ( (daf-&gt;<a class="code" href="classot_1_1DA.html#z36_1">currWithInfo</a>() == daf-&gt;<a class="code" href="classot_1_1DA.html#z36_1">currWithInfo</a>()) &amp;&amp; 
00216             (dac-&gt;<a class="code" href="classot_1_1DA.html#z36_1">currWithInfo</a>() &lt; dac-&gt;<a class="code" href="classot_1_1DA.html#z36_2">end</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;()) &amp;&amp;
00217             (loopCtr &lt; fopCnt) );
00218           dac-&gt;<a class="code" href="classot_1_1DA.html#z36_13">next</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;(), loopCtr++) {
00219         <a class="code" href="ProlongMatVec_8C.html#a3">INTERGRID_TRANSFER_LOOP_BLOCK</a>(<a class="code" href="ProlongMatVec_8C.html#a2">ITLB_SET_VALUE_SUPPRESSED_DOFS</a>)
00220       }<span class="comment">//end Independent loop (overlapping with read from coarse ghosts)</span>
00221     } <span class="keywordflow">else</span> {
00222       <span class="keywordflow">for</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;(), daf-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::WRITABLE&gt;();
00223           ( (daf-&gt;<a class="code" href="classot_1_1DA.html#z36_1">currWithInfo</a>() == daf-&gt;<a class="code" href="classot_1_1DA.html#z36_1">currWithInfo</a>()) &amp;&amp; 
00224             (dac-&gt;<a class="code" href="classot_1_1DA.html#z36_1">currWithInfo</a>() &lt; dac-&gt;<a class="code" href="classot_1_1DA.html#z36_2">end</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;()) &amp;&amp;
00225             (loopCtr &lt; fopCnt) );
00226           dac-&gt;<a class="code" href="classot_1_1DA.html#z36_13">next</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;(), loopCtr++) {
00227         <a class="code" href="ProlongMatVec_8C.html#a3">INTERGRID_TRANSFER_LOOP_BLOCK</a>(<a class="code" href="ProlongMatVec_8C.html#a1">ITLB_SET_VALUE_NO_SUPPRESSED_DOFS</a>)
00228       }<span class="comment">//end Independent loop (overlapping with read from coarse ghosts)</span>
00229     }
00230   }
00231 
00232   <span class="keywordflow">if</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00233     dac-&gt;<a class="code" href="classot_1_1DA.html#z33_3">ReadFromGhostsEnd</a>&lt;PetscScalar&gt;(carr);
00234   }
00235 
00236   <span class="keywordflow">if</span>(daf-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00237     daf-&gt;<a class="code" href="classot_1_1DA.html#z33_3">ReadFromGhostsEnd</a>&lt;<a class="code" href="classot_1_1FineTouchedStatus.html">ot::FineTouchedStatus</a>&gt;(fineTouchedFlagsArr);
00238   }
00239 
00240   <span class="keywordflow">if</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00241     <span class="keywordflow">if</span>(suppressedDOFc || suppressedDOFf) {
00242       <span class="keywordflow">for</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::W_DEPENDENT&gt;(), daf-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::WRITABLE&gt;();
00243           dac-&gt;<a class="code" href="classot_1_1DA.html#z36_0">curr</a>() &lt; dac-&gt;<a class="code" href="classot_1_1DA.html#z36_2">end</a>&lt;ot::DA_FLAGS::W_DEPENDENT&gt;(); dac-&gt;<a class="code" href="classot_1_1DA.html#z36_13">next</a>&lt;ot::DA_FLAGS::W_DEPENDENT&gt;()) {
00244         <a class="code" href="ProlongMatVec_8C.html#a3">INTERGRID_TRANSFER_LOOP_BLOCK</a>(<a class="code" href="ProlongMatVec_8C.html#a2">ITLB_SET_VALUE_SUPPRESSED_DOFS</a>)
00245       }<span class="comment">//end dependent loop</span>
00246     } <span class="keywordflow">else</span> {
00247       <span class="keywordflow">for</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::W_DEPENDENT&gt;(), daf-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::WRITABLE&gt;();
00248           dac-&gt;<a class="code" href="classot_1_1DA.html#z36_0">curr</a>() &lt; dac-&gt;<a class="code" href="classot_1_1DA.html#z36_2">end</a>&lt;ot::DA_FLAGS::W_DEPENDENT&gt;(); dac-&gt;<a class="code" href="classot_1_1DA.html#z36_13">next</a>&lt;ot::DA_FLAGS::W_DEPENDENT&gt;()) {
00249         <a class="code" href="ProlongMatVec_8C.html#a3">INTERGRID_TRANSFER_LOOP_BLOCK</a>(<a class="code" href="ProlongMatVec_8C.html#a1">ITLB_SET_VALUE_NO_SUPPRESSED_DOFS</a>)
00250       }<span class="comment">//end dependent loop</span>
00251     }
00252   }
00253 
00254   <span class="keywordflow">if</span>(daf-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00255     daf-&gt;<a class="code" href="classot_1_1DA.html#z33_6">WriteToGhostsBegin</a>&lt;PetscScalar&gt;(farr, dof);
00256   }
00257 
00258   <span class="keywordflow">if</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00259     <span class="comment">//Continue Independent loop from where we left off.</span>
00260     <span class="keywordflow">if</span>(suppressedDOFc || suppressedDOFf) {
00261       <span class="keywordflow">for</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::FROM_STORED&gt;(), daf-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::FROM_STORED&gt;();
00262           dac-&gt;<a class="code" href="classot_1_1DA.html#z36_0">curr</a>() &lt; dac-&gt;<a class="code" href="classot_1_1DA.html#z36_2">end</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;(); dac-&gt;<a class="code" href="classot_1_1DA.html#z36_13">next</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;()) {
00263         <a class="code" href="ProlongMatVec_8C.html#a3">INTERGRID_TRANSFER_LOOP_BLOCK</a>(<a class="code" href="ProlongMatVec_8C.html#a2">ITLB_SET_VALUE_SUPPRESSED_DOFS</a>)
00264       }<span class="comment">//end Independent loop (overlapping with write to fine ghosts) </span>
00265     } <span class="keywordflow">else</span> {
00266       <span class="keywordflow">for</span>(dac-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::FROM_STORED&gt;(), daf-&gt;<a class="code" href="classot_1_1DA.html#z36_9">init</a>&lt;ot::DA_FLAGS::FROM_STORED&gt;();
00267           dac-&gt;<a class="code" href="classot_1_1DA.html#z36_0">curr</a>() &lt; dac-&gt;<a class="code" href="classot_1_1DA.html#z36_2">end</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;(); dac-&gt;<a class="code" href="classot_1_1DA.html#z36_13">next</a>&lt;ot::DA_FLAGS::INDEPENDENT&gt;()) {
00268         <a class="code" href="ProlongMatVec_8C.html#a3">INTERGRID_TRANSFER_LOOP_BLOCK</a>(<a class="code" href="ProlongMatVec_8C.html#a1">ITLB_SET_VALUE_NO_SUPPRESSED_DOFS</a>)
00269       }<span class="comment">//end Independent loop (overlapping with write to fine ghosts) </span>
00270     }
00271   }
00272 
00273   <span class="keywordflow">if</span>(daf-&gt;<a class="code" href="classot_1_1DA.html#a5">iAmActive</a>()) {
00274     daf-&gt;<a class="code" href="classot_1_1DA.html#z33_7">WriteToGhostsEnd</a>&lt;PetscScalar&gt;(farr, dof);
00275   }
00276 
00277   daf-&gt;<a class="code" href="classot_1_1DA.html#z35_13">vecRestoreBuffer</a>(f,farr,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,dof);<span class="comment">//Writable </span>
00278   dac-&gt;<a class="code" href="classot_1_1DA.html#z35_13">vecRestoreBuffer</a>(c,carr,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">true</span>,dof);<span class="comment">//Read-only</span>
00279   daf-&gt;<a class="code" href="classot_1_1DA.html#z35_13">vecRestoreBuffer</a>&lt;<a class="code" href="classot_1_1FineTouchedStatus.html">ot::FineTouchedStatus</a> &gt;(*fineTouchedFlags, fineTouchedFlagsArr, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, 1);<span class="comment">//read-only </span>
00280 
00281 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00282 <span class="preprocessor"></span>  PetscLogFlops(128*dof*(daf-&gt;<a class="code" href="classot_1_1DA.html#z31_5">getElementSize</a>()));
00283 <span class="preprocessor">#endif</span>
00284 <span class="preprocessor"></span>
00285   <a class="code" href="omg_8h.html#a33">PROF_MG_PROLONG_END</a> 
00286 }<span class="comment">//end Prolong-3</span>
00287 
00288 <span class="preprocessor">#undef ITLB_SET_VALUE_NO_SUPPRESSED_DOFS</span>
00289 <span class="preprocessor"></span><span class="preprocessor">#undef ITLB_SET_VALUE_SUPPRESSED_DOFS</span>
00290 <span class="preprocessor"></span><span class="preprocessor">#undef INTERGRID_TRANSFER_LOOP_BLOCK</span>
00291 <span class="preprocessor"></span>
00292 }<span class="comment">//end namespace</span>
00293 
00294 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 10 11:31:33 2008 for DENDRO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
