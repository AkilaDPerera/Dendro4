<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DENDRO: /net/ac190/www-db1/grads/r/rahulss/Dendro/src/test/compareMFiles.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000013.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000023.html">test</a></div>
<h1>compareMFiles.C</h1><a href="compareMFiles_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="preprocessor">#include "mpi.h"</span>
00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
00004 <span class="preprocessor">#include "petsc.h"</span>
00005 <span class="preprocessor">#include "<a class="code" href="sys_8h.html">sys.h</a>"</span>
00006 <span class="preprocessor">#include &lt;vector&gt;</span>
00007 <span class="preprocessor">#include "<a class="code" href="parUtils_8h.html">parUtils.h</a>"</span>
00008 <span class="preprocessor">#include "<a class="code" href="testUtils_8h.html">testUtils.h</a>"</span>
00009 <span class="preprocessor">#include "<a class="code" href="externVars_8h.html">externVars.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="dendro_8h.html">dendro.h</a>"</span>
00011 
<a name="l00012"></a><a class="code" href="classMeshRecord.html">00012</a> <span class="keyword">class </span><a class="code" href="classMeshRecord.html">MeshRecord</a> {
00013         <span class="keyword">private</span>:
00014                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> elementId;
00015                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vtxId[8];
00016         <span class="keyword">public</span>:
<a name="l00017"></a><a class="code" href="classMeshRecord.html#a0">00017</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> getElementId()<span class="keyword"> const </span>{
00018                         <span class="keywordflow">return</span> elementId;
00019                 }
00020 
<a name="l00021"></a><a class="code" href="classMeshRecord.html#a1">00021</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> getVtxId(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vtxNum)<span class="keyword"> const </span>{
00022                         <span class="keywordflow">return</span> vtxId[vtxNum];
00023                 }
00024 
<a name="l00025"></a><a class="code" href="classMeshRecord.html#a4">00025</a>                 <a class="code" href="classMeshRecord.html">MeshRecord</a>() {
00026                         this-&gt;elementId = static_cast&lt;unsigned int&gt;(-1);
00027                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00028                                 this-&gt;vtxId[j] = static_cast&lt;unsigned int&gt;(-1);
00029                         }
00030                 }
00031 
<a name="l00032"></a><a class="code" href="classMeshRecord.html#a3">00032</a>                 <a class="code" href="classMeshRecord.html">MeshRecord</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eId, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* vId) {
00033                         this-&gt;elementId = eId;
00034                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00035                                 this-&gt;vtxId[j] = vId[j];
00036                         }
00037                 }
00038 
<a name="l00039"></a><a class="code" href="classMeshRecord.html#a2">00039</a>                 <a class="code" href="classMeshRecord.html">MeshRecord</a>(<a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span> &amp; other) {
00040                         this-&gt;elementId = other.<a class="code" href="classMeshRecord.html#r0">elementId</a>;
00041                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00042                                 ((this-&gt;vtxId)[j]) = ((other.<a class="code" href="classMeshRecord.html#r1">vtxId</a>)[j]);
00043                         }
00044                 }
00045 
<a name="l00046"></a><a class="code" href="classMeshRecord.html#a8">00046</a>                 <a class="code" href="classMeshRecord.html">MeshRecord</a> &amp; operator = (<a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span>  &amp; other) {
00047                         <span class="keywordflow">if</span>( <span class="keyword">this</span> == (&amp; other) ) {
00048                                 <span class="keywordflow">return</span> (*this); 
00049                         }
00050                         this-&gt;elementId = other.<a class="code" href="classMeshRecord.html#r0">elementId</a>;
00051                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00052                                 ((this-&gt;vtxId)[j]) = ((other.<a class="code" href="classMeshRecord.html#r1">vtxId</a>)[j]);
00053                         }
00054                         <span class="keywordflow">return</span> (*this);
00055                 }
00056 
<a name="l00057"></a><a class="code" href="classMeshRecord.html#a9">00057</a>                 <span class="keywordtype">bool</span>  operator == ( <a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00058                         <span class="keywordtype">bool</span> result = (this-&gt;elementId == other.<a class="code" href="classMeshRecord.html#r0">elementId</a>);
00059                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; ( (j &lt; 8) &amp;&amp; result ); j++) {
00060                                 result = (result &amp;&amp; ( ((this-&gt;vtxId)[j]) == ((other.<a class="code" href="classMeshRecord.html#r1">vtxId</a>)[j]) ) );
00061                         }
00062                         <span class="keywordflow">return</span> result;
00063                 }
00064 
<a name="l00065"></a><a class="code" href="classMeshRecord.html#a6">00065</a>                 <span class="keywordtype">bool</span>  operator &lt; ( <a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00066                         <span class="comment">//Sort using elementId first and then 0 thro 7 vtxId</span>
00067                         <span class="comment">//Since the elements should not repeat, eId should be unique.</span>
00068                         <span class="keywordflow">if</span>(this-&gt;elementId == other.<a class="code" href="classMeshRecord.html#r0">elementId</a>) {
00069                                 std::cout&lt;&lt;<span class="stringliteral">"WARNING: Comparing two records with the same elementId."</span>&lt;&lt;std::endl;        
00070                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0;
00071                                 <span class="keywordflow">while</span>( ((this-&gt;vtxId)[j]) == ((other.<a class="code" href="classMeshRecord.html#r1">vtxId</a>)[j]) ) {
00072                                         j++;
00073                                 }
00074                                 <span class="keywordflow">return</span> ( ((this-&gt;vtxId)[j]) &lt; ((other.<a class="code" href="classMeshRecord.html#r1">vtxId</a>)[j]) );
00075                         } <span class="keywordflow">else</span> {
00076                                 <span class="keywordflow">return</span> (this-&gt;elementId &lt; other.<a class="code" href="classMeshRecord.html#r0">elementId</a>);
00077                         }
00078                 }
00079 
<a name="l00080"></a><a class="code" href="classMeshRecord.html#a5">00080</a>                 <span class="keywordtype">bool</span>  operator != (<a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00081                         <span class="keywordflow">return</span> (!((*this) == other));
00082                 }
00083 
<a name="l00084"></a><a class="code" href="classMeshRecord.html#a10">00084</a>                 <span class="keywordtype">bool</span>  operator &gt; ( <a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00085                         <span class="keywordflow">return</span> ( ((*this) != other) &amp;&amp; ((*this) &gt;= other) );
00086                 }
00087 
<a name="l00088"></a><a class="code" href="classMeshRecord.html#a7">00088</a>                 <span class="keywordtype">bool</span>  operator &lt;= ( <a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00089                         <span class="keywordflow">return</span> ( ((*this) &lt; other) || ((*this) == other) );
00090                 }
00091 
<a name="l00092"></a><a class="code" href="classMeshRecord.html#a11">00092</a>                 <span class="keywordtype">bool</span>  operator &gt;= ( <a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span>  &amp;other)<span class="keyword"> const </span>{
00093                         <span class="keywordflow">return</span> (!((*this) &lt; other));
00094                 }
00095 
00096                 <span class="keyword">friend</span> std::ostream &amp; <a class="code" href="compareNlFiles_8C.html#a0">operator &lt;&lt; </a>(std::ostream &amp; os, <a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span> &amp; v) ;
00097 }; <span class="comment">//end class MeshRecord</span>
00098 
<a name="l00099"></a><a class="code" href="compareMFiles_8C.html#a0">00099</a> std::ostream &amp; <a class="code" href="compareNlFiles_8C.html#a0">operator &lt;&lt;</a>(std::ostream &amp; os, <a class="code" href="classMeshRecord.html">MeshRecord</a> <span class="keyword">const</span> &amp; r) {
00100         <span class="keywordflow">return</span> (os &lt;&lt; r.<a class="code" href="classMeshRecord.html#r0">elementId</a> &lt;&lt;<span class="stringliteral">" "</span>&lt;&lt; r.<a class="code" href="classMeshRecord.html#r1">vtxId</a>[0] &lt;&lt;<span class="stringliteral">" "</span>&lt;&lt;r.<a class="code" href="classMeshRecord.html#r1">vtxId</a>[1]&lt;&lt;<span class="stringliteral">" "</span>
00101                         &lt;&lt;r.<a class="code" href="classMeshRecord.html#r1">vtxId</a>[2] &lt;&lt;<span class="stringliteral">" "</span>&lt;&lt; r.<a class="code" href="classMeshRecord.html#r1">vtxId</a>[3] &lt;&lt;<span class="stringliteral">" "</span>&lt;&lt;r.<a class="code" href="classMeshRecord.html#r1">vtxId</a>[4]&lt;&lt;<span class="stringliteral">" "</span>
00102                         &lt;&lt;r.<a class="code" href="classMeshRecord.html#r1">vtxId</a>[5]&lt;&lt;<span class="stringliteral">" "</span>&lt;&lt;r.<a class="code" href="classMeshRecord.html#r1">vtxId</a>[6]&lt;&lt;<span class="stringliteral">" "</span>&lt;&lt;r.<a class="code" href="classMeshRecord.html#r1">vtxId</a>[7] );
00103 }<span class="comment">//end fn.</span>
00104 
00105 <span class="keyword">namespace </span>par {
00106 
00107   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
00108     <span class="keyword">class </span>Mpi_datatype;
00109 
00110         <span class="keyword">template</span> &lt;&gt;
<a name="l00111"></a><a class="code" href="classpar_1_1Mpi__datatype_3_01MeshRecord_01_4.html">00111</a>                 <span class="keyword">class </span><a class="code" href="classpar_1_1Mpi__datatype.html">Mpi_datatype</a>&lt;MeshRecord&gt; {
00112                         <span class="keyword">public</span>: 
<a name="l00113"></a><a class="code" href="classpar_1_1Mpi__datatype_3_01MeshRecord_01_4.html#e0">00113</a>                                 <span class="keyword">static</span> MPI_Datatype value() {
00114                                         <span class="keyword">static</span> <span class="keywordtype">bool</span>         first = <span class="keyword">true</span>;
00115                                         <span class="keyword">static</span> MPI_Datatype datatype;
00116                                         <span class="keywordflow">if</span> (first) {
00117                                                 first = <span class="keyword">false</span>;
00118                                                 MPI_Type_contiguous(<span class="keyword">sizeof</span>(MeshRecord), MPI_BYTE, &amp;datatype);
00119                                                 MPI_Type_commit(&amp;datatype);
00120                                         }
00121                                         <span class="keywordflow">return</span> datatype;
00122                                 }
00123                 };
00124 }<span class="comment">//end namespace</span>
00125 
<a name="l00126"></a><a class="code" href="compareMFiles_8C.html#a1">00126</a> <span class="keywordtype">int</span> <a class="code" href="testShFn_8C.html#a8">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>**argv) {
00127 
00128         PetscInitialize(&amp;argc,&amp;argv,0,0);
00129         <a class="code" href="namespaceot.html#a134">ot::RegisterEvents</a>();
00130 
00131         <span class="keywordflow">if</span>(argc &lt; 4) {
00132                 std::cout&lt;&lt;<span class="stringliteral">"exe fileBase file1Procs file2Procs "</span>&lt;&lt;std::endl;
00133                 assert(<span class="keyword">false</span>);
00134         }
00135 
00136         <span class="keywordtype">int</span> rank, npes;
00137         MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
00138         MPI_Comm_size(MPI_COMM_WORLD, &amp;npes);
00139 
00140         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> file1Procs = atoi(argv[2]);
00141         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> file2Procs = atoi(argv[3]);
00142 
00143         assert(file1Procs &lt;= file2Procs);
00144         assert(file2Procs &lt;= npes);
00145 
00146         std::vector&lt;MeshRecord&gt; vals1;
00147         std::vector&lt;MeshRecord&gt; vals2;
00148 
00149         <span class="keywordflow">if</span>(rank &lt; file1Procs) {
00150                 <span class="keywordtype">char</span> fileName[100];
00151                 sprintf(fileName,<span class="stringliteral">"%s_%d_%d.out"</span>,argv[1],rank,file1Procs);
00152                 FILE * fptr = fopen(fileName,<span class="stringliteral">"rb"</span>);
00153                 assert(fptr != NULL);
00154                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElems = 0;
00155                 fread(&amp;numElems, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 1, fptr);
00156                 vals1.resize(numElems);
00157                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numElems; i++ ) {   
00158                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record[9];
00159                         fread(record, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 9, fptr);
00160                         vals1[i] = <a class="code" href="classMeshRecord.html">MeshRecord</a>(record[0], (record+1));
00161                 }
00162                 fclose(fptr);
00163         }
00164 
00165         MPI_Barrier(MPI_COMM_WORLD);
00166 
00167         <span class="keywordflow">if</span>(!rank) {
00168                 std::cout&lt;&lt;<span class="stringliteral">"Read File1 Successfully."</span>&lt;&lt;std::endl;
00169         }
00170 
00171         MPI_Barrier(MPI_COMM_WORLD);
00172 
00173         <span class="keywordflow">if</span>(rank &lt; file2Procs) {
00174                 <span class="keywordtype">char</span> fileName[100];
00175                 sprintf(fileName,<span class="stringliteral">"%s_%d_%d.out"</span>,argv[1],rank,file2Procs);
00176                 FILE * fptr = fopen(fileName,<span class="stringliteral">"rb"</span>);
00177                 assert(fptr != NULL);
00178                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElems = 0;
00179                 fread(&amp;numElems, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 1, fptr);
00180                 vals2.resize(numElems);
00181                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numElems; i++ ) {   
00182                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record[9];
00183                         fread(record, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 9, fptr);
00184                         vals2[i] = <a class="code" href="classMeshRecord.html">MeshRecord</a>(record[0], (record+1));
00185                 }
00186                 fclose(fptr);
00187         }
00188 
00189         MPI_Barrier(MPI_COMM_WORLD);
00190 
00191         <span class="keywordflow">if</span>(!rank) {
00192                 std::cout&lt;&lt;<span class="stringliteral">"Read File2 Successfully."</span>&lt;&lt;std::endl;
00193         }
00194 
00195         MPI_Barrier(MPI_COMM_WORLD);
00196 
00197         <a class="code" href="dendro_8h.html#a0">DendroIntL</a> locSz1 = vals1.size();
00198         <a class="code" href="dendro_8h.html#a0">DendroIntL</a> globSz1 = 0;
00199         par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;locSz1, &amp;globSz1, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00200 
00201         <a class="code" href="dendro_8h.html#a0">DendroIntL</a> locSz2 = vals2.size();
00202         <a class="code" href="dendro_8h.html#a0">DendroIntL</a> globSz2 = 0;
00203         par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;locSz2, &amp;globSz2, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00204 
00205         MPI_Barrier(MPI_COMM_WORLD);
00206 
00207         <span class="keywordflow">if</span>(!rank) {
00208                 assert(globSz1 == globSz2);
00209                 std::cout &lt;&lt; <span class="stringliteral">"Global Size: "</span> &lt;&lt; globSz1 &lt;&lt; std::endl;
00210         }
00211 
00212         MPI_Barrier(MPI_COMM_WORLD);
00213 
00214         <span class="keywordtype">bool</span> is1uniqueAndSorted =  par::test::isUniqueAndSorted&lt;MeshRecord&gt;(vals1, MPI_COMM_WORLD);
00215         <span class="keywordtype">bool</span> is2uniqueAndSorted =  par::test::isUniqueAndSorted&lt;MeshRecord&gt;(vals2, MPI_COMM_WORLD);
00216 
00217         <span class="keywordflow">if</span>(!rank) {
00218                 assert(is1uniqueAndSorted);
00219                 assert(is2uniqueAndSorted);
00220         }
00221 
00222         MPI_Barrier(MPI_COMM_WORLD);
00223 
00224         <span class="keywordflow">if</span>(!rank) {
00225                 std::cout&lt;&lt;<span class="stringliteral">"The records are sorted and unique. "</span>&lt;&lt;std::endl;
00226         }
00227 
00228         MPI_Barrier(MPI_COMM_WORLD);
00229 
00230         par::partitionW&lt;MeshRecord&gt;(vals1, NULL, MPI_COMM_WORLD);
00231         
00232         MPI_Barrier(MPI_COMM_WORLD);
00233 
00234         <span class="keywordflow">if</span>(!rank) {
00235                 std::cout&lt;&lt;<span class="stringliteral">"Finished Partitioning List 1 "</span>&lt;&lt;std::endl;
00236         }
00237 
00238         MPI_Barrier(MPI_COMM_WORLD);
00239 
00240         par::partitionW&lt;MeshRecord&gt;(vals2, NULL, MPI_COMM_WORLD);
00241 
00242         MPI_Barrier(MPI_COMM_WORLD);
00243 
00244         <span class="keywordflow">if</span>(!rank) {
00245                 std::cout&lt;&lt;<span class="stringliteral">"Finished Partitioning List 2 "</span>&lt;&lt;std::endl;
00246         }
00247 
00248         MPI_Barrier(MPI_COMM_WORLD);
00249 
00250         {
00251                 <span class="keywordtype">char</span> outFile1[100];
00252                 sprintf(outFile1,<span class="stringliteral">"MeshList1_%d_%d.out"</span>,rank,npes);
00253                 FILE * fptr1 = fopen(outFile1,<span class="stringliteral">"wb"</span>);
00254                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElems = (vals1.size());
00255                 fwrite(&amp;numElems, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 1, fptr1);
00256                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numElems; i++ ) {   
00257                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record[9];
00258                         record[0] = vals1[i].getElementId();
00259                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00260                                 record[j+1] = vals1[i].getVtxId(j);
00261                         }
00262                         fwrite(record, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 9, fptr1);
00263                 }
00264                 fclose(fptr1);
00265         }
00266 
00267         {
00268                 <span class="keywordtype">char</span> outFile2[100];
00269                 sprintf(outFile2,<span class="stringliteral">"MeshList2_%d_%d.out"</span>,rank,npes);
00270                 FILE * fptr2 = fopen(outFile2,<span class="stringliteral">"wb"</span>);
00271                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElems = (vals2.size());
00272                 fwrite(&amp;numElems, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 1, fptr2);
00273                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numElems; i++ ) {   
00274                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record[9];
00275                         record[0] = vals2[i].getElementId();
00276                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {
00277                                 record[j+1] = vals2[i].getVtxId(j);
00278                         }
00279                         fwrite(record, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), 9, fptr2);
00280                 }
00281                 fclose(fptr2);
00282         }
00283 
00284         MPI_Barrier(MPI_COMM_WORLD);
00285 
00286         <span class="keywordflow">if</span>(!rank) {
00287                 std::cout&lt;&lt;<span class="stringliteral">"Finished writing out the sorted records "</span>&lt;&lt;std::endl;
00288         }
00289 
00290         MPI_Barrier(MPI_COMM_WORLD);
00291 
00292 
00293         assert(vals1.size() == vals2.size());
00294 
00295         MPI_Barrier(MPI_COMM_WORLD);
00296 
00297         <span class="keywordtype">bool</span> Ipassed = <span class="keyword">false</span>;
00298         <span class="keywordflow">if</span>(vals1 == vals2) {
00299                 Ipassed = <span class="keyword">true</span>;
00300         }
00301 
00302         <span class="keywordtype">bool</span> *IpassedList = <span class="keyword">new</span> <span class="keywordtype">bool</span>[npes];
00303         par::Mpi_Allgather&lt;bool&gt;(&amp;Ipassed, IpassedList, 1, MPI_COMM_WORLD);
00304 
00305         <span class="keywordtype">bool</span> allPassed = <span class="keyword">true</span>;
00306         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastP = 0;
00307         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; ((i &lt; npes) &amp;&amp; allPassed); i++) {
00308                 allPassed = (allPassed &amp;&amp; IpassedList[i]);
00309                 lastP = i;
00310         }
00311         <span class="keyword">delete</span> [] IpassedList;
00312 
00313         <span class="keywordflow">if</span>(!allPassed) {
00314                 <span class="keywordflow">if</span>(rank == lastP) {
00315                         std::cout&lt;&lt;<span class="stringliteral">"First Failing on Proc: "</span>&lt;&lt; lastP &lt;&lt;std::endl;
00316                         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; vals1.size(); i++) {
00317                                 <span class="keywordflow">if</span>(vals1[i] != vals2[i]) {
00318                                         std::cout&lt;&lt;<span class="stringliteral">"i = "</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">" val1 = "</span>&lt;&lt;vals1[i]&lt;&lt;<span class="stringliteral">" val2 = "</span>&lt;&lt;vals2[i]&lt;&lt;std::endl;
00319                                         <span class="keywordflow">break</span>;  
00320                                 }
00321                         }
00322                 }
00323         }
00324 
00325         vals1.clear();
00326         vals2.clear();
00327 
00328         MPI_Barrier(MPI_COMM_WORLD);
00329 
00330         <span class="keywordflow">if</span>(!rank) {
00331                 <span class="keywordflow">if</span>(allPassed) {
00332                         std::cout&lt;&lt;<span class="stringliteral">"The files match."</span>&lt;&lt;std::endl;
00333                 }<span class="keywordflow">else</span> {
00334                         std::cout&lt;&lt;<span class="stringliteral">"The files do not match."</span>&lt;&lt;std::endl;
00335                 }
00336         }
00337 
00338         MPI_Barrier(MPI_COMM_WORLD);
00339 
00340         PetscFinalize();
00341 
00342 }
00343 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 10 11:31:34 2008 for DENDRO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
