<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DENDRO: /net/ac190/www-db1/grads/r/rahulss/Dendro/examples/pts2Mesh.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">examples</a></div>
<h1>pts2Mesh.C</h1><a href="pts2Mesh_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00007 <span class="preprocessor">#include "mpi.h"</span>
00008 <span class="preprocessor">#include "petsc.h"</span>
00009 <span class="preprocessor">#include "<a class="code" href="sys_8h.html">sys.h</a>"</span>
00010 <span class="preprocessor">#include &lt;vector&gt;</span>
00011 <span class="preprocessor">#include "<a class="code" href="TreeNode_8h.html">TreeNode.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="parUtils_8h.html">parUtils.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="omg_8h.html">omg.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="odaUtils_8h.html">odaUtils.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="handleStencils_8h.html">handleStencils.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="elasticityJac_8h.html">elasticityJac.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="omgJac_8h.html">omgJac.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="colors_8h.html">colors.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="externVars_8h.html">externVars.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="dendro_8h.html">dendro.h</a>"</span>
00021 
<a name="l00022"></a><a class="code" href="pts2Mesh_8C.html#a1">00022</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="pts2Mesh_8C.html#a1">help</a>[] = <span class="stringliteral">"Solves static Navier-Lame equations\</span>
00023 <span class="stringliteral">                      using FEM, MG, DA and Matrix-Free methods.\n\n"</span>;
00024 
00025 <span class="comment">//Don't want time to be synchronized. Need to check load imbalance.</span>
00026 <span class="preprocessor">#ifdef MPI_WTIME_IS_GLOBAL</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#undef MPI_WTIME_IS_GLOBAL</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00029 <span class="preprocessor"></span>
00030 <span class="preprocessor">#ifndef iC</span>
<a name="l00031"></a><a class="code" href="pts2Mesh_8C.html#a0">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define iC(fun) {CHKERRQ(fun);}</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00033 <span class="preprocessor"></span>
00034 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00035 <span class="preprocessor"></span><span class="keywordtype">int</span> elasticityDiagEvent;
00036 <span class="keywordtype">int</span> elasticityMultEvent;
00037 <span class="keywordtype">int</span> elasticityFinestDiagEvent;
00038 <span class="keywordtype">int</span> elasticityFinestMultEvent;
00039 
00040 <span class="keywordtype">int</span> vecMassDiagEvent;
00041 <span class="keywordtype">int</span> vecMassMultEvent;
00042 <span class="keywordtype">int</span> vecMassFinestDiagEvent;
00043 <span class="keywordtype">int</span> vecMassFinestMultEvent;
00044 <span class="preprocessor">#endif</span>
00045 <span class="preprocessor"></span>
00046 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00047 <span class="preprocessor"></span><span class="comment">//user-defined variables</span>
00048 <span class="keywordtype">int</span> Jac1DiagEvent;
00049 <span class="keywordtype">int</span> Jac1MultEvent;
00050 <span class="keywordtype">int</span> Jac1FinestDiagEvent;
00051 <span class="keywordtype">int</span> Jac1FinestMultEvent;
00052 
00053 <span class="keywordtype">int</span> Jac2DiagEvent;
00054 <span class="keywordtype">int</span> Jac2MultEvent;
00055 <span class="keywordtype">int</span> Jac2FinestDiagEvent;
00056 <span class="keywordtype">int</span> Jac2FinestMultEvent;
00057 
00058 <span class="keywordtype">int</span> Jac3DiagEvent;
00059 <span class="keywordtype">int</span> Jac3MultEvent;
00060 <span class="keywordtype">int</span> Jac3FinestDiagEvent;
00061 <span class="keywordtype">int</span> Jac3FinestMultEvent;
00062 <span class="preprocessor">#endif</span>
00063 <span class="preprocessor"></span>
<a name="l00064"></a><a class="code" href="pts2Mesh_8C.html#a2">00064</a> <span class="keywordtype">double</span>***** LaplacianType1Stencil; 
<a name="l00065"></a><a class="code" href="pts2Mesh_8C.html#a3">00065</a> <span class="keywordtype">double</span>**** LaplacianType2Stencil; 
<a name="l00066"></a><a class="code" href="pts2Mesh_8C.html#a4">00066</a> <span class="keywordtype">double</span>***** MassType1Stencil; 
<a name="l00067"></a><a class="code" href="pts2Mesh_8C.html#a5">00067</a> <span class="keywordtype">double</span>**** MassType2Stencil; 
<a name="l00068"></a><a class="code" href="pts2Mesh_8C.html#a6">00068</a> <span class="keywordtype">double</span>****** ShapeFnStencil;
<a name="l00069"></a><a class="code" href="pts2Mesh_8C.html#a7">00069</a> <span class="keywordtype">double</span>**** ShapeFnCoeffs;
00070 
<a name="l00071"></a><a class="code" href="pts2Mesh_8C.html#a8">00071</a> <span class="keywordtype">double</span>**** GradDivType2Stencil; 
00072 
<a name="l00073"></a><a class="code" href="pts2Mesh_8C.html#a9">00073</a> <span class="keywordtype">int</span> <a class="code" href="testShFn_8C.html#a8">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv ) {     
00074   <span class="keywordtype">int</span> size, rank;
00075   <span class="keywordtype">bool</span> incCorner = 1;  
00076   <span class="keywordtype">double</span> gSize[3];
00077   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ptsLen;
00078   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxNumPts = 1;
00079   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 3;
00080   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxDepth = 30;
00081   <span class="keywordtype">bool</span> compressLut = <span class="keyword">false</span>;
00082   <span class="keywordtype">double</span> localTime, globalTime;
00083   <span class="keywordtype">double</span> startTime, endTime;
00084   <a class="code" href="dendro_8h.html#a0">DendroIntL</a> localSz, totalSz;
00085   std::vector&lt;ot::TreeNode&gt; linOct, balOct;
00086   std::vector&lt;double&gt; pts;
00087   <span class="keywordtype">double</span> mgLoadFac = 2.0;
00088   <span class="keywordtype">char</span> partitionFileNameBase[100];
00089   <span class="keywordtype">bool</span> dumpPartitions = <span class="keyword">false</span>;
00090   <span class="keywordtype">char</span> ptsFileName[256];
00091 
00092   PetscInitialize(&amp;argc,&amp;argv,<span class="stringliteral">"optionsElasticity"</span>,<a class="code" href="pts2Mesh_8C.html#a1">help</a>);
00093   <a class="code" href="namespaceot.html#a134">ot::RegisterEvents</a>();
00094 
00095   <a class="code" href="namespaceot.html#a89">ot::DAMG_Initialize</a>(MPI_COMM_WORLD);
00096 
00097   MPI_Comm_size(MPI_COMM_WORLD,&amp;size);
00098   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00099 
00100   <span class="keywordflow">if</span>(argc &lt; 2) {
00101     std::cout&lt;&lt;<span class="stringliteral">"  Usage: &lt;exe&gt; ptsFilePrefix dim[3] maxDepth[30]"</span>&lt;&lt;
00102       <span class="stringliteral">" maxNumPtsPerOctant[1] incCorner[1] compressLut[0]"</span>&lt;&lt;
00103       <span class="stringliteral">" mgLoadFac[2.0] partitionFileNameBase "</span>&lt;&lt;std::endl; 
00104     <a class="code" href="namespaceot.html#a93">ot::DAMG_Finalize</a>();
00105     PetscFinalize();
00106   }
00107 
00108   <span class="keywordflow">if</span>(argc &gt; 1) {
00109     sprintf(ptsFileName, <span class="stringliteral">"%s%d_%d.pts"</span>, argv[1], rank, size);
00110   }  
00111   <span class="keywordflow">if</span>(argc &gt; 2) {
00112     dim = atoi(argv[2]);
00113   }
00114   <span class="keywordflow">if</span>(argc &gt; 3) {
00115     maxDepth = atoi(argv[3]);
00116   }
00117   <span class="keywordflow">if</span>(argc &gt; 4) {
00118     maxNumPts = atoi(argv[4]);
00119   }
00120   <span class="keywordflow">if</span>(argc &gt; 5) {
00121     incCorner = (bool)(atoi(argv[5]));
00122   }  
00123   <span class="keywordflow">if</span>(argc &gt; 6) { 
00124     compressLut = (bool)(atoi(argv[6]));
00125   }
00126   <span class="keywordflow">if</span>(argc &gt; 7) { 
00127     mgLoadFac = atof(argv[7]);
00128   }
00129   <span class="keywordflow">if</span>(argc &gt; 8) {
00130     dumpPartitions = <span class="keyword">true</span>;
00131     strcpy(partitionFileNameBase, argv[8]);
00132   }
00133 
00134 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00135 <span class="preprocessor"></span>  PetscLogEventRegister(&amp;Jac1DiagEvent,<span class="stringliteral">"ODAmatDiag"</span>,PETSC_VIEWER_COOKIE);
00136   PetscLogEventRegister(&amp;Jac1MultEvent,<span class="stringliteral">"ODAmatMult"</span>,PETSC_VIEWER_COOKIE);
00137   PetscLogEventRegister(&amp;Jac1FinestDiagEvent,<span class="stringliteral">"ODAmatDiagFinest"</span>,PETSC_VIEWER_COOKIE);
00138   PetscLogEventRegister(&amp;Jac1FinestMultEvent,<span class="stringliteral">"ODAmatMultFinest"</span>,PETSC_VIEWER_COOKIE);
00139 
00140   PetscLogEventRegister(&amp;Jac2DiagEvent,<span class="stringliteral">"OMGmatDiag-2"</span>,PETSC_VIEWER_COOKIE);
00141   PetscLogEventRegister(&amp;Jac2MultEvent,<span class="stringliteral">"OMGmatMult-2"</span>,PETSC_VIEWER_COOKIE);
00142   PetscLogEventRegister(&amp;Jac2FinestDiagEvent,<span class="stringliteral">"OMGmatDiagFinest-2"</span>,PETSC_VIEWER_COOKIE);
00143   PetscLogEventRegister(&amp;Jac2FinestMultEvent,<span class="stringliteral">"OMGmatMultFinest-2"</span>,PETSC_VIEWER_COOKIE);
00144 
00145   PetscLogEventRegister(&amp;Jac3DiagEvent,<span class="stringliteral">"OMGmatDiag-3"</span>,PETSC_VIEWER_COOKIE);
00146   PetscLogEventRegister(&amp;Jac3MultEvent,<span class="stringliteral">"OMGmatMult-3"</span>,PETSC_VIEWER_COOKIE);
00147   PetscLogEventRegister(&amp;Jac3FinestDiagEvent,<span class="stringliteral">"OMGmatDiagFinest-3"</span>,PETSC_VIEWER_COOKIE);
00148   PetscLogEventRegister(&amp;Jac3FinestMultEvent,<span class="stringliteral">"OMGmatMultFinest-3"</span>,PETSC_VIEWER_COOKIE);
00149   PetscLogEventRegister(&amp;vecMassDiagEvent,<span class="stringliteral">"vMassDiag"</span>,PETSC_VIEWER_COOKIE);
00150   PetscLogEventRegister(&amp;vecMassMultEvent,<span class="stringliteral">"vMassMult"</span>,PETSC_VIEWER_COOKIE);
00151   PetscLogEventRegister(&amp;vecMassFinestDiagEvent,<span class="stringliteral">"vMassDiagFinest"</span>,PETSC_VIEWER_COOKIE);
00152   PetscLogEventRegister(&amp;vecMassFinestMultEvent,<span class="stringliteral">"vMassMultFinest"</span>,PETSC_VIEWER_COOKIE);
00153 
00154   PetscLogEventRegister(&amp;elasticityDiagEvent,<span class="stringliteral">"elDiag"</span>,PETSC_VIEWER_COOKIE);
00155   PetscLogEventRegister(&amp;elasticityMultEvent,<span class="stringliteral">"elMult"</span>,PETSC_VIEWER_COOKIE);
00156   PetscLogEventRegister(&amp;elasticityFinestDiagEvent,<span class="stringliteral">"elDiagFinest"</span>,PETSC_VIEWER_COOKIE);
00157   PetscLogEventRegister(&amp;elasticityFinestMultEvent,<span class="stringliteral">"elMultFinest"</span>,PETSC_VIEWER_COOKIE);
00158 
00159   <span class="keywordtype">int</span> stages[3];
00160   PetscLogStageRegister(&amp;stages[0],<span class="stringliteral">"P2O."</span>);
00161   PetscLogStageRegister(&amp;stages[1],<span class="stringliteral">"Bal"</span>);  
00162   PetscLogStageRegister(&amp;stages[2],<span class="stringliteral">"Solve"</span>);  
00163 <span class="preprocessor">#endif</span>
00164 <span class="preprocessor"></span>
00165 
00166   <span class="comment">//Read pts from files</span>
00167   MPI_Barrier(MPI_COMM_WORLD);  
00168   <span class="keywordflow">if</span>(!rank){
00169     std::cout &lt;&lt; <span class="stringliteral">" reading  "</span>&lt;&lt;ptsFileName&lt;&lt;std::endl; <span class="comment">// Point size</span>
00170   }
00171   <a class="code" href="namespaceot.html#a48">ot::readPtsFromFile</a>(ptsFileName, pts);
00172   <span class="keywordflow">if</span>(!rank){
00173     std::cout &lt;&lt; <span class="stringliteral">" finished reading  "</span>&lt;&lt;ptsFileName&lt;&lt;std::endl; <span class="comment">// Point size</span>
00174   }
00175   MPI_Barrier(MPI_COMM_WORLD);  
00176 
00177   ptsLen = pts.size();
00178   std::vector&lt;ot::TreeNode&gt; tmpNodes;
00179   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0;i &lt; ptsLen; i+=3) {
00180     <span class="keywordflow">if</span>( (pts[i] &gt; 0.0) &amp;&amp;
00181         (pts[i+1] &gt; 0.0)  
00182         &amp;&amp; (pts[i+2] &gt; 0.0) &amp;&amp;
00183         ( ((<span class="keywordtype">unsigned</span> int)(pts[i]*((double)(1u &lt;&lt; maxDepth)))) &lt; (1u &lt;&lt; maxDepth))  &amp;&amp;
00184         ( ((<span class="keywordtype">unsigned</span> int)(pts[i+1]*((double)(1u &lt;&lt; maxDepth)))) &lt; (1u &lt;&lt; maxDepth))  &amp;&amp;
00185         ( ((<span class="keywordtype">unsigned</span> int)(pts[i+2]*((double)(1u &lt;&lt; maxDepth)))) &lt; (1u &lt;&lt; maxDepth)) ) {
00186       tmpNodes.push_back( <a class="code" href="classot_1_1TreeNode.html">ot::TreeNode</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(pts[i]*(<span class="keywordtype">double</span>)(1u &lt;&lt; maxDepth)),
00187             (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(pts[i+1]*(<span class="keywordtype">double</span>)(1u &lt;&lt; maxDepth)),
00188             (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(pts[i+2]*(<span class="keywordtype">double</span>)(1u &lt;&lt; maxDepth)),
00189             maxDepth,dim,maxDepth) );
00190     }
00191   }
00192   pts.clear();
00193 
00194   par::removeDuplicates&lt;ot::TreeNode&gt;(tmpNodes,<span class="keyword">false</span>,MPI_COMM_WORLD);   
00195   linOct = tmpNodes;
00196   tmpNodes.clear();
00197   par::partitionW&lt;ot::TreeNode&gt;(linOct, NULL,MPI_COMM_WORLD);
00198   <span class="comment">// reduce and only print the total ...</span>
00199   localSz = linOct.size();
00200   par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;localSz, &amp;totalSz, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00201   MPI_Barrier(MPI_COMM_WORLD);  
00202   <span class="keywordflow">if</span>(rank==0) {
00203     std::cout&lt;&lt;<span class="stringliteral">"# pts= "</span> &lt;&lt; totalSz&lt;&lt;std::endl;
00204   }
00205   MPI_Barrier(MPI_COMM_WORLD);  
00206 
00207   pts.resize(3*(linOct.size()));
00208   ptsLen = (3*(linOct.size()));
00209   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; linOct.size(); i++) {
00210     pts[3*i] = (((double)(linOct[i].getX())) + 0.5)/((double)(1u &lt;&lt; maxDepth));
00211     pts[(3*i)+1] = (((double)(linOct[i].getY())) +0.5)/((double)(1u &lt;&lt; maxDepth));
00212     pts[(3*i)+2] = (((double)(linOct[i].getZ())) +0.5)/((double)(1u &lt;&lt; maxDepth));
00213   }<span class="comment">//end for i</span>
00214   linOct.clear();
00215   gSize[0] = 1.0;
00216   gSize[1] = 1.0;
00217   gSize[2] = 1.0;
00218 
00219   <span class="comment">//Points2Octree....</span>
00220   MPI_Barrier(MPI_COMM_WORLD);  
00221 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00222 <span class="preprocessor"></span>  PetscLogStagePush(stages[0]);
00223 <span class="preprocessor">#endif</span>
00224 <span class="preprocessor"></span>  startTime = MPI_Wtime();
00225   <a class="code" href="namespaceot.html#a35">ot::points2Octree</a>(pts, gSize, linOct, dim, maxDepth, maxNumPts, MPI_COMM_WORLD);
00226   endTime = MPI_Wtime();
00227 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00228 <span class="preprocessor"></span>  PetscLogStagePop();
00229 <span class="preprocessor">#endif</span>
00230 <span class="preprocessor"></span>  localTime = endTime - startTime;
00231   par::Mpi_Reduce&lt;double&gt;(&amp;localTime, &amp;globalTime, 1, MPI_MAX, 0, MPI_COMM_WORLD);
00232   <span class="keywordflow">if</span>(!rank){
00233     std::cout &lt;&lt;<span class="stringliteral">"P2n Time: "</span>&lt;&lt;globalTime &lt;&lt; std::endl;
00234   }
00235   <span class="comment">// reduce and only print the total ...</span>
00236   localSz = linOct.size();
00237   par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;localSz, &amp;totalSz, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00238   <span class="keywordflow">if</span>(rank==0) {
00239     std::cout&lt;&lt;<span class="stringliteral">"# of Unbalanced Octants: "</span> &lt;&lt; totalSz&lt;&lt;std::endl;
00240   }
00241   pts.clear();
00242 
00243   <span class="comment">//Balancing...</span>
00244   MPI_Barrier(MPI_COMM_WORLD);  
00245 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00246 <span class="preprocessor"></span>  PetscLogStagePush(stages[1]);
00247 <span class="preprocessor">#endif</span>
00248 <span class="preprocessor"></span>  startTime = MPI_Wtime();
00249   <a class="code" href="namespaceot.html#a10">ot::balanceOctree</a> (linOct, balOct, dim, maxDepth, incCorner, MPI_COMM_WORLD, NULL, NULL);
00250   endTime = MPI_Wtime();
00251 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00252 <span class="preprocessor"></span>  PetscLogStagePop();
00253 <span class="preprocessor">#endif</span>
00254 <span class="preprocessor"></span>  linOct.clear();
00255   <span class="comment">// compute total inp size and output size</span>
00256   localSz = balOct.size();
00257   localTime = endTime - startTime;
00258   par::Mpi_Reduce&lt;DendroIntL&gt;(&amp;localSz, &amp;totalSz, 1, MPI_SUM, 0, MPI_COMM_WORLD);
00259   par::Mpi_Reduce&lt;double&gt;(&amp;localTime, &amp;globalTime, 1, MPI_MAX, 0, MPI_COMM_WORLD);
00260 
00261   <span class="keywordflow">if</span>(!rank) {
00262     std::cout &lt;&lt; <span class="stringliteral">"# of Balanced Octants: "</span>&lt;&lt; totalSz &lt;&lt; std::endl;       
00263     std::cout &lt;&lt; <span class="stringliteral">"bal Time: "</span>&lt;&lt;globalTime &lt;&lt; std::endl;
00264   }
00265 
00266   <span class="comment">//Solve ...</span>
00267   MPI_Barrier(MPI_COMM_WORLD);  
00268 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00269 <span class="preprocessor"></span>  PetscLogStagePush(stages[2]);
00270 <span class="preprocessor">#endif</span>
00271 <span class="preprocessor"></span>
00272   <a class="code" href="structot_1_1__p__DAMG.html">ot::DAMG</a>       *damg;    
00273   <span class="keywordtype">int</span>       nlevels = 1; <span class="comment">//number of multigrid levels</span>
00274   PetscInt       numRefinements = 0;
00275   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   dof = 3; <span class="comment">// degrees of freedom per node  </span>
00276 
00277   <a class="code" href="omg_8C.html#a0">iC</a>(PetscOptionsGetInt(0,<span class="stringliteral">"-numRefinements"</span>,&amp;numRefinements,0));
00278   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; numRefinements; i++) {
00279     std::vector&lt;ot::TreeNode&gt; tmpOct = balOct;
00280     balOct.clear();
00281     <a class="code" href="namespaceot.html#a39">ot::refineOctree</a>(tmpOct, balOct); 
00282   }
00283 
00284   PetscInt nlevelsPetscInt = nlevels;
00285   PetscOptionsGetInt(0, <span class="stringliteral">"-nlevels"</span>, &amp;nlevelsPetscInt, 0);
00286   nlevels = nlevelsPetscInt;
00287 
00288   <span class="comment">// Note: The user context for all levels will be set separately later.</span>
00289   MPI_Barrier(MPI_COMM_WORLD);  
00290 
00291   <span class="keywordflow">if</span>(!rank) {
00292     std::cout&lt;&lt;<span class="stringliteral">"nlevels initial: "</span>&lt;&lt;nlevels&lt;&lt;std::endl;
00293   }
00294 
00295   <a class="code" href="namespaceot.html#a103">ot::DAMGCreateAndSetDA</a>(PETSC_COMM_WORLD, nlevels, NULL, &amp;damg, 
00296       balOct, dof, mgLoadFac, compressLut, incCorner);
00297 
00298   balOct.clear();
00299 
00300   <span class="keywordflow">if</span>(!rank) {
00301     std::cout&lt;&lt;<span class="stringliteral">"nlevels final: "</span>&lt;&lt;nlevels&lt;&lt;std::endl;
00302   }
00303 
00304   MPI_Barrier(MPI_COMM_WORLD);  
00305 
00306   <span class="keywordflow">if</span>(!rank) {
00307     std::cout &lt;&lt; <span class="stringliteral">"Created DA for all levels."</span>&lt;&lt; std::endl;
00308   }
00309 
00310   MPI_Barrier(MPI_COMM_WORLD);
00311   <a class="code" href="namespaceot.html#a108">ot::PrintDAMG</a>(damg);
00312   MPI_Barrier(MPI_COMM_WORLD);
00313 
00314   <span class="comment">//Dump Partitions</span>
00315   <span class="keywordflow">if</span>(dumpPartitions) {
00316     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nlevels; i++) {
00317       <span class="keywordtype">char</span> tmpFileName[200];
00318       sprintf(tmpFileName,<span class="stringliteral">"%s_Lev%d.vtk"</span>, partitionFileNameBase, i);
00319       <a class="code" href="namespaceot.html#a78">ot::writePartitionVTK</a>(damg[i]-&gt;da, tmpFileName);
00320       <span class="keywordflow">if</span>(damg[i]-&gt;<a class="code" href="structot_1_1__p__DAMG.html#o4">da_aux</a>) {
00321         sprintf(tmpFileName,<span class="stringliteral">"%s_Lev%d_Aux.vtk"</span>, partitionFileNameBase, i);
00322         <a class="code" href="namespaceot.html#a78">ot::writePartitionVTK</a>(damg[i]-&gt;da_aux, tmpFileName);
00323       }
00324     }
00325   }
00326 
00327   <a class="code" href="omg_8C.html#a0">iC</a>(<a class="code" href="namespaceot.html#a94">DAMGDestroy</a>(damg));
00328 
00329   <span class="keywordflow">if</span> (!rank) {
00330     std::cout &lt;&lt; <a class="code" href="colors_8h.html#a2">GRN</a> &lt;&lt; <span class="stringliteral">"Destroyed DAMG"</span> &lt;&lt; <a class="code" href="colors_8h.html#a6">NRM</a> &lt;&lt; std::endl;
00331   }
00332 
00333   endTime = MPI_Wtime();
00334 <span class="preprocessor">#ifdef PETSC_USE_LOG</span>
00335 <span class="preprocessor"></span>  PetscLogStagePop();
00336 <span class="preprocessor">#endif</span>
00337 <span class="preprocessor"></span>
00338   <span class="keywordflow">if</span> (!rank) {
00339     std::cout &lt;&lt; <a class="code" href="colors_8h.html#a2">GRN</a> &lt;&lt; <span class="stringliteral">"Finalizing PETSC"</span> &lt;&lt; <a class="code" href="colors_8h.html#a6">NRM</a> &lt;&lt; std::endl;
00340   }
00341   <a class="code" href="namespaceot.html#a93">ot::DAMG_Finalize</a>();
00342   PetscFinalize();
00343 }<span class="comment">//end main</span>
00344 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 10 11:31:25 2008 for DENDRO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
